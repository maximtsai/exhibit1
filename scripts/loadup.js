let INDEX_THRESHOLD=32767,topics,index,messageBus;class InternalMessageBus{constructor(){topics={},index=0}subscribe(a,t,o=null){if(a){if("function"!=typeof t)throw console.error("Topic "+a+" encountered error with callback: "),console.log(t),"callback must be a function";topics.hasOwnProperty(a)||(topics[a]={});let e=index.toString();return topics[a][e]={callback:t,target:o},++index>INDEX_THRESHOLD&&console.warn(`WARNING: Subscriber threshold reached for topic ${a}!`),{unsubscribe:function(){delete topics[a][e]},topic:a}}console.error("Undefined subscription topic for callback: "),console.error(t)}publish(e,a=0){var t=[];if(topics.hasOwnProperty(e)){var o,s=topics[e],m=[];for(let e=1;e<arguments.length;e++)m.push(arguments[e]);for(o in s)try{var r=s[o];r.callback.apply(r.target,m)}catch(e){t.push(e)}if(0<t.length)for(let e=0;e<t.length;e++)console.error(t[e])}}}messageBus=new InternalMessageBus;let NORMAL="normal",HOVER="hover",PRESS="press",DISABLE="disable";class Button{constructor(e,a,t,o,s,m,r,c=!1){let b=null,l=null;var n;t||o||(a=(n=a).container,t=n.onMouseUp,o=n.normal,s=n.hover,m=n.press,r=n.disable,c=n.isDraggable,b=n.onHover,l=n.onDrop),this.scene=e,this.state="normal",this.normal=o,this.hover=s||o,this.press=m||o,this.disable=r||o,this.onMouseUpFunc=t,this.onHoverFunc=b,this.onDropFunc=l,this.imageRefs={},this.oldImageRef=null,this.currImageRef=null,gameObjects.buttonList.push(this),this.container=a||e,a||(this.noContainer=!0),this.handlePreload(),this.setState(NORMAL),this.isDraggable=c}setState(e){let a;switch(e){case NORMAL:a=this.normal;break;case HOVER:a=this.hover;break;case PRESS:a=this.press;break;case DISABLE:a=this.disable;break;default:return void console.error("Invalid state ",e)}if(this.state=e,a.ref){this.oldImageRef=this.currImageRef,this.currImageRef=a.ref,this.imageRefs[this.oldImageRef]&&(this.imageRefs[this.oldImageRef].visible=!1);let e=this.imageRefs[a.ref];var t;e||(e=a.atlas?this.scene.add.sprite(0,0,a.atlas,a.ref):this.scene.add.sprite(0,0,a.ref),(t=this.imageRefs[this.oldImageRef])&&e.setOrigin(t.originX,t.originY),this.noContainer||this.container.add(e),this.imageRefs[a.ref]=e),e.visible=!0}let o=this.imageRefs[this.oldImageRef];o=o||this.imageRefs[this.currImageRef],void 0===a.x?this.imageRefs[a.ref].x=o.x||0:this.imageRefs[a.ref].x=a.x,void 0===a.y?this.imageRefs[a.ref].y=o.y||0:this.imageRefs[a.ref].y=a.y,void 0===a.alpha?this.imageRefs[a.ref].alpha=o.alpha||1:this.imageRefs[a.ref].alpha=a.alpha,void 0===a.scaleX?this.imageRefs[a.ref].scaleX=o.scaleX||1:this.imageRefs[a.ref].scaleX=a.scaleX,void 0===a.scaleY?this.imageRefs[a.ref].scaleY=o.scaleY||1:this.imageRefs[a.ref].scaleY=a.scaleY}handlePreload(){this.hover.preload&&this.setState(HOVER),this.press.preload&&this.setState(PRESS),this.disable.preload&&this.setState(DISABLE)}checkCoordOver(e,a){var t,o,s,m;return this.state!==DISABLE&&(e=e-(this.noContainer?0:this.container.x),a=a-(this.noContainer?0:this.container.y),m=(t=this.imageRefs[this.currImageRef]).width*Math.abs(t.scaleX),o=t.height*Math.abs(t.scaleY),s=t.x-t.originX*m,m=t.x+(1-t.originX)*m,!(e<s||m<e||(s=t.y-t.originY*o,m=t.y+(1-t.originY)*o,a<s)||m<a))}onHover(){this.state===NORMAL&&this.setState(HOVER),this.onHoverFunc&&this.onHoverFunc()}onHoverOut(){this.setState(NORMAL)}onMouseDown(){this.state===DISABLE||(this.setState(PRESS),this.onMouseDownFunc&&this.onMouseDownFunc(),!this.isDraggable)||this.isDragged||(this.setPos(gameVars.mouseposx-gameVars.halfWidth,gameVars.mouseposy),this.isDragged=!0,gameObjects.draggedObj&&gameObjects.draggedObj.onDrop().bind(),gameObjects.draggedObj=this)}onMouseUp(){this.state===PRESS&&(this.setState(HOVER),this.onMouseUpFunc)&&this.onMouseUpFunc()}onDrop(){this.isDragged=!1,gameObjects.draggedObj=null,this.onDropFunc()}getPosX(){return this.getXPos()}getPosY(){return this.getYPos()}getScaleX(){return this.imageRefs[this.currImageRef].scaleX}getScaleY(){return this.imageRefs[this.currImageRef].scaleY}getXPos(){return this.normal.x}getYPos(){return this.normal.y}getWidth(){return this.imageRefs[this.currImageRef].width*this.imageRefs[this.currImageRef].scaleX}getHeight(){return this.imageRefs[this.currImageRef].height*this.imageRefs[this.currImageRef].scaleY}getState(){return this.state}getIsDragged(){return this.isDragged&&this.state!==DISABLE}setOnMouseDownFunc(e){this.onMouseDownFunc=e}setOnMouseUpFunc(e){this.onMouseUpFunc=e}setOnHoverFunc(e){this.onHover=e}setOnHoverOutFunc(e){this.onHoverOut=e}setNormalRef(e){this.normal.ref=e,this.state===NORMAL&&this.setState(NORMAL)}setHoverRef(e){this.hover.ref=e,this.state===HOVER&&this.setState(HOVER)}setHoverAlpha(e){this.hover.alpha=e}setPressRef(e){this.press.ref=e,this.state===PRESS&&this.setState(PRESS)}setDisableRef(e){this.disable.ref=e,this.state===DISABLE&&this.setState(DISABLE)}setAllRef(e){this.normal.ref=e,this.hover.ref=e,this.press.ref=e,this.disable.ref=e,this.setState(this.state)}setPos(e,a){if(void 0!==e)for(var t in this.normal.x=e,this.hover.x=e,this.press.x=e,this.disable.x=e,this.imageRefs)this.imageRefs[t].x=e;if(void 0!==a)for(var o in this.normal.y=a,this.hover.y=a,this.press.y=a,this.disable.y=a,this.imageRefs)this.imageRefs[o].y=a}setAlpha(e=1){for(var a in this.imageRefs)this.imageRefs[a].alpha=e}setScale(e,a){for(var t in void 0===a&&(a=e),this.imageRefs)this.imageRefs[t].scaleX=e,this.imageRefs[t].scaleY=a}bringToTop(){for(var e in this.imageRefs)this.container.bringToTop(this.imageRefs[e])}tweenScale(e){var a,t=[];for(a in this.imageRefs)t.push(this.imageRefs[a]);gameVarsTemp.updateTextAnim=gameObjects.scene.tweens.timeline({targets:t,tweens:[e]})}setOrigin(e,a){for(var t in this.imageRefs)this.imageRefs[t].setOrigin(e,a)}tweenToPos(e,a,t,o){o={targets:this.imageRefs[this.currImageRef],ease:o,duration:t,onComplete:()=>{this.setPos(e,a)}};void 0!==e&&(o.x=e),void 0!==a&&(o.y=a),globalScene.tweens.add(o)}disappear(){this.disappeared||(this.disappeared=!0,this.origX=this.normal.x,this.origY=this.normal.y,this.origScale=this.imageRefs[this.currImageRef].scaleX,this.setPos(0,-9999),this.setScale(.001))}reappear(){this.disappeared&&(this.disappeared=!1,void 0!==this.origX&&void 0!==this.origY&&this.setPos(this.origX,this.origY),void 0!==this.origScale)&&this.setScale(this.origScale)}runFuncOnImage(e){e(this.imageRefs[this.currImageRef])}update(){}destroy(){for(var e in gameObjects.buttonList)if(gameObjects.buttonList[e]===this){gameObjects.buttonList.splice(parseInt(e),1);break}for(var a in this.imageRefs)this.imageRefs[a].destroy()}}class Hand{constructor(e){this.baseScene=e,this.x=-999,this.y=-999,this.isGrabbing=!1,this.entity=null,this.visual=e.add.sprite(this.x,this.y,"hand"),this.visual.scaleX=.95,this.visual.scaleY=.95,this.visualPoint=e.add.sprite(this.x,this.y,"handPoint"),this.visualPoint.scaleX=1,this.visualPoint.scaleY=1,this.visualPoint.visible=!1,this.visual.setDepth(99999),this.visualPoint.setDepth(99999)}setPos(e,a){this.x=e,this.y=a}switchHand(){var e=this.visualPoint.scaleX,a=this.visualPoint.x,t=this.visualPoint.y,o=this.visualPoint.visible;this.visualPoint.destroy(),this.visualPoint=this.baseScene.add.sprite(this.x,this.y,"handPointBlood").setDepth(999999),this.visualPoint.scaleX=e,this.visualPoint.scaleY=e,this.visualPoint.x=a,this.visualPoint.y=t,this.visualPoint.visible=o}getPosX(){return this.x}getPosY(){return this.y}setDragging(e){this.entity=e}releaseDragging(){this.entity=null}getDragging(){return this.entity}setPointing(e){e?this.visual.visible&&(this.visual.visible=!1,this.visualPoint.visible=!0,this.visualPoint.scaleX=1.05,this.visualPoint.scaleY=1.05,setTimeout(()=>{this.visualPoint.scaleX=1.02,this.visualPoint.scaleY=1.02,setTimeout(()=>{this.visualPoint.scaleX=1,this.visualPoint.scaleY=1},100)},50)):this.visual.visible||(this.visual.visible=!0,this.visualPoint.visible=!1)}update(e){this.entity&&(a=this.x-this.entity.x,t=this.y-this.entity.y,Math.sqrt(a*a+t*t),a=.12*a-.3*this.entity.velX,t=.12*t-.3*this.entity.velY,this.entity.addVel(a,t));var a=this.x-this.visual.x,t=this.y-this.visual.y;this.visual.x=this.x+.2*a/e,this.visual.y=this.y+.2*t/e,this.visualPoint.x=this.x,this.visualPoint.y=this.y}}class Exhibit{constructor(e,a,t,o,s,m){this.scene=e,this.listOfBGs=[],this.listOfShadows=[],this.listOfForegrounds=[],this.listOfBtnCtnrs=[],this.listOfDarks=[],this.listOfLists=[this.listOfBGs,this.listOfShadows,this.listOfForegrounds,this.listOfBtnCtnrs,this.listOfDarks],this.listOfCantMove=[!1,!1],this.resetListOfCantMove(),this.currentScene=1,this.leftImage=null,this.centerImage=null,this.rightImage=null,this.bgContainer=a,this.shadowContainer=t,this.foregroundContainer=o,this.btnContainer=s,this.darkContainer=m,this.isMoving=!1,this.peekAmt=80,this.centerSpot=gameVars.halfWidth,this.leftSpot=-gameVars.halfWidth-this.peekAmt,this.rightSpot=gameVars.halfWidth+gameVars.width+this.peekAmt,gameVars.lateUpdateCurrentScene=1,messageBus.subscribe("exhibitMoveComplete",e=>{gameVars.lateUpdateCurrentScene=e})}initPos(e){this.currentScene=e;for(let e=0;e<this.listOfLists.length;e++){var a=this.listOfLists[e];a[this.currentScene]&&(this.centerImage=a[this.currentScene],this.centerImage.x=gameVars.halfWidth)}}moveLeft(){if(gameVarsTemp.hasMoved=!0,this.needCleanup)gameVarsTemp.needSecondClue?13===this.currentScene?updateInfoTextSoft("Unturn the handle",2e3):6===this.currentScene?updateInfoTextSoft("Unstretch her hand",2e3):5===this.currentScene?updateInfoTextSoft("Uncount the fingers",2e3):3===this.currentScene?updateInfoTextSoft("Turn off the tap",2e3):2===this.currentScene?updateInfoTextSoft("Deflate him",2e3):updateInfoTextSoft("Clean up the room first.",2250):(updateInfoTextSoft("Clean up the room first.",2250),setTimeout(()=>{gameVarsTemp.needSecondClue=!0},1e3));else if(gameVars.darkPoint&&3<=this.currentScene&&(this.needCleanup=!0),0<this.currentScene&&!this.isMoving){disableMoveButtons(),this.isMoving=!0;var a=this.currentScene;for(this.currentScene--;!this.listOfBGs[this.currentScene];)if(this.currentScene--,this.currentScene<0)return;messageBus.publish("exhibitMove",this.currentScene,a),messageBus.publish("exhibitMoveLeft",this.currentScene,a),gameObjects.exhibCntr.swayAccX=-.8;for(let e=0;e<this.listOfLists.length;e++){var t=this.listOfLists[e];this.shiftListLeft(t,this.currentScene,a,0===e)}gameObjects.flashDim.brightVal=.1}}shiftListLeft(e,a,t,o){var s=gameVars.walkSlow?3300:1500;this.centerImage=e[a],this.centerImage&&(this.centerImage.x=this.leftSpot,this.shiftAnimCenter=this.scene.tweens.timeline({targets:this.centerImage,tweens:[{ease:"Cubic.easeInOut",x:this.centerSpot,duration:s}]})),this.rightImage=e[t],this.rightImage&&(this.rightImage.x=this.centerSpot,this.shiftAnimRight=this.scene.tweens.timeline({targets:this.rightImage,tweens:[{ease:"Cubic.easeInOut",x:this.rightSpot,duration:s,onComplete:()=>{o&&(this.isMoving=!1,gameObjects.exhibCntr.swayAccX=-.08,gameObjects.exhibCntr.swayAccY=.05,gameObjects.exhibCntr.swayAmt=.025,messageBus.publish("exhibitMoveComplete",this.currentScene),this.listOfCantMove[a]?0!==a&&enableMoveLeftButton():(0===a?enableMoveRightButton:enableMoveButtons)())}}]}))}moveRight(a){if(gameVarsTemp.hasMoved=!0,this.currentScene<this.listOfBGs.length-1&&!this.isMoving){disableMoveButtons(),this.isMoving=!0;var t=this.currentScene;for(this.currentScene++;!this.listOfBGs[this.currentScene];)if(this.currentScene++,this.currentScene>=this.listOfBGs.length)return;messageBus.publish("exhibitMove",this.currentScene,t),messageBus.publish("exhibitMoveRight",this.currentScene,t),gameObjects.exhibCntr.swayAccX=.8;for(let e=0;e<this.listOfLists.length;e++){var o=this.listOfLists[e];this.shiftListRight(o,this.currentScene,t,0===e,a)}gameObjects.flashDim.brightVal=.1}}shiftListRight(e,a,t,o,s){let m=gameVars.walkSlow?3500:1500;s&&(m=1),this.centerImage=e[a],this.centerImage&&(this.centerImage.x=this.rightSpot,this.shiftAnimCenter=this.scene.tweens.timeline({targets:this.centerImage,tweens:[{ease:"Cubic.easeInOut",x:this.centerSpot,duration:m}]})),this.leftImage=e[t],this.leftImage&&(this.leftImage.x=this.centerSpot,this.shiftAnimRight=this.scene.tweens.timeline({targets:this.leftImage,tweens:[{ease:"Cubic.easeInOut",x:this.leftSpot,duration:m,onComplete:()=>{o&&(this.isMoving=!1,gameObjects.exhibCntr.swayAccX=s?.01:.08,gameObjects.exhibCntr.swayAccY=s?.01:.05,gameObjects.exhibCntr.swayAmt=.025,messageBus.publish("exhibitMoveComplete",this.currentScene),(this.listOfCantMove[a]?enableMoveLeftButton:enableMoveButtons)())}}]}))}setBackgroundAtIndex(e,a,t){a=this.scene.add.sprite(-9999,gameVars.halfHeight,a,t);this.bgContainer.add(a),this.listOfBGs[e]&&this.listOfBGs[e].destroy(),this.listOfBGs[e]=a,e===this.currentScene&&(this.listOfBGs[e].x=this.centerSpot)}setShadowAtIndex(e,a){a=this.scene.add.sprite(-9999,gameVars.halfHeight,a);this.shadowContainer.add(a),this.listOfShadows[e]&&this.listOfShadows[e].destroy(),this.listOfShadows[e]=a,e===this.currentScene&&(this.listOfShadows[e].x=this.centerSpot)}setForegroundAtIndex(e,a,t,o){o=o||gameVars.halfHeight,o=this.scene.add.sprite(-9999,o,a,t);o.setDepth(5),this.foregroundContainer.add(o),this.listOfForegrounds[e]&&this.listOfForegrounds[e].destroy(),this.listOfForegrounds[e]=o,e===this.currentScene&&(this.listOfForegrounds[e].x=this.centerSpot)}addBtnCtnrToIndex(e,a){a.x=-9999,this.btnContainer.add(a),this.listOfBtnCtnrs[e]&&this.currentScene===e&&(this.listOfBtnCtnrs[e].x=-9999),this.listOfBtnCtnrs[e]=a}removeBtnCtnrFromIndex(e){this.listOfBtnCtnrs[e]=[]}setDarkAtIndex(e,a){}removeDarkAtIndex(e){this.listOfDarks[e]&&this.listOfDarks[e].destroy()}removeIndex(e){this.listOfBGs[e]=null,this.listOfShadows[e]=null,this.listOfForegrounds[e]=null,this.listOfBtnCtnrs[e]=null,this.listOfDarks[e]=null}resetListOfCantMove(){this.listOfCantMove=[!1,!1,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!1,!0,!0,!0,!0]}setCantMoveIdx(e,a=!1){this.listOfCantMove[e]=a}getCurrentScene(){return this.currentScene}update(){}}function onPointerDown(e){gameVars.mousedown=!0;var e=mouseToHand(e.x,e.y),a=(gameVars.mouseposx=e.x,gameVars.mouseposy=e.y,e.x-gameObjects.exhibCntr.goalOffsetX),t=e.y-gameObjects.exhibCntr.goalOffsetY;gameVars.lastmousedown.x=e.x,gameVars.lastmousedown.y=e.y,gameObjects.hand.setPos(e.x,e.y);for(let e=gameObjects.buttonList.length-1;0<=e;e--){var o=gameObjects.buttonList[e];if(o.checkCoordOver(a,t)){o.onMouseDown(),gameObjects.lastObjMouseDowned=o;break}}}function onPointerMove(e){var a,t=mouseToHand(e.x,e.y);gameVars.mouseposx=t.x,gameVars.mouseposy=t.y,gameObjects.hand.setPos(t.x,t.y),gameObjects.maskImage&&(gameObjects.maskImage.goalX=t.x,gameObjects.maskImage.goalY=t.y),gameObjects.draggedObj&&gameVars.mousedown&&(t=gameVars.mouseposx-gameVars.lastmousedown.x,a=gameVars.mouseposy-gameVars.lastmousedown.y,3<=Math.sqrt(t*t+a*a))&&gameObjects.draggedObj.setPos(gameVars.mouseposx-gameVars.halfWidth,gameVars.mouseposy),gameObjects.exhibCntr.goalOffsetX=-.05*(e.x-gameVars.halfWidth),gameObjects.exhibCntr.goalOffsetY=-.03*(e.y-gameVars.halfHeight),gameObjects.loadingCntr.goalOffsetX=gameObjects.exhibCntr.goalOffsetX,gameObjects.loadingCntr.goalOffsetY=gameObjects.exhibCntr.goalOffsetY}function onPointerUp(e){gameVars.mousedown=!1;var e=mouseToHand(e.x,e.y),a=(gameVars.mouseposx=e.x,gameVars.mouseposy=e.y,e.x-gameObjects.exhibCntr.goalOffsetX),e=e.y-gameObjects.exhibCntr.goalOffsetY,t=gameObjects.lastObjMouseDowned;t&&t.checkCoordOver(a,e)&&t.onMouseUp(),gameObjects.draggedObj&&gameObjects.draggedObj.onDrop&&gameObjects.draggedObj.onDrop(),messageBus.publish("mouseUp")}function initGuideIndicators(e){gameObjects.guideArrow=e.add.image(0,-9999,"misc","arrow"),gameObjects.guideArrow.setOrigin(.01,.5),gameObjects.guideArrowFat=e.add.image(0,-9999,"misc","arrowFat"),gameObjects.guideArrowFat.setOrigin(.01,.5),gameObjects.guideSparkle=e.add.image(0,-999,"buttons","sparkle"),gameObjects.guideSparkle.animateState="SHRINK",gameObjects.guideSparkle.rotation=-1,gameObjects.guideSparkle.counter=0,gameObjects.guideSparkle.depth=99999,addToUpdateFuncList(animateSparkle)}function updateGuideArrow(e,a,t=0,o=200){gameObjects.guideArrow.x=e,gameObjects.guideArrow.y=a,gameObjects.guideArrow.rotation=t,gameObjects.guideArrow.scaleX=o/200,gameObjects.guideArrow.scaleY=o/200}function updateGuideArrowFat(e,a,t=0,o=200){gameObjects.guideArrowFat.x=e,gameObjects.guideArrowFat.y=a,gameObjects.guideArrowFat.rotation=t,gameObjects.guideArrowFat.scaleX=.95*o/200,gameObjects.guideArrowFat.scaleY=.95*o/200,setTimeout(()=>{gameObjects.guideArrowFat.scaleX=1.01*o/200,gameObjects.guideArrowFat.scaleY=1.01*o/200,setTimeout(()=>{gameObjects.guideArrowFat.scaleX=o/200,gameObjects.guideArrowFat.scaleY=o/200},50)},50)}function addGuideArrowToContainer(e){e.add(gameObjects.guideArrow)}function addGuideArrowFatToContainer(e){e.add(gameObjects.guideArrowFat)}function updateSparklePos(e,a){gameObjects.guideSparkle.x=e,gameObjects.guideSparkle.y=a,resetSparkle()}function resetSparkle(){gameObjects.guideSparkle.animateState="PAUSE",gameObjects.guideSparkle.scaleX=0,gameObjects.guideSparkle.scaleY=0,gameObjects.guideSparkle.counter=150}function animateSparkle(){}function setupRoomEntrance(e,a,t){gameObjects.exhibit.setForegroundAtIndex(1,"menu","welcome",gameVars.halfHeight-55),gameObjects.entrance={lines:[]},gameObjects.entrance.welcomeBtn=new Button(e,t,()=>{gameVars.horrorPoint&&!gameObjects.entrance.showedHorrorText?(gameObjects.entrance.showedHorrorText=!0,showInfoTextLoop([{text:"Welcome to the Exhibit of Smiles! :)",time:750},{text:"Welcome to the Exhibit of S̶m̵i̷l̸e̵s̵!! :)",time:100},{text:"Welcome to the Exhibit of S̶m̵i̷l̸e̵s̵!! :)",time:25},{text:"Welcome to the Exhibit of S̴o̵r̷r̷o̵w̴s̵!̶ :̵(",time:25},{text:"Welcome to the Exhibit of S̷̢͛m̷͕͒i̷̜̍l̵͓̏e̵̳̿s̵͈͒!̸͎̄ ̶̩͑:̶̛̣(̶͚͂",time:25},{text:"Welcome to the Exhibit of Smiles! :)",time:100},{text:"Welcome to the Exhibit of S̵o̶r̸r̷o̸w̸s̵!̴:|",time:50},{text:"Welcome to the Exhibit of Sorrows   ",time:1750}])):gameVars.horrorPoint?showInfoTextLoop([{text:"Welcome to the Exhibit of S̶m̵i̷l̸e̵s̵!! :)",time:100},{text:"Welcome to the Exhibit of Smiles! :)",time:200},{text:"Welcome to the Exhibit of S̴o̵r̷r̷o̵w̴s̵!̶ :̵(",time:50},{text:"Welcome to the Exhibit of Smiles! :)",time:100},{text:"Welcome to the Exhibit of S̵o̶r̸r̷o̸w̸s̵!̴:|",time:100},{text:"Welcome to the Exhibit of Sorrows   ",time:300},{text:"Welcome to the Exhibit of S̷̢͛m̷͕͒i̷̜̍l̵͓̏e̵̿s̵͈͒!̸͎̄",time:50},{text:" ",time:550}]):gameVarsTemp.brokeMusicBox?updateInfoText("Welcome to the Exhibit of Smiles."):updateInfoText("Welcome to the Exhibit of Smiles! :)")},{atlas:"menu",ref:"welcomeText",x:-6,y:gameVars.halfHeight-80,alpha:1},{atlas:"menu",ref:"welcomeTextGlow",preload:!0},{atlas:"menu",ref:"welcomeTextGlow",preload:!0},{atlas:"menu",ref:"welcomeText",preload:!0}),gameObjects.entrance.entryLights1=e.add.image(-3,gameVars.halfHeight-57,"menu","entrancelights1"),gameObjects.entrance.entryLights1.counter=0,gameObjects.entrance.entryLights1.status="brighten",gameObjects.entrance.entryLights2=e.add.image(-3,gameVars.halfHeight-57,"menu","entrancelights2"),gameObjects.entrance.entryLights1.alpha=0,gameObjects.entrance.entryLights2.alpha=0,t.add(gameObjects.entrance.entryLights1),t.add(gameObjects.entrance.entryLights2),gameObjects.entrance.creditsMenu=e.add.image(0,gameVars.halfHeight-55,"menu","credits"),gameObjects.entrance.creditsMenu.alpha=0,t.add(gameObjects.entrance.creditsMenu);var o=e.add.image(-490,-200,"blackPixel").setOrigin(.5,0).setScale(2,200),s=(t.add(o),gameObjects.entrance.lines.push(o),e.add.image(-270,-330,"blackPixel").setOrigin(.5,0).setScale(2,200)),m=(t.add(s),gameObjects.entrance.lines.push(s),e.add.image(-20,-280,"blackPixel").setOrigin(.5,0).setScale(2,200)),r=(t.add(m),gameObjects.entrance.lines.push(m),e.add.image(320,-190,"blackPixel").setOrigin(.5,0).setScale(2,200)),c=(t.add(r),gameObjects.entrance.lines.push(r),e.add.image(500,-310,"blackPixel").setOrigin(.5,0).setScale(2,200));let b=e.add.image(330,-300,"roomJack","doll").setRotation(-3.12).setScale(.8);t.add(b),setTimeout(()=>{globalScene.tweens.add({targets:b,x:305,y:65,rotation:-2.9,duration:750,ease:"Back.easeOut",onComplete:()=>{var e;1===gameObjects.exhibit.currentScene&&(e=playSound("nyaha",void 0,.05))&&(e.detune=-190),globalScene.tweens.add({targets:b,x:303,y:70,rotation:-2.88,duration:550,ease:"Cubic.easeInOut",onComplete:()=>{globalScene.tweens.add({delay:800,targets:b,x:370,y:-300,rotation:-2.8,duration:500,ease:"Back.easeIn",onComplete:()=>{b.destroy()}})}})}})},18e3),t.add(c),gameObjects.entrance.lines.push(c),gameObjectsTemp.starReplace=createStarButton(o,t,"star1",1),createStarButton(s,t,"star2",2),createStarButton(m,t,"star3",3),createStarButton(r,t,"star2",4),createStarButton(c,t,"star3",5),messageBus.subscribe("exhibitMove",e=>{1===e?gameVars.horrorPoint?gameObjectsTemp.entranceFlicker||(gameObjectsTemp.entranceFlicker=!0,setTimeout(()=>{gameObjects.generalDarkness.alpha=.04,setTimeout(()=>{gameObjects.generalDarkness.alpha=0,setTimeout(()=>{gameObjects.generalDarkness.alpha=.07,setTimeout(()=>{gameObjects.generalDarkness.alpha=0,gameVarsTemp.startDarkFlicker=!0},20)},1800)},150)},2400)):(tweenVolume("gladiator0",.85),gameVars.darkPoint&&(tweenVolume("gladiator1",0),tweenVolume("gladiator2",1))):0!==e||gameVars.horrorPoint||(tweenVolume("gladiator0",1),gameVars.darkPoint&&(tweenVolume("gladiator1",0,1500),tweenVolume("gladiator2",0,1500),setTimeout(()=>{gameObjects.musicBoxNote.alpha=0,gameObjects.musicBoxNote2.alpha=0,gameObjectsTemp.stoppedMusic=!0,gameObjects.sounds.gladiator1.stop(),gameObjects.sounds.gladiator2.stop()},1500)))})}function createStarButton(t,o,e,s){let m;return m=new Button(globalScene,o,()=>{var e,a;m.isAnimating||(m.isAnimating=!0,gameVars.horrorPoint&&(gameVarsTemp.pauseStarScare?gameVarsTemp.pauseStarScare=!1:(gameVarsTemp.pauseStarScare=!0,m.destroy(),e="shout"+s,a=globalScene.add.image(t.x,t.y+400,"menu","starx"+s),o.add(a),playDeathRattle(a),playSound(e))),m.tweenScale({scaleX:-1*m.getScaleX(),duration:700+300*Math.random(),ease:"Sine.easeInOut",onComplete:()=>{m.isAnimating=!1}}))},{atlas:"menu",ref:e,x:t.x,y:t.y+400},{atlas:"menu",ref:e})}function showInfoTextLoop(o,s=0,m=!0){if(0<o.length){m||playSound("lidslam");let e=o.shift(),a=s+e.time,t=3500-a;updateInfoText(e.text,t,m),setTimeout(()=>{showInfoTextLoop(o,a,m)},e.time)}}function playDeathRattle(e,a=0){globalScene.tweens.timeline({targets:e,tweens:[{scaleY:1.2,duration:40,ease:"Cubic.easeOut"},{scaleY:.8,duration:80,ease:"Cubic.easeInOut"},{scaleY:1.25,duration:80,ease:"Cubic.easeInOut"},{scaleY:.8,duration:80,ease:"Cubic.easeInOut"},{scaleY:1.25,duration:80,ease:"Cubic.easeInOut"},{scaleY:.8,duration:80,ease:"Cubic.easeInOut"},{scaleY:1.25,duration:80,ease:"Cubic.easeInOut",onComplete:()=>{e.destroy()}}]})}function setupRoomPump(e,a,t){gameObjects.exhibit.setBackgroundAtIndex(a,"bgs","bg2"),gameObjects.roomPumpObjs={canPump:!0,roomIndex:a,roomContainer:t,shouldUpdate:!1,pumpAmt:0,pumpCheckpoint:0,prevFloatyState:0,floatyGoalScaleX:1,floatyGoalScaleY:1,floatyGoalPosX:0,floatyGoalPosY:0,pressCooldown:0},gameObjects.roomPumpObjs.cleanupBtn=new Button(globalScene,gameObjects.roomPumpObjs.roomContainer,cleanupPump,{atlas:"buttons",ref:"glow",alpha:.05,x:0,y:-9999,scaleX:1.75,scaleY:1.75},{atlas:"buttons",ref:"glow",alpha:.8,scaleX:1.85,scaleY:1.8},{atlas:"buttons",ref:"glow",alpha:1,scaleX:1.85,scaleY:1.8}),gameObjects.roomPumpObjs.frames=e.add.image(0,245,"roomPump","framesFloaty1"),t.add(gameObjects.roomPumpObjs.frames),gameObjects.roomPumpObjs.frames.alpha=0,gameObjects.roomPumpObjs.pumpBtn=new Button(globalScene,gameObjects.roomPumpObjs.roomContainer,pumpReleased,{atlas:"buttons",ref:"glow",alpha:.05,x:-240,y:505,scaleX:1.6,scaleY:1},{atlas:"buttons",ref:"glow",alpha:.8,scaleX:1.7,scaleY:1.1},{atlas:"buttons",ref:"glow",alpha:.001,scaleX:1.7,scaleY:1.1}),gameObjects.roomPumpObjs.pumpBtn.setOnMouseDownFunc(pumpPressed),gameObjects.roomPumpObjs.extraGlow=e.add.image(-240,505,"buttons","glow"),gameObjects.roomPumpObjs.extraGlow.scaleX=1.95,gameObjects.roomPumpObjs.extraGlow.scaleY=1.45,gameObjects.roomPumpObjs.extraGlow.alpha=0,gameObjects.roomPumpObjs.roomContainer.add(gameObjects.roomPumpObjs.extraGlow),gameObjects.roomPumpObjs.placard=new Button(e,t,()=>{gameVars.horrorPoint?gameObjects.roomPumpObjs.roomComplete?updateInfoText("Pop."):updateInfoText("Mr. Floaty"):gameVars.darkPoint?updateInfoText("He liked balloons,\nhow they float, how they pop"):updateInfoText("Mr. Floaty")},{atlas:"buttons",ref:"placard",x:20,y:gameVars.height-100},{atlas:"buttons",ref:"placard_hover"}),gameObjects.roomPumpObjs.balloon1=e.add.image(-474,gameVars.height-135,"roomPump","balloonFloaty1"),gameObjects.roomPumpObjs.balloon1.rotation=-.02,gameObjects.roomPumpObjs.balloon1.setOrigin(.5,1),t.add(gameObjects.roomPumpObjs.balloon1),gameObjects.roomPumpObjs.balloon2=e.add.image(510,gameVars.height-139,"roomPump","balloonFloaty2"),gameObjects.roomPumpObjs.balloon2.rotation=.02,gameObjects.roomPumpObjs.balloon2.setOrigin(.5,1),t.add(gameObjects.roomPumpObjs.balloon2),gameObjects.roomPumpObjs.button=e.add.image(-240,492,"roomPump","button"),gameObjects.roomPumpObjs.pumplines=e.add.image(-240,415,"roomPump","pumplines").setVisible(!1),gameObjects.roomPumpObjs.button.origY=gameObjects.roomPumpObjs.button.y,t.add(gameObjects.roomPumpObjs.button),t.add(gameObjects.roomPumpObjs.pumplines),gameObjects.roomPumpObjs.fan=e.add.image(-240,621,"roomPump","fan"),gameObjects.roomPumpObjs.fan.rotVel=0,t.add(gameObjects.roomPumpObjs.fan),gameObjects.roomPumpObjs.hose=e.add.image(gameObjects.roomPumpObjs.fan.x+64,gameObjects.roomPumpObjs.fan.y+71,"roomPump","hose"),gameObjects.roomPumpObjs.hose.setOrigin(0,1),gameObjects.roomPumpObjs.hose.rotation=.15,gameObjects.roomPumpObjs.hose.baseRotation=gameObjects.roomPumpObjs.hose.rotation,gameObjects.roomPumpObjs.hose.scaleX=.85,gameObjects.roomPumpObjs.hose.scaleY=.85,t.add(gameObjects.roomPumpObjs.hose),gameObjects.roomPumpObjs.compressor=e.add.image(-240,621,"roomPump","compressor"),t.add(gameObjects.roomPumpObjs.compressor),addToUpdateFuncList(roomPumpUpdate),gameObjects.roomPumpObjs.floatyState=0;let o,s,m=gameVars.halfHeight+175;gameObjects.roomPumpObjs.floatyGoalPosX=135,gameObjects.roomPumpObjs.floatyGoalPosY=m,gameObjects.roomPumpObjs.floatySprites=[e.add.image(135,m,"roomPump","floaty1"),e.add.image(135,m,"roomPump","floaty2"),e.add.image(135,m,"roomPump","floaty3"),e.add.image(135,m,"roomPump","floaty4"),e.add.image(135,m,"roomPump","floaty5"),e.add.image(135,m,"roomPump","floaty6"),e.add.image(135,m,"roomPump","floaty7"),e.add.image(135,m,"roomPump","floatyX"),e.add.image(135,m,"roomPump","floatyY")];for(let e=0;e<gameObjects.roomPumpObjs.floatySprites.length;e++)gameObjects.roomPumpObjs.floatySprites[e].visible=!1,gameObjects.roomPumpObjs.floatySprites[e].setOrigin(.5,.55),t.add(gameObjects.roomPumpObjs.floatySprites[e]);gameObjects.roomPumpObjs.floaty=gameObjects.roomPumpObjs.floatySprites[0],gameObjects.roomPumpObjs.floaty.visible=!0,messageBus.subscribe("exhibitMove",e=>{e===a?setTimeout(()=>{gameObjects.roomPumpObjs.shouldUpdate=!0,setTimeout(()=>{gameObjects.roomPumpObjs.pumpAmt<8&&(gameObjects.roomPumpObjs.pumplines.visible=!0,setTimeout(()=>{gameObjects.roomPumpObjs.pumplines.visible=!1,setTimeout(()=>{gameObjects.roomPumpObjs.pumplines.visible=!0,setTimeout(()=>{gameObjects.roomPumpObjs.pumplines.visible=!1,setTimeout(()=>{gameObjects.roomPumpObjs.pumpAmt<20&&(gameObjects.roomPumpObjs.pumplines.visible=!0,setTimeout(()=>{gameObjects.roomPumpObjs.pumplines.visible=!1,setTimeout(()=>{gameObjects.roomPumpObjs.pumplines.visible=!0,setTimeout(()=>{gameObjects.roomPumpObjs.pumplines.visible=!1},350)},350)},350))},5e3)},350)},350)},350))},6e3)},0):setTimeout(()=>{gameObjects.roomPumpObjs.shouldUpdate=!1},600)}),messageBus.subscribe("mouseUp",pumpReleased),messageBus.subscribe("exhibitMove",e=>{e===a&&(gameVars.darkPoint&&(gameObjects.roomPumpObjs.frameKid=globalScene.add.image(-15,140,"roomPump","frameskid"),gameObjects.roomPumpObjs.frameKid.origX=gameObjects.roomPumpObjs.frameKid.x,gameObjects.roomPumpObjs.frameKid.origY=gameObjects.roomPumpObjs.frameKid.y,t.add(gameObjects.roomPumpObjs.frameKid),addToUpdateFuncList(frameKidUpdate)),gameVars.horrorPoint&&gameObjects.roomPumpObjs.pumpAmt<=.1&&globalScene.tweens.timeline({targets:[gameObjects.roomPumpObjs.extraGlow],tweens:[{alpha:1,duration:2e3,ease:"Quad.easeIn",delay:3e3},{alpha:0,duration:1500,ease:"Quad.easeOut"},{alpha:1,duration:2e3,ease:"Quad.easeIn",delay:3e3},{alpha:0,duration:1500,ease:"Quad.easeOut"}]}),tweenVolume("gladiator0",.5),tweenVolume("gladiator1",.35),tweenVolume("gladiator2",.75),gameObjects.roomPumpObjs.visitedOnce||(gameObjects.roomPumpObjs.visitedOnce=!0,gameObjects.roomPumpObjs.fan.rotVel+=.003,globalScene.tweens.timeline({targets:[gameObjects.roomPumpObjs.balloon1,gameObjects.roomPumpObjs.balloon2],tweens:[{rotation:0,duration:5e3,yoyo:!0,ease:"Sine.easeInOut"}]})))}),o=messageBus.subscribe("startDarkSequence",e=>{gameObjects.roomPumpObjs.cleanupBtn.setPos(gameObjects.roomPumpObjs.floaty.x,gameObjects.roomPumpObjs.floaty.y),gameObjects.roomPumpObjs.frames.alpha=1,o.unsubscribe()}),s=messageBus.subscribe("startHorrorSequence",e=>{removeFromUpdateFuncList(frameKidUpdate),gameObjects.roomPumpObjs.frameKid.isDestroyed||gameObjects.roomPumpObjs.frameKid.destroy(),gameObjects.roomPumpObjs.pumpBtn.reappear(),gameObjects.roomPumpObjs.pumpBtn.setPos(-240,500),gameObjects.roomPumpObjs.canPump=!0,s.unsubscribe()})}function roomPumpUpdate(t){if(gameObjects.roomPumpObjs.shouldUpdate){var e=(gameObjects.roomPumpObjs.buttonPressed||0<gameObjects.roomPumpObjs.buttonPressCarryOver)&&gameObjects.roomPumpObjs.canPump;if(e?(gameObjects.roomPumpObjs.buttonPressCarryOver-=t,gameObjects.roomPumpObjs.fan.rotVel+=.004*t,gameObjects.roomPumpObjs.button.y=Math.min(gameObjects.roomPumpObjs.button.origY+25,gameObjects.roomPumpObjs.button.y+10),gameObjects.roomPumpObjs.button.y>=gameObjects.roomPumpObjs.button.origY+25&&(gameObjects.roomPumpObjs.fan.rotVel+=.005*t)):gameObjects.roomPumpObjs.button.y=Math.max(gameObjects.roomPumpObjs.button.origY,gameObjects.roomPumpObjs.button.y-2),gameObjects.roomPumpObjs.fan.rotation+=gameObjects.roomPumpObjs.fan.rotVel,gameObjects.roomPumpObjs.fan.rotVel*=1-(1-.965)*(1+.8*(t-1)),.03<gameObjects.roomPumpObjs.fan.rotVel&&e){let e=2<gameObjects.roomPumpObjs.pressCooldown?.2:0,a=.43;100<gameObjects.roomPumpObjs.pumpAmt?gameObjects.roomPumpObjs.pumpAmt<=160?(a*=.7,e*=.7):gameObjects.roomPumpObjs.pumpAmt<=250&&(a*=.9,e*=.9):gameObjects.roomPumpObjs.pumpAmt<30&&(a*=1.1),gameObjects.roomPumpObjs.pumpAmt+=(a+e)*t}else gameObjects.roomPumpObjs.lastBreath||(gameObjects.roomPumpObjs.pumpAmt=Math.max(gameObjects.roomPumpObjs.pumpAmt-=t*gameVars.darkPoint?1:.2,gameObjects.roomPumpObjs.pumpCheckpoint));updateFloatyPumpState(gameObjects.roomPumpObjs.pumpAmt),4<gameObjects.roomPumpObjs.floatyState&&gameObjects.roomPumpObjs.floatyState<gameObjects.roomPumpObjs.floatySprites.length-1&&Math.random()<5e-4*gameObjects.roomPumpObjs.floatyState&&showStaticRand(Math.floor(Math.random()*gameObjects.roomPumpObjs.floatyState)),gameObjects.roomPumpObjs.floaty.scaleX=.9*gameObjects.roomPumpObjs.floaty.scaleX+.1*gameObjects.roomPumpObjs.floatyGoalScaleX,gameObjects.roomPumpObjs.floaty.scaleY=.9*gameObjects.roomPumpObjs.floaty.scaleY+.1*gameObjects.roomPumpObjs.floatyGoalScaleY,gameObjects.roomPumpObjs.floaty.x=.9*gameObjects.roomPumpObjs.floaty.x+.1*gameObjects.roomPumpObjs.floatyGoalPosX,gameObjects.roomPumpObjs.floaty.y=.9*gameObjects.roomPumpObjs.floaty.y+.1*gameObjects.roomPumpObjs.floatyGoalPosY,gameObjects.roomPumpObjs.pressCooldown=Math.max(0,gameObjects.roomPumpObjs.pressCooldown-t)}}function updateFloatyPumpState(a){var t=gameVars.halfHeight+175;if(a<4){var o=a/4;setFloatyGoalPos(135,t-2*o),setFloatyGoalScale(1,1+.02*o),gameObjects.roomPumpObjs.hose.rotation=gameObjects.roomPumpObjs.hose.baseRotation,0!==gameObjects.roomPumpObjs.floatyState&&(gameObjects.roomPumpObjs.floaty.scaleX=1.02,gameObjects.roomPumpObjs.floaty.scaleY=1.05),setFloatyState(0),gameVars.darkPoint||(gameObjects.roomPumpObjs.pumpCheckpoint=Math.max(gameObjects.roomPumpObjs.pumpCheckpoint,a-8))}else if(a<=100){o=Math.min(1,a/60);setFloatyGoalScale(.75+.26*o,.9+.12*o);let e=0;a<=50?setFloatyGoalPos(135,t+-10*o):setFloatyGoalPos(67.5+67.5*(1-(e=Math.sqrt((a-50)/50))),t-10+-200*e),gameObjects.roomPumpObjs.hose.rotation=.9*gameObjects.roomPumpObjs.hose.rotation+.1*(gameObjects.roomPumpObjs.hose.baseRotation-.6*e),1!==gameObjects.roomPumpObjs.floatyState&&(tweenVolume("gladiatorx",.25),gameObjects.roomPumpObjs.floaty.scaleX=.78,gameObjects.roomPumpObjs.floaty.scaleY=.92),setFloatyState(1),gameVars.darkPoint||(gameObjects.roomPumpObjs.pumpCheckpoint=Math.max(gameObjects.roomPumpObjs.pumpCheckpoint,a-10))}else if(gameObjects.roomPumpObjs.hose.rotation=.93*gameObjects.roomPumpObjs.hose.rotation+.07*(gameObjects.roomPumpObjs.hose.baseRotation-.54-6e-4*a),gameVars.horrorPoint||!gameObjects.roomPumpObjs.canPump||gameVars.darkPoint){if(gameVars.horrorPoint)if(gameObjects.roomPumpObjs.pumpCheckpoint=Math.max(gameObjects.roomPumpObjs.pumpCheckpoint,a-10),a<=150){setFloatyState(1);o=1-(150-a)/50;setFloatyGoalScale(1+.1*o,1+.04*o),setFloatyGoalPos(67.5,t-215-30*o)}else if(a<=200){o=1-(200-a)/50;1===gameObjects.roomPumpObjs.floatyState?(showStaticRand(1,void 0,void 0,.06),gameObjects.roomPumpObjs.floaty.scaleX=.95,gameObjects.roomPumpObjs.floaty.scaleY=.95,gameObjects.roomPumpObjs.pumpCheckpoint+=8,playSoundOnce("muffle1"),addFloatyShake(3),setTimeout(()=>{addFloatyShake(2)},0)):3===gameObjects.roomPumpObjs.floatyState&&(gameObjects.roomPumpObjs.floaty.scaleX=.98+.09*o,gameObjects.roomPumpObjs.floaty.scaleY=.98+.07*o),setFloatyState(2),setFloatyGoalScale(.98+.09*o,.98+.07*o),setFloatyGoalPos(67.5,t-245-10*o)}else if(a<270){let e=1-(270-a)/70;2===gameObjects.roomPumpObjs.floatyState?(showStaticRand(2,void 0,void 0,.1),showStaticLite(3,6,1),addFloatyShake(3),playSoundOnce("muffle2"),gameObjects.roomPumpObjs.floaty.scaleX=.89,gameObjects.roomPumpObjs.floaty.scaleY=.89,gameObjects.roomPumpObjs.pumpCheckpoint+=12):4===gameObjects.roomPumpObjs.floatyState&&(gameObjects.roomPumpObjs.floaty.scaleX=.9+.1*e,gameObjects.roomPumpObjs.floaty.scaleY=.9+.09*e),setFloatyState(3),addFloatyShake(1+e),setFloatyGoalPos(67.5,t-255-10*e),setFloatyGoalScale(.9+.1*e,.9+.09*e),gameObjects.roomPumpObjs.balloon1.rotation=-.01*e-.02,gameObjects.roomPumpObjs.balloon2.rotation=.01*e+.02,!gameObjects.roomPumpObjs.showOverblown1&&255<a&&(showStaticLite(1,7,1.5),setFloatyState(5),gameObjects.roomPumpObjs.floaty.scaleX=.78+.05*Math.random(),gameObjects.roomPumpObjs.floaty.scaleY=.78+.05*Math.random(),addFloatyShake(4,.2),setTimeout(()=>{gameObjects.roomPumpObjs.pumpCheckpoint=270,gameObjects.roomPumpObjs.showOverblown1=!0,setFloatyState(4),gameObjects.roomPumpObjs.floaty.scaleX=.9+.1*e,gameObjects.roomPumpObjs.floaty.scaleY=.9+.09*e},120))}else if(a<370){3===gameObjects.roomPumpObjs.floatyState&&(showStaticLite(6,10,1.5),showStaticRand(3,void 0,void 0,.15),addFloatyShake(3),playSoundOnce("muffle3"),gameObjects.roomPumpObjs.floaty.scaleX=.82,gameObjects.roomPumpObjs.floaty.scaleY=.84,gameObjects.roomPumpObjs.pumpCheckpoint+=15),setFloatyState(4);let e=1-(370-a)/100;!gameObjects.roomPumpObjs.showOverblown2&&355<a&&(showStaticLite(1,7,1.5),showStaticRand(1,void 0,void 0,.25),playSoundOnce("muffle4"),gameObjects.roomPumpObjs.pumpCheckpoint+=1,gameObjects.roomPumpObjs.randFlash1||(gameObjects.roomPumpObjs.randFlash1=!0,showAltReality(["balloon1","balloon2","balloon3","balloon4","balloon5"],1.02),playSound("rubber6"),gameObjects.sounds.pumpamb.play({loop:!0}),gameObjects.sounds.pumpamb.volume=.1,tweenVolume("pumpamb",.3,500)),setFloatyState(7),gameObjects.roomPumpObjs.floaty.scaleX=.7+.05*Math.random(),gameObjects.roomPumpObjs.floaty.scaleY=.68+.05*Math.random(),addFloatyShake(4,.6),setTimeout(()=>{gameObjects.roomPumpObjs.showOverblown2=!0,setFloatyState(4),gameObjects.roomPumpObjs.floaty.scaleX=.83+.1*e,gameObjects.roomPumpObjs.floaty.scaleY=.85+.08*e},200)),gameObjects.roomPumpObjs.balloon1.rotation=-.01*e-.03,gameObjects.roomPumpObjs.balloon2.rotation=.03+.01*e,addFloatyShake(2+e),setFloatyGoalPos(67.5,t-265-10*e),setFloatyGoalScale(.83+.1*e,.85+.08*e)}else if(a<470){setFloatyState(4);o=1-(470-a)/100;gameObjects.roomPumpObjs.balloon1.rotation=-.01*o-.04,gameObjects.roomPumpObjs.balloon2.rotation=.04+.01*o,addFloatyShake(3+o),setFloatyGoalScale(.93+.07*o,.93+.05*o),gameObjects.sounds.pumpamb.volume=.3+.7*o}else if(a<1e4){gameObjects.roomPumpObjs.lastBreath=!0,gameObjects.roomPumpObjs.pumpAmt+=1;o=1-(535-a)/20;if(playSoundOnce("muffle8"),setFloatyState(5),gameObjects.roomPumpObjs.floaty.scaleX=.75+.01*Math.random(),gameObjects.roomPumpObjs.floaty.scaleY=.75+.01*Math.random(),addFloatyShake(4,.05),gameObjects.roomPumpObjs.pumpCheckpoint+=10,535<a){if(!gameObjects.roomPumpObjs.roomComplete){playSound("splurt"),tweenVolume("gladiatorx",1),showFlashRand(12,void 0,()=>{showStaticRand(2,null,()=>{createKey(20,gameVars.halfHeight+240,gameObjects.roomPumpObjs.roomIndex,gameObjects.roomPumpObjs.roomContainer,!1),gameObjects.generalRedness.alpha=1})}),gameObjects.sounds.fan1.stop(),gameObjects.sounds.fan2.stop();for(let e=0;e<gameObjects.roomPumpObjs.floatySprites.length;e++)gameObjects.roomPumpObjs.floatySprites[e].destroy();gameObjects.roomPumpObjs.pumpBtn.destroy(),gameObjects.roomPumpObjs.hose.destroy(),pumpReleased(),gameObjects.scene.tweens.timeline({targets:gameObjects.roomPumpObjs.balloon1,tweens:[{rotation:-.08,duration:600,ease:"Cubic.easeOut"},{rotation:.02,duration:3e3,yoyo:!0,ease:"Sine.easeInOut"}]}),gameObjects.scene.tweens.timeline({targets:gameObjects.roomPumpObjs.balloon2,tweens:[{rotation:.08,duration:600,ease:"Cubic.easeOut"},{rotation:-.02,duration:3200,yoyo:!0,ease:"Sine.easeInOut"}]}),setTimeout(()=>{removeFromUpdateFuncList(roomPumpUpdate)},1e4),gameObjects.roomPumpObjs.roomComplete=!0,gameObjects.roomPumpObjs.frames.destroy(),gameObjects.roomPumpObjs.frames=globalScene.add.image(0,250,"roomPump","framesFloaty2"),gameObjects.roomPumpObjs.roomContainer.add(gameObjects.roomPumpObjs.frames)}}else 525<a?(setFloatyState(6),gameObjects.roomPumpObjs.floaty.scaleX=.75+.1*Math.random()+.1*o,gameObjects.roomPumpObjs.floaty.scaleY=.75+.04*Math.random()+.08*o):!gameObjects.roomPumpObjs.showOverblown3&&505<a&&(gameObjects.roomPumpObjs.showOverblown3=!0,tweenVolume("pumpamb",0),setTimeout(()=>{gameObjects.sounds.pumpamb.stop()}),showAltReality(["floaty1","floaty2","floaty3","floaty2","floaty4","floaty1"],1.02))}}else gameObjects.roomPumpObjs.canPump=!1,gameObjects.roomPumpObjs.pumpCheckpoint=100,gameObjects.roomPumpObjs.pumpBtn.disappear(),setFloatyGoalPos(67.5,t-215),setTimeout(()=>{createKey(-60,gameVars.halfHeight-130,gameObjects.roomPumpObjs.roomIndex,gameObjects.roomPumpObjs.roomContainer,!0)},300);o=Math.min(1,8*gameObjects.roomPumpObjs.fan.rotVel-.2);o<.02||gameObjects.roomPumpObjs.roomComplete?(gameObjects.sounds.fan1.isPlaying&&gameObjects.sounds.fan1.stop(),gameObjects.sounds.fan2.isPlaying&&gameObjects.sounds.fan2.stop()):(gameObjects.sounds.fan1.isPlaying||gameObjects.sounds.fan1.play({loop:!0}),gameObjects.sounds.fan2.isPlaying||gameObjects.sounds.fan2.play({loop:!0}),a<150?(gameObjects.sounds.fan1.volume=o,gameObjects.sounds.fan2.volume=0):a<300?(t=(a-150)/150,gameObjects.sounds.fan1.volume=(1-t)*o,gameObjects.sounds.fan2.volume=t*o*1.15):(gameObjects.sounds.fan1.volume=0,gameObjects.sounds.fan2.volume=1.15*o))}function pumpPressed(){0<gameObjects.roomPumpObjs.pressCooldown||(gameObjects.roomPumpObjs.buttonPressed=!0,gameObjects.roomPumpObjs.pressCooldown=20,playSound("airpump",void 0,.25),gameObjects.roomPumpObjs.buttonPressCarryOver=999999)}function pumpReleased(){gameObjects.roomPumpObjs.buttonPressed&&(gameObjects.roomPumpObjs.buttonPressed=!1,gameObjects.roomPumpObjs.buttonPressCarryOver=23)}function cleanupPump(){gameObjects.roomPumpObjs.cleanupBtn.destroy(),gameObjects.roomPumpObjs.pumpCheckpoint=0,gameObjects.exhibit.needCleanup=!1,setTimeout(()=>{playSound("deepbell5"),updateInfoTextSoft("Room cleaned up.",2250)},500)}function setFloatyState(e){var a,t,o,s;e!=gameObjects.roomPumpObjs.floatyState&&(gameObjects.roomPumpObjs.prevFloatyState=gameObjects.roomPumpObjs.floatyState,a=gameObjects.roomPumpObjs.floaty.x,t=gameObjects.roomPumpObjs.floaty.y,o=gameObjects.roomPumpObjs.floaty.scaleX,s=gameObjects.roomPumpObjs.floaty.scaleY,gameObjects.roomPumpObjs.floatyState=e,gameObjects.roomPumpObjs.floaty.visible=!1,gameObjects.roomPumpObjs.floaty=gameObjects.roomPumpObjs.floatySprites[gameObjects.roomPumpObjs.floatyState],gameObjects.roomPumpObjs.floaty.visible=!0,gameObjects.roomPumpObjs.floaty.x=a,gameObjects.roomPumpObjs.floaty.y=t,gameObjects.roomPumpObjs.floaty.scaleX=o,gameObjects.roomPumpObjs.floaty.scaleY=s)}function setFloatyGoalPos(e,a){gameObjects.roomPumpObjs.floatyGoalPosX=e,gameObjects.roomPumpObjs.floatyGoalPosY=a}function addFloatyShake(e,a=0){gameObjects.roomPumpObjs.floaty.x+=(Math.random()-.5)*e,gameObjects.roomPumpObjs.floaty.y+=(Math.random()-.5)*e,gameObjects.roomPumpObjs.floaty.rotation*=.2,gameObjects.roomPumpObjs.floaty.rotation+=(Math.random()-.5)*a}function setFloatyGoalScale(e,a){gameObjects.roomPumpObjs.floatyGoalScaleX=e,gameObjects.roomPumpObjs.floatyGoalScaleY=a}function frameKidUpdate(){var e=gameVars.mouseposx-gameObjects.roomPumpObjs.frameKid.x-gameVars.halfWidth,a=gameVars.mouseposy-gameObjects.roomPumpObjs.frameKid.y,e=Math.abs(e)+Math.abs(a),a=Math.max(0,Math.min(1,.005*(e-150)));gameObjects.roomPumpObjs.frameKid.alpha=.9985*gameObjects.roomPumpObjs.frameKid.alpha+.0015*a,gameObjects.roomPumpObjs.frameKid.x=gameObjects.roomPumpObjs.frameKid.origX+3*Math.random()-1.5,gameObjects.roomPumpObjs.frameKid.y=gameObjects.roomPumpObjs.frameKid.origY+3*Math.random()-1.5,gameObjects.roomPumpObjs.frameKid.alpha<.95&&(removeFromUpdateFuncList(frameKidUpdate),gameObjects.roomPumpObjs.frameKid.destroy(),gameObjects.roomPumpObjs.frameKid.isDestroyed=!0)}function setupRoomFaucet(e,a,t){let o,s;gameObjects.exhibit.setBackgroundAtIndex(a,"bgs","bg3"),gameObjects.roomFaucetObjs={roomIndex:a,roomContainer:t,rotAccumulate:-4,overflowAmt:0,soundCooldown:0,leverLength:230,guideArrowNeedsReset:!1,arrowDistDelay:0,arrowAccumulateBump:0,dollImages:[],redDamper:0},gameObjects.roomFaucetObjs.container=t,setWashyDollImage("washyHappy"),setWashyDollImage("washyDrowned"),setWashyDollImage("washyNeutral"),setWashyDollImage("washyWorried"),setWashyDollImage("washyRelaxed"),setupFaucetInk(),gameObjects.roomFaucetObjs.pipe1=e.add.image(-545,161,"roomFaucet","pipe1"),gameObjects.roomFaucetObjs.pipe2=e.add.image(-425,300,"roomFaucet","pipe2"),gameObjects.roomFaucetObjs.pipe3=e.add.image(-305,90,"roomFaucet","pipe3"),gameObjects.roomFaucetObjs.pipe4=e.add.image(-88,70,"roomFaucet","pipe4"),t.add(gameObjects.roomFaucetObjs.pipe1),t.add(gameObjects.roomFaucetObjs.pipe2),t.add(gameObjects.roomFaucetObjs.pipe3),t.add(gameObjects.roomFaucetObjs.pipe4),gameObjects.roomFaucetObjs.portrait=e.add.image(200,142,"roomFaucet","portrait"),gameObjects.roomFaucetObjs.portraitRed=e.add.image(gameObjects.roomFaucetObjs.portrait.x,gameObjects.roomFaucetObjs.portrait.y,"roomFaucet","portraitRed"),gameObjects.roomFaucetObjs.portraitRed.alpha=0,t.add(gameObjects.roomFaucetObjs.portrait),t.add(gameObjects.roomFaucetObjs.portraitRed),gameObjects.roomFaucetObjs.duck=e.add.image(310,gameVars.height-20,"roomFaucet","duck"),gameObjects.roomFaucetObjs.duck.setOrigin(.5,1),gameObjects.roomFaucetObjs.duck.scaleX=.45,gameObjects.roomFaucetObjs.duck.scaleY=.45,t.add(gameObjects.roomFaucetObjs.duck),gameObjects.roomFaucetObjs.hose=e.add.image(164,-50,"roomFaucet","hose"),gameObjects.roomFaucetObjs.hose.setOrigin(.5,0),gameObjects.roomFaucetObjs.hose.origX=gameObjects.roomFaucetObjs.hose.x,gameObjects.roomFaucetObjs.hose.origY=gameObjects.roomFaucetObjs.hose.y,gameObjects.roomFaucetObjs.hose.velX=0,gameObjects.roomFaucetObjs.hose.velY=0,t.add(gameObjects.roomFaucetObjs.hose),gameObjects.roomFaucetObjs.handle=new Button(e,{container:t,normal:{atlas:"buttons",ref:"glow",x:0,scaleX:1.15,scaleY:1.15,y:gameVars.halfHeight,alpha:.001},hover:{atlas:"buttons",ref:"glow",alpha:.7},isDraggable:!0,onDrop:dropHandle}),gameObjects.roomFaucetObjs.placard=new Button(e,t,()=>{gameVars.horrorPoint?gameObjects.roomFaucetObjs.roomCompleted?updateInfoText("Faucet out of order"):updateInfoText("Mr. Washy"):gameVars.darkPoint?updateInfoText("Just a gentle rinse"):updateInfoText("Mr. Washy")},{atlas:"buttons",ref:"placard",x:380,y:gameVars.height-240},{atlas:"buttons",ref:"placard_hover"}),gameObjects.roomFaucetObjs.lever=e.add.image(gameObjects.roomFaucetObjs.hose.x-111,gameVars.halfHeight-39,"roomFaucet","lever"),t.add(gameObjects.roomFaucetObjs.lever),gameObjects.roomFaucetObjs.lever.rotation=-.73,gameObjects.roomFaucetObjs.lever.rotVel=0,gameObjects.roomFaucetObjs.waterCounter=1,gameObjects.roomFaucetObjs.freeDropletPool=[],gameObjects.roomFaucetObjs.activeDroplets=[],gameObjects.roomFaucetObjs.dragline=e.add.sprite(0,-9999,"blackPixel"),gameObjects.roomFaucetObjs.dragline.scaleY=20,gameObjects.roomFaucetObjs.handle.offsetY=0,resetHandlePos(),addToUpdateFuncList(roomFaucetUpdate),messageBus.subscribe("exhibitMove",e=>{e===a&&(gameVars.darkPoint&&(addToUpdateFuncList(faucetRedUpdate),globalScene.tweens.add({targets:gameObjects.roomFaucetObjs.duck,x:280,ease:"Quad.easeOut",duration:400,delay:1500})),addGuideArrowToContainer(gameObjects.roomFaucetObjs.roomContainer),updateGuideArrow(0,-9999),tweenVolume("gladiator0",.3),tweenVolume("gladiator1",.6),tweenVolume("gladiator2",.5))}),o=messageBus.subscribe("startDarkSequence",e=>{gameObjects.roomFaucetObjs.isLocked=!1,gameObjects.roomFaucetObjs.handle.reappear(),resetHandlePos(),gameObjects.roomFaucetObjs.portraitRed.alpha=1,o.unsubscribe()}),s=messageBus.subscribe("startHorrorSequence",e=>{gameObjects.roomFaucetObjs.isLocked=!1,gameObjects.roomFaucetObjs.handle.reappear(),resetHandlePos(),gameObjects.roomFaucetObjs.firstComplete=!0,removeFromUpdateFuncList(faucetRedUpdate),gameObjects.roomFaucetObjs.portraitRed.destroy(),s.unsubscribe()})}function setupFaucetInk(){gameObjects.roomFaucetObjs.ink=globalScene.add.image(-160,gameVars.halfHeight+99,"roomFaucet","ink1"),gameObjects.roomFaucetObjs.ink.origX=gameObjects.roomFaucetObjs.ink.x,gameObjects.roomFaucetObjs.ink.setOrigin(.5,0),gameObjects.roomFaucetObjs.ink.alpha=0,gameObjects.roomFaucetObjs.roomContainer.add(gameObjects.roomFaucetObjs.ink)}function roomFaucetUpdate(c){let b=!1;if(!gameObjects.roomFaucetObjs.handle.getIsDragged()||gameObjects.roomFaucetObjs.roomCompleted||gameObjects.roomFaucetObjs.isLocked)gameObjects.roomFaucetObjs.guideArrowNeedsReset&&(gameObjects.roomFaucetObjs.guideArrowNeedsReset=!1,resetGuideArrowFaucet());else{gameObjects.roomFaucetObjs.soundCooldown--;let e=gameObjects.roomFaucetObjs.handle.getXPos(),a=gameObjects.roomFaucetObjs.handle.getYPos()-gameObjects.roomFaucetObjs.handle.offsetY,t=e-gameObjects.roomFaucetObjs.lever.x,o=a-gameObjects.roomFaucetObjs.lever.y,s=Math.atan2(o,t)+.5*Math.PI,m=(s>Math.PI&&(s-=2*Math.PI),s-gameObjects.roomFaucetObjs.lever.rotation),r=(m>Math.PI?m-=2*Math.PI:m<-Math.PI&&(m+=2*Math.PI),0);.01<m?r=Math.min(.0024,.006*m):m<-.01&&(r=Math.max(-.0024,.006*m)),gameVars.horrorPoint&&r<0&&.8<gameObjects.roomFaucetObjs.lever.rotation&&(r=0),gameObjects.roomFaucetObjs.lever.rotVel+=r,gameObjects.roomFaucetObjs.lever.rotVel*=.88,b=!0,Math.abs(gameObjects.roomFaucetObjs.lever.rotation+.2)<.03&&gameObjects.roomFaucetObjs.soundCooldown<=0&&(.005<gameObjects.roomFaucetObjs.lever.rotVel?(playSound("metalsqueak1"),gameObjects.roomFaucetObjs.soundCooldown=50):gameObjects.roomFaucetObjs.lever.rotVel<-.005&&(playSound("metalsqueak2"),gameObjects.roomFaucetObjs.soundCooldown=50),gameObjects.roomFaucetObjs.lever.rotVel*=.5),gameObjects.roomFaucetObjs.lever.rotation<-.75?(gameVars.darkPoint&&gameObjects.exhibit.needCleanup&&(gameObjects.exhibit.needCleanup=!1,gameObjects.roomFaucetObjs.isLocked=!0,gameObjects.roomFaucetObjs.handle.disappear(),setWashyDollImage("washyRelaxed"),setTimeout(()=>{playSound("deepbell4"),updateInfoTextSoft("Room cleaned up.",2e3)},300)),gameObjects.roomFaucetObjs.lever.rotation=-.74,gameObjects.roomFaucetObjs.lever.rotVel*=-.35):.001<gameObjects.roomFaucetObjs.lever.rotVel&&.78<gameObjects.roomFaucetObjs.lever.rotation&&!gameObjects.roomFaucetObjs.firstComplete&&!gameVars.horrorPoint&&!gameVars.darkPoint?(gameObjects.roomFaucetObjs.handle.disappear(),gameObjects.roomFaucetObjs.firstComplete=!0,gameObjects.roomFaucetObjs.isLocked=!0,gameObjects.roomFaucetObjs.lever.rotation=.799,setTimeout(()=>{createKey(-365,gameVars.halfHeight+85,gameObjects.roomFaucetObjs.roomIndex,gameObjects.roomFaucetObjs.roomContainer,!0)},100)):.8<gameObjects.roomFaucetObjs.lever.rotation&&(gameVars.horrorPoint?.002<gameObjects.roomFaucetObjs.lever.rotVel&&(l=.01*(2+gameObjects.roomFaucetObjs.lever.rotation+gameObjects.roomFaucetObjs.rotAccumulate),Math.random()<l*c)&&(gameObjects.roomFaucetObjs.rotAccumulate=-3.25,Math.random()<.75*gameObjects.roomFaucetObjs.lever.rotation-.75?(gameObjects.roomFaucetObjs.soundCooldown<=0&&(playSound("metalgrind",4),gameObjects.roomFaucetObjs.soundCooldown=45),1.2<gameObjects.roomFaucetObjs.lever.rotation&&!gameObjects.roomFaucetObjs.usingBentLever&&(gameObjects.roomFaucetObjs.usingBentLever=!0,gameObjects.roomFaucetObjs.lever.alpha=0,gameObjects.roomFaucetObjs.leverBent=globalScene.add.image(gameObjects.roomFaucetObjs.lever.x,gameObjects.roomFaucetObjs.lever.y,"roomFaucet","leverhalfbroken"),gameObjects.roomFaucetObjs.roomContainer.add(gameObjects.roomFaucetObjs.leverBent)),gameObjects.roomFaucetObjs.lever.rotVel=Math.max(.03,.16-.025*gameObjects.roomFaucetObjs.lever.rotation),gameObjects.roomFaucetObjs.lever.rotation<2.5&&showFlashRand(1,void 0,void 0,.4*(gameObjects.roomFaucetObjs.lever.rotation-1))):(gameObjects.roomFaucetObjs.soundCooldown<=0&&(playSound("metalsqueak1"),gameObjects.roomFaucetObjs.soundCooldown=30),gameObjects.roomFaucetObjs.lever.rotVel=Math.max(.015,.07-.025*gameObjects.roomFaucetObjs.lever.rotation),gameObjects.roomFaucetObjs.lever.rotation<2.5&&showStaticRand(1,void 0,void 0,.45*(gameObjects.roomFaucetObjs.lever.rotation-1))),createExtraDrops(2)):(gameObjects.roomFaucetObjs.lever.rotation=.785,gameObjects.roomFaucetObjs.lever.rotVel*=-.12),gameObjects.roomFaucetObjs.rotAccumulate+=.016,gameObjects.roomFaucetObjs.lever.rotVel*=Math.max(1.6-gameObjects.roomFaucetObjs.lever.rotation,.43)),updateGuideArrowFaucet(),.63<gameObjects.roomFaucetObjs.lever.rotation&&(gameObjects.roomFaucetObjs.arrowAccumulateBump+=.02,1<gameObjects.roomFaucetObjs.arrowAccumulateBump)&&updateGuideArrowFaucet(!(gameObjects.roomFaucetObjs.arrowAccumulateBump=0)),updateWashyExpression(gameObjects.roomFaucetObjs.lever.rotation),gameObjects.roomFaucetObjs.guideArrowNeedsReset=!0}var e,l,a,t;-.5<gameObjects.roomFaucetObjs.lever.rotation&&(l=Math.max(0,7*(gameObjects.roomFaucetObjs.lever.rotation+.35)),2.8<gameObjects.roomFaucetObjs.lever.rotation?(shakeBGPipes(12),gameObjects.roomFaucetObjs.roomCompleted||(gameObjects.roomFaucetObjs.duck.scaleX=-.45,e=gameObjects.roomFaucetObjs.portrait.x,a=gameObjects.roomFaucetObjs.portrait.y,gameObjects.roomFaucetObjs.portrait.destroy(),gameObjects.roomFaucetObjs.portrait=globalScene.add.image(e,a,"roomFaucet","portraitBlack"),gameObjects.roomFaucetObjs.roomContainer.add(gameObjects.roomFaucetObjs.portrait),gameObjects.roomFaucetObjs.ink.alpha=1,gameObjects.sounds.watergurgle.play({loop:!0}),messageBus.subscribe("exhibitMove",e=>{e=Math.abs(e-gameObjects.roomFaucetObjs.roomIndex);tweenVolume("watergurgle",Math.max(0,1/(1+e*e*.6)-.22))}),gameObjects.roomFaucetObjs.hose.destroy(),e=gameObjects.roomFaucetObjs.hose.origX,a=gameObjects.roomFaucetObjs.hose.origY,gameObjects.roomFaucetObjs.hose=globalScene.add.image(e,a,"roomFaucet","hosebroken"),gameObjects.roomFaucetObjs.hose.origX=e,gameObjects.roomFaucetObjs.hose.origY=a,gameObjects.roomFaucetObjs.hose.setOrigin(.5,0),gameObjects.roomFaucetObjs.roomContainer.add(gameObjects.roomFaucetObjs.hose),gameObjects.roomFaucetObjs.lever.rotation=2.65,gameObjects.roomFaucetObjs.handle.destroy(),e=gameObjects.roomFaucetObjs.lever.x,a=gameObjects.roomFaucetObjs.lever.y,gameObjects.roomFaucetObjs.leverBent.destroy(),gameObjects.roomFaucetObjs.leverBent=globalScene.add.image(e,a,"roomFaucet","leverbroken"),gameObjects.roomFaucetObjs.roomContainer.add(gameObjects.roomFaucetObjs.leverBent),showFlashArr([0,5,15,6,15,16,2,16,16,7,0],()=>{showStaticRand(5),setTimeout(()=>{showStaticRand(2),setTimeout(()=>{showStaticRand(1,void 0,void 0,.05)},750)},750)}),gameVars.walkSlow=!0,gameObjects.roomFaucetObjs.roomCompleted=!0,updateWashyExpression(999),setTimeout(()=>{gameObjects.roomFaucetObjs.startOverflow=!0},600),setTimeout(()=>{createKey(-155,gameVars.halfHeight+160,gameObjects.roomFaucetObjs.roomIndex,gameObjects.roomFaucetObjs.roomContainer,!1)},1500)),e=3*(Math.random()-.5),a=1.5*(Math.random()-.5),gameObjects.roomFaucetObjs.hose.x=gameObjects.roomFaucetObjs.hose.origX+e,gameObjects.roomFaucetObjs.hose.y=gameObjects.roomFaucetObjs.hose.origY+a,gameObjects.roomFaucetObjs.lever.x=gameObjects.roomFaucetObjs.hose.x-111+e,gameObjects.roomFaucetObjs.lever.y=gameVars.halfHeight-39+a,gameObjects.roomFaucetObjs.lever.rotation=3,gameObjects.roomFaucetObjs.ink.x=gameObjects.roomFaucetObjs.ink.origX+.4*e,updateInk()):(l<13&&(gameObjects.roomFaucetObjs.waterCounter-=l,gameObjects.roomFaucetObjs.waterCounter<=0)&&(gameObjects.roomFaucetObjs.waterCounter=100,createWaterDrop()),9<l&&(shakeBGPipes(l),a=l-9,e=(Math.random()-.5)*a*.6,l=(Math.random()-.5)*a*.3,a=gameObjects.roomFaucetObjs.hose.origX-gameObjects.roomFaucetObjs.hose.x,t=gameObjects.roomFaucetObjs.hose.origY-gameObjects.roomFaucetObjs.hose.y,gameObjects.roomFaucetObjs.lever.x=gameObjects.roomFaucetObjs.hose.x-111-a,gameObjects.roomFaucetObjs.lever.y=gameVars.halfHeight-39-t,gameObjects.roomFaucetObjs.hose.velX+=e+.65*a,gameObjects.roomFaucetObjs.hose.velY+=l+.65*t,gameObjects.roomFaucetObjs.hose.velX*=.6,gameObjects.roomFaucetObjs.hose.velY*=.6,gameObjects.roomFaucetObjs.hose.x+=gameObjects.roomFaucetObjs.hose.velX,gameObjects.roomFaucetObjs.hose.y+=gameObjects.roomFaucetObjs.hose.velY,gameObjects.roomFaucetObjs.lever.x+=.75*gameObjects.roomFaucetObjs.hose.velX,gameObjects.roomFaucetObjs.lever.y+=.5*gameObjects.roomFaucetObjs.hose.velY)));for(let e=0;e<gameObjects.roomFaucetObjs.activeDroplets.length;e++){var o=gameObjects.roomFaucetObjs.activeDroplets[e];o.velY+=.1,o.y+=o.velY*c,o.y>gameVars.halfHeight+208&&(o.y=-9999,gameObjects.roomFaucetObjs.activeDroplets.splice(e,1),gameObjects.roomFaucetObjs.freeDropletPool.push(o))}b&&(gameObjects.roomFaucetObjs.lever.rotation+=gameObjects.roomFaucetObjs.lever.rotVel*c),gameObjects.roomFaucetObjs.leverBent&&(gameObjects.roomFaucetObjs.leverBent.x=gameObjects.roomFaucetObjs.lever.x,gameObjects.roomFaucetObjs.leverBent.y=gameObjects.roomFaucetObjs.lever.y,gameObjects.roomFaucetObjs.leverBent.rotation=gameObjects.roomFaucetObjs.lever.rotation)}function updateInk(){gameObjects.roomFaucetObjs.ink.scaleX=.995+.01*Math.random()}function createWaterDrop(){let e=gameObjects.roomFaucetObjs.freeDropletPool.pop();e||((e=globalScene.add.image(0,0,"roomFaucet","waterdrop")).setDepth(5),gameObjects.roomFaucetObjs.container.add(e)),e.scaleX=.85,setTimeout(()=>{e.scaleX=.95,setTimeout(()=>{e.scaleX=1},30)},30),e.velY=.4,e.x=gameObjects.roomFaucetObjs.hose.x-360+90*Math.random(),e.y=gameObjects.roomFaucetObjs.hose.y+624,gameObjects.roomFaucetObjs.activeDroplets.push(e)}function dropHandle(){resetHandlePos()}function resetHandlePos(){var e=gameObjects.roomFaucetObjs.lever.x,a=gameObjects.roomFaucetObjs.lever.y,t=gameObjects.roomFaucetObjs.lever.rotation-.5*Math.PI,e=e+Math.cos(t)*gameObjects.roomFaucetObjs.leverLength,a=a+Math.sin(t)*gameObjects.roomFaucetObjs.leverLength+gameObjects.roomFaucetObjs.handle.offsetY;gameObjects.roomFaucetObjs.handle.setPos(e,a)}function updateGuideArrowFaucet(e){let a=gameObjects.roomFaucetObjs.lever.x,t=gameObjects.roomFaucetObjs.lever.y,o=gameObjects.roomFaucetObjs.lever.rotation-.5*Math.PI,s=a+Math.cos(o)*(gameObjects.roomFaucetObjs.leverLength+7),m=t+Math.sin(o)*(gameObjects.roomFaucetObjs.leverLength+7)+gameObjects.roomFaucetObjs.handle.offsetY,r=gameVars.mouseposx-s-gameVars.halfWidth,c=gameVars.mouseposy-m,b=Math.min(150,Math.sqrt(r*r+c*c));b<35?b=0:70<b&&e&&(b+=20),gameObjects.roomFaucetObjs.arrowDistDelay=.6*gameObjects.roomFaucetObjs.arrowDistDelay+.4*b,updateGuideArrow(s,m,Math.atan2(c,r),gameObjects.roomFaucetObjs.arrowDistDelay)}function resetGuideArrowFaucet(){updateGuideArrow(0,-9999),gameObjects.roomFaucetObjs.arrowDistDelay=0}function createExtraDrops(a){for(let e=0;e<a;e++)createWaterDrop();setTimeout(()=>{createExtraDrops(a-1)},25)}function setWashyDollImage(e){if(gameObjects.roomFaucetObjs.doll){if(gameObjects.roomFaucetObjs.doll==gameObjects.roomFaucetObjs.dollImages[e])return;gameObjects.roomFaucetObjs.doll.visible=!1}var a;gameObjects.roomFaucetObjs.dollImages[e]||(a=globalScene.add.image(-145,gameVars.height-163,"roomFaucet",e),gameObjects.roomFaucetObjs.dollImages[e]=a,gameObjects.roomFaucetObjs.roomContainer.add(a)),gameObjects.roomFaucetObjs.dollImages[e].visible=!0,gameObjects.roomFaucetObjs.doll=gameObjects.roomFaucetObjs.dollImages[e],bounceWashyDoll()}function bounceWashyDoll(){gameObjects.roomFaucetObjs.doll.scaleY=1.008,setTimeout(()=>{gameObjects.roomFaucetObjs.doll.scaleY=1.004,setTimeout(()=>{gameObjects.roomFaucetObjs.doll.scaleY=1},40)},50)}function updateWashyExpression(e){!gameObjects.roomFaucetObjs.firstComplete||gameVars.darkPoint||gameVars.horrorPoint?gameObjects.roomFaucetObjs.roomCompleted?setWashyDollImage("washyDrowned"):setWashyDollImage(e<-.25?"washyRelaxed":e<1.6?"washyNeutral":"washyWorried"):setWashyDollImage("washyHappy")}function shakeBGPipes(e){var a;9<e&&(a=.5*(e-9),gameObjects.roomFaucetObjs.pipe1.x=Math.random()*a-545,gameObjects.roomFaucetObjs.pipe1.y=161+Math.random()*a),10<e&&(a=.5*(e-9),gameObjects.roomFaucetObjs.pipe2.x=Math.random()*a-425,gameObjects.roomFaucetObjs.pipe2.y=300+Math.random()*a),11<e&&(a=.5*(e-9),gameObjects.roomFaucetObjs.pipe3.x=Math.random()*a-305,gameObjects.roomFaucetObjs.pipe3.y=90+Math.random()*a),11.5<e&&(a=.5*(e-9),gameObjects.roomFaucetObjs.pipe4.x=Math.random()*a-88,gameObjects.roomFaucetObjs.pipe4.y=70+Math.random()*a)}function faucetRedUpdate(){var e=gameVars.mouseposx-gameObjects.roomFaucetObjs.portraitRed.x-gameVars.halfWidth,a=gameVars.mouseposy-gameObjects.roomFaucetObjs.portraitRed.y,e=Math.abs(e)+Math.abs(a),a=Math.max(0,Math.min(1,.003*(e-70-gameObjects.roomFaucetObjs.redDamper)));a>gameObjects.roomFaucetObjs.portraitRed.alpha?(gameObjects.roomFaucetObjs.portraitRed.alpha=.95*gameObjects.roomFaucetObjs.portraitRed.alpha+.05*a,gameObjects.roomFaucetObjs.portraitRed.alpha<.85&&(gameObjects.roomFaucetObjs.redDamper+=.8)):gameObjects.roomFaucetObjs.portraitRed.alpha=.88*gameObjects.roomFaucetObjs.portraitRed.alpha+.12*a}function setupRoomHandy(e,a,t){gameObjects.exhibit.setBackgroundAtIndex(a,"bgs","bg5");let o,s,m=[{x:-420,y:gameVars.halfHeight-80,arrOffX:-30,arrOffY:10,arrOffRot:-.15},{x:-355,y:gameVars.halfHeight-135,arrOffX:0,arrOffY:0,arrOffRot:0},{x:-260,y:gameVars.halfHeight-160,arrOffX:0,arrOffY:0,arrOffRot:0},{x:-195,y:gameVars.halfHeight-100,arrOffX:55,arrOffY:20,arrOffRot:.35},{x:195,y:gameVars.halfHeight-100,arrOffX:-55,arrOffY:20,arrOffRot:-.35},{x:260,y:gameVars.halfHeight-160,arrOffX:0,arrOffY:0,arrOffRot:0},{x:355,y:gameVars.halfHeight-135,arrOffX:0,arrOffY:0,arrOffRot:0},{x:420,y:gameVars.halfHeight-80,arrOffX:80,arrOffY:40,arrOffRot:.55},{x:-470,y:gameVars.halfHeight-115,arrOffX:-35,arrOffY:10,arrOffRot:-.25},{x:-390,y:gameVars.halfHeight-195,arrOffX:0,arrOffY:0,arrOffRot:0},{x:-270,y:gameVars.halfHeight-205,arrOffX:0,arrOffY:0,arrOffRot:0},{x:-140,y:gameVars.halfHeight-120,arrOffX:45,arrOffY:15,arrOffRot:.3},{x:140,y:gameVars.halfHeight-120,arrOffX:-45,arrOffY:15,arrOffRot:-.3},{x:260,y:gameVars.halfHeight-230,arrOffX:0,arrOffY:0,arrOffRot:0},{x:230,y:gameVars.halfHeight-225,arrOffX:0,arrOffY:0,arrOffRot:0},{x:390,y:gameVars.halfHeight-210,arrOffX:0,arrOffY:0,arrOffRot:0},{x:470,y:gameVars.halfHeight-115,arrOffX:0,arrOffY:0,arrOffRot:0},{x:475,y:gameVars.halfHeight-45,arrOffX:45,arrOffY:15,arrOffRot:.3},{x:470,y:gameVars.halfHeight-50,arrOffX:45,arrOffY:15,arrOffRot:.3}];gameObjects.roomHandyObjs={roomIndex:a,roomContainer:t,listOfButtonPos:m,listOfInverseButtonPos:[{x:m[0].x-51,y:m[0].y-30},{x:m[1].x-35,y:m[1].y-55},{x:m[2].x-20,y:m[2].y-50},{x:m[3].x+60,y:m[3].y-5},{x:m[4].x-75,y:m[4].y-5},{x:m[5].x+5,y:m[5].y-50},{x:m[6].x+20,y:m[6].y-60},{x:m[7].x+40,y:m[7].y-35},{x:m[8].x,y:m[8].y}],fingerState:0,dollImages:[]},gameObjects.roomHandyObjs.dollArms=e.add.image(0,gameVars.height-260,"roomHandy","arms"),t.add(gameObjects.roomHandyObjs.dollArms),gameObjects.roomHandyObjs.dollBody=e.add.image(0,gameVars.height-260,"roomHandy","dollBody"),t.add(gameObjects.roomHandyObjs.dollBody),gameObjects.roomHandyObjs.dollPicture=e.add.sprite(0,200,"handy1").setVisible(!1),t.add(gameObjects.roomHandyObjs.dollPicture),gameObjects.roomHandyObjs.dollPicture2=e.add.sprite(0,200,"handy2").setVisible(!1),t.add(gameObjects.roomHandyObjs.dollPicture2),setHandyDollImage("dollNeutral"),t.add(gameObjects.roomHandyObjs.doll),gameObjects.roomHandyObjs.leftHand=e.add.image(-285,359,"roomHandy","lefthand1"),gameObjects.roomHandyObjs.rightHand=e.add.image(290,359,"roomHandy","righthand1"),t.add(gameObjects.roomHandyObjs.leftHand),t.add(gameObjects.roomHandyObjs.rightHand),initFingerButton(),gameObjects.roomHandyObjs.placard=new Button(e,t,()=>{gameVars.horrorPoint?gameObjects.roomHandyObjs.roomComplete?gameObjects.roomHandyObjs.playedOneTimeText?updateInfoText("Mr.            "):(gameObjects.roomHandyObjs.playedOneTimeText=!0,updateInfoText("Mr. Handy"),setTimeout(()=>{updateInfoText("Mr. H̵a̵n̸d̸ "),setTimeout(()=>{updateInfoText("Mr. H̴a̸      "),setTimeout(()=>{updateInfoText("Mr.            ")},100)},100)},700)):updateInfoText("Mr. Handy"):gameVars.darkPoint?updateInfoText("8, 7, 6, 5... "):updateInfoText("Mr. Handy")},{atlas:"buttons",ref:"placard",x:260,y:gameVars.height-85},{atlas:"buttons",ref:"placard_hover"}),messageBus.subscribe("exhibitMove",e=>{e===a&&(tweenVolume("gladiator0",.2),tweenVolume("gladiator1",.7),tweenVolume("gladiator2",.35),addGuideArrowFatToContainer(t),e=gameObjects.roomHandyObjs.fingerState,updateGuideArrowFat((e=gameObjects.roomHandyObjs.listOfButtonPos[e]).x+e.arrOffX,e.y-200+e.arrOffY,.5*Math.PI+e.arrOffRot),gameVars.darkPoint)&&(updateSparklePos((e=gameObjects.roomHandyObjs.listOfButtonPos[7]).x,e.y),updateGuideArrowFat(e.x+e.arrOffX+50,e.y-230+e.arrOffY,.5*Math.PI+e.arrOffRot))}),o=messageBus.subscribe("startDarkSequence",e=>{gameObjects.roomHandyObjs.dollPicture.setVisible(!0),o.unsubscribe();var a=gameObjects.roomHandyObjs.listOfInverseButtonPos[7];gameObjects.roomHandyObjs.cleanupButton.setPos(a.x,a.y)}),s=messageBus.subscribe("startHorrorSequence",e=>{gameObjects.guideArrowFat.alpha=1;var a=gameObjects.roomHandyObjs.fingerState;gameObjects.roomHandyObjs.fingerButton.setPos(gameObjects.roomHandyObjs.listOfButtonPos[a].x,gameObjects.roomHandyObjs.listOfButtonPos[a].y),s.unsubscribe()})}function initFingerButton(){gameObjects.roomHandyObjs.fingerButton=new Button(globalScene,gameObjects.roomHandyObjs.roomContainer,fingerPress,{ref:"blackPixel",alpha:.001,x:gameObjects.roomHandyObjs.listOfButtonPos[0].x,y:gameObjects.roomHandyObjs.listOfButtonPos[0].y,scaleX:84,scaleY:84},{ref:"blackPixel",scaleX:85,scaleY:85},{ref:"blackPixel",scaleX:85,scaleY:85}),gameObjects.roomHandyObjs.cleanupButton=new Button(globalScene,gameObjects.roomHandyObjs.roomContainer,fingerUnPress,{ref:"blackPixel",alpha:.001,x:0,y:-9999,scaleX:84,scaleY:84},{ref:"blackPixel",scaleX:85,scaleY:85},{ref:"blackPixel",scaleX:85,scaleY:85})}function fingerPress(){var a=gameObjects.roomHandyObjs.fingerState+1;if(17===gameObjects.roomHandyObjs.fingerState&&(gameObjects.roomHandyObjs.dollPicture.setVisible(!1),gameObjects.roomHandyObjs.dollPicture2.setVisible(!0)),gameVars.horrorPoint)if(0===gameObjects.roomHandyObjs.fingerState&&tweenVolume("gladiatorx",.5),gameObjects.roomHandyObjs.listOfButtonPos.length>gameObjects.roomHandyObjs.fingerState+1)if(gameObjects.roomHandyObjs.fingerState=a,gameVars.darkPoint){gameObjects.roomHandyObjs.fingerButton.setPos(gameObjects.roomHandyObjs.listOfInverseButtonPos[a].x,gameObjects.roomHandyObjs.listOfInverseButtonPos[a].y);var e=gameObjects.roomHandyObjs.listOfInverseButtonPos[a];updateGuideArrowFat(e.x+e.arrOffX,e.y-200+e.arrOffY,.5*Math.PI+e.arrOffRot)}else{let e=gameObjects.roomHandyObjs.listOfButtonPos[a];updateHandyExpression(gameObjects.roomHandyObjs.fingerState),8===gameObjects.roomHandyObjs.fingerState?(gameObjects.roomHandyObjs.fingerButton.setPos(e.x,-9999),updateGuideArrowFat(e.x,-9999,.5*Math.PI),setTimeout(()=>{gameObjects.roomHandyObjs.fingerButton.setPos(e.x,e.y),updateGuideArrowFat(e.x+e.arrOffX,e.y-200+e.arrOffY,.5*Math.PI+e.arrOffRot)},1500)):8<gameObjects.roomHandyObjs.fingerState?(gameObjects.roomHandyObjs.fingerButton.setPos(e.x,-9999),updateGuideArrowFat(e.x,-9999,.5*Math.PI),setTimeout(()=>{if(12===gameObjects.roomHandyObjs.fingerState){showStaticRand(3,void 0,void 0,.4);let e=globalScene.add.image(gameObjects.roomHandyObjs.leftHand.x,gameObjects.roomHandyObjs.leftHand.y,"roomHandy","lefthandX");gameObjects.roomHandyObjs.roomContainer.add(e),e.scaleX=1.01,e.scaleY=1.01,setTimeout(()=>{e.scaleX=1,e.scaleY=1,setTimeout(()=>{e.destroy(),showFlashRand(1)},30)},30)}},0),setTimeout(()=>{gameObjects.roomHandyObjs.fingerButton.setPos(e.x,e.y),updateGuideArrowFat(e.x+e.arrOffX,e.y-200+e.arrOffY,.5*Math.PI+e.arrOffRot)},800)):(gameObjects.roomHandyObjs.fingerButton.setPos(e.x,e.y),updateGuideArrowFat(e.x+e.arrOffX,e.y-200+e.arrOffY,.5*Math.PI+e.arrOffRot))}else gameObjects.roomHandyObjs.roomComplete=!0,updateHandyExpression(gameObjects.roomHandyObjs.fingerState+1),gameObjects.roomHandyObjs.fingerButton.setPos(0,-9999),updateGuideArrowFat(0,-9999),tweenVolume("gladiatorx",.85),gameObjects.guideArrowFat.alpha=0,setTimeout(()=>{gameObjects.hand.switchHand(),createKey(-15,gameVars.halfHeight-10,gameObjects.roomHandyObjs.roomIndex,gameObjects.roomHandyObjs.roomContainer,!1)},1200);else gameObjects.roomHandyObjs.fingerState<7?(gameObjects.roomHandyObjs.fingerState=a,updateHandyExpression(gameObjects.roomHandyObjs.fingerState),e=null,e=(gameVars.darkPoint?gameObjects.roomHandyObjs.listOfInverseButtonPos:gameObjects.roomHandyObjs.listOfButtonPos)[a],gameObjects.roomHandyObjs.fingerButton.setPos(e.x,e.y),updateGuideArrowFat(e.x+e.arrOffX,e.y-200+e.arrOffY,.5*Math.PI+e.arrOffRot),addGuideArrowFatToContainer(gameObjects.roomHandyObjs.roomContainer)):(gameObjects.roomHandyObjs.fingerButton.setPos(0,-9999),updateGuideArrowFat(0,-9999),updateHandyExpression(gameObjects.roomHandyObjs.fingerState+1),gameObjects.guideArrowFat.alpha=0,setTimeout(()=>{gameObjects.roomHandyObjs.doll.scaleY=.97,setTimeout(()=>{gameObjects.roomHandyObjs.doll.scaleY=1.05,setTimeout(()=>{gameObjects.roomHandyObjs.doll.scaleY=1.04,setTimeout(()=>{gameObjects.roomHandyObjs.doll.scaleY=1,createKey(0,gameVars.halfHeight-10,gameObjects.roomHandyObjs.roomIndex,gameObjects.roomHandyObjs.roomContainer,!0)},30)},50)},70)},50));handleFingerSound(a);let t=0;switch(a){case 1:case 2:case 3:case 4:t=a+1,gameObjects.roomHandyObjs.leftHand.destroy(),gameObjects.roomHandyObjs.leftHand=globalScene.add.image(-285,360,"roomHandy","lefthand"+t),gameObjects.roomHandyObjs.roomContainer.add(gameObjects.roomHandyObjs.leftHand),gameObjects.roomHandyObjs.leftHand.scaleX=1.01,gameObjects.roomHandyObjs.leftHand.scaleY=1.01,setTimeout(()=>{gameObjects.roomHandyObjs.leftHand.scaleX=1,gameObjects.roomHandyObjs.leftHand.scaleY=1},50);break;case 5:case 6:case 7:case 8:t=a-3,gameObjects.roomHandyObjs.rightHand.destroy(),gameObjects.roomHandyObjs.rightHand=globalScene.add.image(290,360,"roomHandy","righthand"+t),gameObjects.roomHandyObjs.roomContainer.add(gameObjects.roomHandyObjs.rightHand),gameObjects.roomHandyObjs.rightHand.scaleX=1.01,gameObjects.roomHandyObjs.rightHand.scaleY=1.01,setTimeout(()=>{gameObjects.roomHandyObjs.rightHand.scaleX=1,gameObjects.roomHandyObjs.rightHand.scaleY=1},50);break;case 9:case 10:case 11:case 12:t=a-3,gameObjects.roomHandyObjs.leftHand.destroy(),gameObjects.roomHandyObjs.leftHand=globalScene.add.image(-285,360,"roomHandy","lefthand"+t),gameObjects.roomHandyObjs.roomContainer.add(gameObjects.roomHandyObjs.leftHand),gameObjects.roomHandyObjs.leftHand.scaleX=1.01,gameObjects.roomHandyObjs.leftHand.scaleY=1.01,setTimeout(()=>{gameObjects.roomHandyObjs.leftHand.scaleX=1,gameObjects.roomHandyObjs.leftHand.scaleY=1},50);break;case 13:case 14:case 15:case 16:case 17:case 18:case 19:if(t=a-7,gameObjects.roomHandyObjs.rightHand.destroy(),gameObjects.roomHandyObjs.rightHand=globalScene.add.image(290,360,"roomHandy","righthand"+t),gameObjects.roomHandyObjs.roomContainer.add(gameObjects.roomHandyObjs.rightHand),gameObjects.roomHandyObjs.rightHand.scaleX=1.01,gameObjects.roomHandyObjs.rightHand.scaleY=1.01,setTimeout(()=>{gameObjects.roomHandyObjs.rightHand.scaleX=1,gameObjects.roomHandyObjs.rightHand.scaleY=1},50),19===a){showFlashRand(2),showStaticRand(4,void 0,void 0,.6);let e=globalScene.add.image(gameObjects.roomHandyObjs.leftHand.x,gameObjects.roomHandyObjs.leftHand.y,"roomHandy","lefthandY"),a=(gameObjects.roomHandyObjs.roomContainer.add(e),e.scaleX=1.02,e.scaleY=1.02,setTimeout(()=>{e.scaleX=1,e.scaleY=1,setTimeout(()=>{showStaticRand(3,void 0,void 0,.2),showFlashRand(1),e.destroy()},100)},70),globalScene.add.image(290,360,"roomHandy","righthandY"));gameObjects.roomHandyObjs.roomContainer.add(a),a.scaleX=1.03,a.scaleY=1.03,setTimeout(()=>{a.scaleX=1.005,a.scaleY=1.005,setTimeout(()=>{a.destroy()},100)},70)}}}function fingerUnPress(){var e=gameObjects.roomHandyObjs.fingerState-1;0<=e?(gameObjects.roomHandyObjs.fingerState=e,gameObjects.roomHandyObjs.cleanupButton.setPos(gameObjects.roomHandyObjs.listOfInverseButtonPos[e].x,gameObjects.roomHandyObjs.listOfInverseButtonPos[e].y-20),updateGuideArrowFat(gameObjects.roomHandyObjs.listOfInverseButtonPos[e].x,gameObjects.roomHandyObjs.listOfInverseButtonPos[e].y-200,.5*Math.PI)):(gameObjects.roomHandyObjs.cleanupButton.setPos(0,-9999),updateGuideArrowFat(0,-9999),gameObjects.exhibit.needCleanup=!1,updateHandyExpression(1),setTimeout(()=>{playSound("deepbell3"),updateInfoTextSoft("Room cleaned up.",2250)},100)),handleFingerSound(2+e);let a=0;switch(e){case-1:case 0:case 1:case 2:a=2+e,gameObjects.roomHandyObjs.leftHand.destroy(),gameObjects.roomHandyObjs.leftHand=globalScene.add.image(-285,360,"roomHandy","lefthand"+a),gameObjects.roomHandyObjs.roomContainer.add(gameObjects.roomHandyObjs.leftHand);break;case 3:case 4:case 5:case 6:case 7:case 8:a=e-2,gameObjects.roomHandyObjs.rightHand.destroy(),gameObjects.roomHandyObjs.rightHand=globalScene.add.image(290,360,"roomHandy","righthand"+a),gameObjects.roomHandyObjs.roomContainer.add(gameObjects.roomHandyObjs.rightHand)}}function setHandyDollImage(e){if(gameObjects.roomHandyObjs.doll){if(gameObjects.roomHandyObjs.doll==gameObjects.roomHandyObjs.dollImages[e])return void bounceHandyDoll();gameObjects.roomHandyObjs.doll.visible=!1}var a;gameObjects.roomHandyObjs.dollImages[e]||(a=globalScene.add.image(0,gameVars.height-270,"roomHandy",e),gameObjects.roomHandyObjs.dollImages[e]=a,gameObjects.roomHandyObjs.roomContainer.add(a)),gameObjects.roomHandyObjs.dollImages[e].visible=!0,gameObjects.roomHandyObjs.doll=gameObjects.roomHandyObjs.dollImages[e],bounceHandyDoll()}function bounceHandyDoll(){gameObjects.roomHandyObjs.doll.scaleY=1.013,gameObjects.roomHandyObjs.dollBody.scaleY=1.013,setTimeout(()=>{gameObjects.roomHandyObjs.doll.scaleY=1.004,gameObjects.roomHandyObjs.dollBody.scaleY=1.004,setTimeout(()=>{gameObjects.roomHandyObjs.doll.scaleY=1,gameObjects.roomHandyObjs.dollBody.scaleY=1},40)},50)}function updateHandyExpression(e){switch(e){case 1:case 2:setHandyDollImage("dollNeutral");break;case 3:setHandyDollImage("dollExpectant");break;case 4:setHandyDollImage("dollHappy"),setTimeout(()=>{setHandyDollImage("dollNeutral")},500);break;case 5:case 6:setHandyDollImage("dollNeutral");break;case 7:setHandyDollImage("dollExpectant");break;case 8:setHandyDollImage("dollHappy");break;case 9:showStaticLite(1,2,1.25,.08),setHandyDollImage("dollAnguished"),setTimeout(()=>{setHandyDollImage("dollHappy")},150);break;case 10:showStaticLite(2,3,1.25,.12),setHandyDollImage("dollAnguished"),setTimeout(()=>{setHandyDollImage("dollNeutral")},300);break;case 11:showStaticLite(2,4,2,.15),setHandyDollImage("dollWorried"),setTimeout(()=>{showStaticLite(1,2,1,.05),setHandyDollImage("dollAnguished")},300);break;case 12:showStaticLite(1,10,2.5,.15),setHandyDollImage("dollFearful"),setTimeout(()=>{showStaticLite(1,2,1,.1),setHandyDollImage("dollAnguished")},250);break;case 13:showStaticLite(1,2,1.5,.1),setHandyDollImage("dollFearful"),setTimeout(()=>{setHandyDollImage("dollWorried"),gameObjects.roomHandyObjs.shake=1,gameObjects.roomHandyObjs.vertShakeTemp=0,gameObjects.roomHandyObjs.shakeTemp=1,addToUpdateFuncList(shakeHandyDoll)},200);break;case 14:showStaticLite(2,3,1.5,.15),setHandyDollImage("dollFearful"),gameObjects.roomHandyObjs.shakeTemp=1.5,setTimeout(()=>{setHandyDollImage("dollWorried"),gameObjects.roomHandyObjs.shake=1.25},250);break;case 15:showStaticLite(1,3,2,.6),setHandyDollImage("dollFearful"),gameObjects.roomHandyObjs.shake=3,gameObjects.roomHandyObjs.vertShakeTemp=.1,setTimeout(()=>{showStaticLite(2,3,1.5,.15),setHandyDollImage("dollWorried"),gameObjects.roomHandyObjs.shake=1.75},180);break;case 16:showStaticLite(1,2,1.5,.1),setHandyDollImage("dollFearful"),gameObjects.roomHandyObjs.shakeTemp=1.5,gameObjects.roomHandyObjs.vertShakeTemp=.02,setTimeout(()=>{setHandyDollImage("dollWorried"),gameObjects.roomHandyObjs.shake=2},300);break;case 17:showStaticLite(1,2,1.5,.1),setHandyDollImage("dollFearful"),gameObjects.roomHandyObjs.shakeTemp=1.5,gameObjects.roomHandyObjs.vertShakeTemp=.04,setTimeout(()=>{setHandyDollImage("dollFearful"),gameObjects.roomHandyObjs.shake=2},300);break;case 18:showStaticLite(4,7,2,.4),setHandyDollImage("dollScreaming"),gameObjects.roomHandyObjs.shakeTemp=.5,gameObjects.roomHandyObjs.vertShakeTemp=.05,setTimeout(()=>{setHandyDollImage("dollFearful"),gameObjects.roomHandyObjs.shake=2.4},150);break;case 19:gameObjects.roomHandyObjs.dollBody.setVisible(!1),showStaticLite(5,10,2.5,1),setHandyDollImage("dollScreaming"),gameObjects.roomHandyObjs.shakeTemp=3,gameObjects.roomHandyObjs.vertShakeTemp=.12,setTimeout(()=>{setHandyDollImage("dollDefeated"),removeFromUpdateFuncList(shakeHandyDoll),setTimeout(()=>{showStaticRand(2)},500)},600)}}function shakeHandyDoll(){var e=gameObjects.roomHandyObjs.shake+gameObjects.roomHandyObjs.shakeTemp,a=gameObjects.roomHandyObjs.vertShakeTemp,e=(gameObjects.roomHandyObjs.shakeTemp*=.85,gameObjects.roomHandyObjs.vertShakeTemp=Math.max(0,.8*gameObjects.roomHandyObjs.vertShakeTemp-.01),.5*-e+e*Math.random());gameObjects.roomHandyObjs.doll.x=e,gameObjects.roomHandyObjs.dollArms.x=.75*e,gameObjects.roomHandyObjs.dollBody.x=e,gameObjects.roomHandyObjs.doll.scaleY=1+a+a*Math.random(),gameObjects.roomHandyObjs.dollBody.scaleY=1+a+a*Math.random(),gameObjects.roomHandyObjs.doll.rotation=.005*e}function handleFingerSound(e){switch(e){case 1:case 9:playSound("c7");break;case 2:case 10:playSound("d7");break;case 3:playSound("e7");break;case 4:playSound("f7");break;case 5:case 13:playSound("g7");break;case 6:case 15:playSound("a7");break;case 7:case 16:playSound("b7");break;case 19:playSound("tear5");case 8:playSound("c8");break;case 11:playSound("e7b");break;case 12:playSound("f7b");break;case 14:playSound("tear2");break;case 17:playSound("tear1");break;case 18:playSound("tear4")}}function setupRoomFlower1(e,a,t){gameObjects.exhibit.setBackgroundAtIndex(a,"bgs","bg9");e=e.add.image(300,gameVars.height-28,"misc","flower1");e.setOrigin(.5,1),t.add(e);let o;o=messageBus.subscribe("exhibitMove",e=>{e===a&&(o.unsubscribe(),globalScene.tweens.add({targets:gameObjects.generalDarkness,alpha:.22,duration:4e3}))})}function setupRoomFlower2(e,a,t){gameObjects.exhibit.setBackgroundAtIndex(a,"bgs","bg9");e=e.add.image(300,gameVars.height-28,"misc","flower2");e.setOrigin(.5,1),t.add(e);let o;o=messageBus.subscribe("exhibitMoveComplete",e=>{e===a&&(o.unsubscribe(),gameObjects.exhibit.removeIndex(a-1))});let s;s=messageBus.subscribe("exhibitMove",e=>{e===a&&(s.unsubscribe(),globalScene.tweens.add({targets:gameObjects.generalDarkness,alpha:.35,duration:4e3}))})}function setupRoomFlower3(e,a,t){gameObjects.exhibit.setBackgroundAtIndex(a,"bgs","bg9");e=e.add.image(300,gameVars.height-28,"misc","flower3");e.setOrigin(.5,1),t.add(e);let o;o=messageBus.subscribe("exhibitMoveComplete",e=>{e===a&&(o.unsubscribe(),gameObjects.exhibit.removeIndex(a-1))});let s;s=messageBus.subscribe("exhibitMove",e=>{e===a&&(s.unsubscribe(),globalScene.tweens.add({targets:gameObjects.generalDarkness,alpha:.48,duration:4e3}))})}function setupRoomFlower4(e,a,t){gameObjects.exhibit.setBackgroundAtIndex(a,"bgs","bg9");e=e.add.image(300,gameVars.height-28,"misc","flower4");e.setOrigin(.5,1),t.add(e);let o;o=messageBus.subscribe("exhibitMoveComplete",e=>{e===a&&(o.unsubscribe(),gameObjects.exhibit.removeIndex(a-1))});let s;s=messageBus.subscribe("exhibitMove",e=>{e===a&&(s.unsubscribe(),globalScene.tweens.add({targets:gameObjects.generalDarkness,alpha:.6,duration:4e3}))})}function setupRoomFlower5(a,t,e){gameObjects.exhibit.setBackgroundAtIndex(t,"bgs","bg9");var o=a.add.image(300,gameVars.height-28,"misc","flower5");o.setOrigin(.5,1),e.add(o);let s;s=messageBus.subscribe("exhibitMoveComplete",e=>{e===t&&(s.unsubscribe(),gameObjects.exhibit.removeIndex(t-1))});let m;m=messageBus.subscribe("exhibitMove",e=>{e===t&&(gameObjects.roomJackObjs.lightsReady=!0,m.unsubscribe(),gameObjects.roomJackObjs.lights=a.add.image(0,gameVars.halfHeight,"roomJack","lights2"),gameObjects.roomJackObjs.lights.scaleX=2.1,gameObjects.roomJackObjs.lights.scaleY=2.1,gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.lights),gameObjects.roomJackObjs.lights.alpha=.6,gameVarsTemp.startDarkFlicker=!1,gameObjects.generalDarkness.alpha=0,gameObjects.generalDarkness.scaleX=0,gameObjects.generalDarkness.scaleY=0,globalScene.tweens.add({targets:gameObjects.roomJackObjs.lights,alpha:.7,scaleX:2,scaleY:2,duration:3e3}))})}function setupRoomStretch(a,t,o){gameObjects.exhibit.setBackgroundAtIndex(t,"bgs","bg6"),gameObjects.roomStretchObjs||(gameObjects.roomStretchObjs={roomIndex:t,roomContainer:o,lastSoundUpdate:0,shouldUpdate:!1,armMinDist:80,roomUnlocked:!1,doDarkCleanup:!1,roomCompleted:!1,accumulateStatic:0,accumulateFlash:0,dollImages:[],dollBodyList:[],dollPosX:-1,dollPosY:-1,doHorrorSection:!1,streamersList:[],loosenAmt:0}),gameObjects.roomStretchObjs.cleanupButton=new Button(globalScene,gameObjects.roomStretchObjs.roomContainer,()=>{},{atlas:"buttons",ref:"glow",alpha:.001,x:0,y:9999,scaleX:1.3,scaleY:1.3},{atlas:"buttons",ref:"glow",alpha:.001,scaleX:1.58,scaleY:1.58},{atlas:"buttons",ref:"glow",alpha:.001,scaleX:1.6,scaleY:1.6}),gameObjects.roomStretchObjs.cleanupButton.setOnMouseDownFunc(stretchCleanup),gameObjects.roomStretchObjs.frame1=a.add.image(-340,325,"roomStretch","framesStretch1"),gameObjects.roomStretchObjs.frame1x=a.add.image(-340,325,"roomStretch","framesStretch1x"),gameObjects.roomStretchObjs.frame2=a.add.image(-15,180,"roomStretch","framesStretch2"),gameObjects.roomStretchObjs.frame2x=a.add.image(-15,180,"roomStretch","framesStretch3x"),gameObjects.roomStretchObjs.frame3=a.add.image(-65,380,"roomStretch","framesStretch3"),gameObjects.roomStretchObjs.frame1.alpha=0,gameObjects.roomStretchObjs.frame1x.alpha=0,gameObjects.roomStretchObjs.frame2.alpha=0,gameObjects.roomStretchObjs.frame2x.alpha=0,gameObjects.roomStretchObjs.frame3.alpha=0,o.add(gameObjects.roomStretchObjs.frame1),o.add(gameObjects.roomStretchObjs.frame1x),o.add(gameObjects.roomStretchObjs.frame2),o.add(gameObjects.roomStretchObjs.frame2x),o.add(gameObjects.roomStretchObjs.frame3),gameObjects.roomStretchObjs.doll=-1,setStretchDollPos(-236,gameVars.height-161),setStretchDollImage("dollNeutral"),setStretchDollImage("dollAnxious"),setStretchDollImage("dollFearful"),setStretchDollImage("dollNeutral"),setStretchDollImage("dollExpectant"),setStretchDollImage("dollHappy"),gameObjects.roomStretchObjs.touchspot=a.add.image(204,380,"roomStretch","touchspot"),o.add(gameObjects.roomStretchObjs.touchspot);for(let e=0;e<8;e++){var s="streamer"+(e+1),s=a.add.image(0,-90,"roomStretch",s).setOrigin(.5,0);gameObjects.roomStretchObjs.streamersList.push(s),o.add(s)}let m=-525;for(let e=0;e<7;e++)gameObjects.roomStretchObjs.streamersList[e].x=m,m+=.5*gameObjects.roomStretchObjs.streamersList[e].width+.5*gameObjects.roomStretchObjs.streamersList[e+1].width+20;gameObjects.roomStretchObjs.streamersList[7].x=m,gameObjects.roomStretchObjs.armseg1=a.add.image(gameObjects.roomStretchObjs.dollPosX+35.5,gameObjects.roomStretchObjs.dollPosY-85,"roomStretch","armseg"),gameObjects.roomStretchObjs.armseg1.rotation=-.3,gameObjects.roomStretchObjs.armseg1.setOrigin(.02,.5),o.add(gameObjects.roomStretchObjs.armseg1);let r,c,b,e=gameObjects.roomStretchObjs.armseg1.x+94*Math.cos(gameObjects.roomStretchObjs.armseg1.rotation),l=gameObjects.roomStretchObjs.armseg1.y+94*Math.sin(gameObjects.roomStretchObjs.armseg1.rotation);gameObjects.roomStretchObjs.armseg2=a.add.image(e,l,"roomStretch","armseg"),gameObjects.roomStretchObjs.armseg2.setOrigin(.029,.5),o.add(gameObjects.roomStretchObjs.armseg2),gameObjects.roomStretchObjs.elbow=a.add.image(e,l,"roomStretch","hand"),gameObjects.roomStretchObjs.elbow.alpha=0,gameObjects.roomStretchObjs.elbow.velX=0,gameObjects.roomStretchObjs.elbow.velY=0,gameObjects.roomStretchObjs.elbow.scaleX=.01,gameObjects.roomStretchObjs.elbow.scaleY=.01,o.add(gameObjects.roomStretchObjs.elbow),gameObjects.roomStretchObjs.hand=a.add.image(-120,630,"roomStretch","hand"),gameObjects.roomStretchObjs.hand.scaleX=.8,gameObjects.roomStretchObjs.hand.scaleY=.8,gameObjects.roomStretchObjs.hand.velX=0,gameObjects.roomStretchObjs.hand.velY=0,o.add(gameObjects.roomStretchObjs.hand),gameObjects.roomStretchObjs.handButton=new Button(a,{container:o,normal:{atlas:"buttons",ref:"glow",x:0,y:gameVars.halfHeight,alpha:.01,scaleX:1,scaleY:1},hover:{atlas:"buttons",ref:"glow",alpha:.02,scaleX:1.02,scaleY:1.02},disable:{atlas:"buttons",ref:"glow",alpha:.02,scaleX:1e-4,scaleY:1e-4},isDraggable:!0,onDrop:()=>{}}),gameObjects.roomStretchObjs.placard=new Button(a,o,()=>{gameVars.horrorPoint?gameObjects.roomStretchObjs.roomCompleted?updateInfoText("..."):updateInfoText("Ms. Stretch"):gameVars.darkPoint?updateInfoText("What is the furthest she could reach?"):updateInfoText("Ms. Stretch")},{atlas:"buttons",ref:"placard",x:0,y:gameVars.height-73},{atlas:"buttons",ref:"placard_hover"}),setTimeout(()=>{addToUpdateFuncList(roomStretchUpdate)},500),messageBus.subscribe("exhibitMove",e=>{if(e===t){if(tweenVolume("gladiator0",.1),tweenVolume("gladiator1",.8),tweenVolume("gladiator2",.2),gameObjects.roomStretchObjs.shouldUpdate=!0,!gameObjects.roomStretchObjs.oneTimeStreamers){gameObjects.roomStretchObjs.oneTimeStreamers=!0;for(let e=0;e<8;e++)gameObjects.roomStretchObjs.streamersList[e].scaleY=.8+.4*Math.random(),gameObjects.roomStretchObjs.streamersList[e].velY=.1*(Math.random()-.5);addToUpdateFuncList(updateStreamers),setTimeout(()=>{removeFromUpdateFuncList(updateStreamers)},2e4)}}else setTimeout(()=>{gameObjects.roomStretchObjs.shouldUpdate=!1},700)}),r=messageBus.subscribe("startDarkSequence",e=>{r.unsubscribe(),gameObjects.roomStretchObjs.frame1.alpha=1,gameObjects.roomStretchObjs.frame2.alpha=1,gameObjects.roomStretchObjs.frame3.alpha=1,gameObjects.roomStretchObjs.cleanupButton.setPos(gameObjects.roomStretchObjs.touchspot.x,gameObjects.roomStretchObjs.touchspot.y)}),c=messageBus.subscribe("startHorrorSequence",e=>{gameObjects.roomStretchObjs.doDarkCleanup=!1,gameObjects.roomStretchObjs.roomUnlocked=!1,c.unsubscribe(),gameObjects.roomStretchObjs.handButton.setState("normal")}),b=messageBus.subscribe("startTrueStretchHorror",e=>{gameObjects.roomStretchObjs.doDarkCleanup=!1,gameObjects.roomStretchObjs.roomUnlocked=!1,setStretchDollPos(-295,gameVars.height-161),gameObjects.roomStretchObjs.touchspot.x=355,gameObjects.roomStretchObjs.touchspot.y=185,gameObjects.roomStretchObjs.armseg1.x=gameObjects.roomStretchObjs.dollPosX+35.5,b.unsubscribe(),gameObjects.roomStretchObjs.doHorrorSection=!0,gameObjects.roomStretchObjs.frame1.destroy(),gameObjects.roomStretchObjs.frame1x.alpha=1,pullbackStreamers()})}function roomStretchUpdate(s){if(gameObjects.roomStretchObjs.shouldUpdate){let e=gameVars.height-152,t=gameObjects.roomStretchObjs.armMinDist,a=.01+43e-5*t,o=!gameObjects.roomStretchObjs.roomUnlocked||gameObjects.roomStretchObjs.doDarkCleanup||gameObjects.roomStretchObjs.roomCompleted;gameObjects.roomStretchObjs.elbow.velX*=.96,gameObjects.roomStretchObjs.elbow.velY*=.96,gameObjects.roomStretchObjs.elbow.y+=gameObjects.roomStretchObjs.elbow.velY*s,gameObjects.roomStretchObjs.elbow.x+=gameObjects.roomStretchObjs.elbow.velX*s;var m=e-.25*gameObjects.roomStretchObjs.elbow.height*gameObjects.roomStretchObjs.elbow.scaleY,m=(gameObjects.roomStretchObjs.elbow.y>m&&(gameObjects.roomStretchObjs.elbow.y=m,gameObjects.roomStretchObjs.elbow.velY=-.1,0<gameObjects.roomStretchObjs.elbow.velX?gameObjects.roomStretchObjs.elbow.velX=Math.max(0,.98*gameObjects.roomStretchObjs.elbow.velX-.2):gameObjects.roomStretchObjs.elbow.velX<0&&(gameObjects.roomStretchObjs.elbow.velX=Math.min(0,.98*gameObjects.roomStretchObjs.elbow.velX+.2))),o||(gameObjects.roomStretchObjs.hand.x=gameObjects.roomStretchObjs.touchspot.x,gameObjects.roomStretchObjs.hand.velX*=.5,gameObjects.roomStretchObjs.hand.y=gameObjects.roomStretchObjs.touchspot.y,gameObjects.roomStretchObjs.hand.velY*=.5),gameObjects.roomStretchObjs.hand.velX*=.96,gameObjects.roomStretchObjs.hand.velY*=.96,gameObjects.roomStretchObjs.hand.y+=gameObjects.roomStretchObjs.hand.velY*s,gameObjects.roomStretchObjs.hand.x+=gameObjects.roomStretchObjs.hand.velX*s,e-.25*gameObjects.roomStretchObjs.hand.height*gameObjects.roomStretchObjs.hand.scaleY);if(gameObjects.roomStretchObjs.hand.y>m-10&&gameObjects.roomStretchObjs.hand.y>m&&(gameObjects.roomStretchObjs.hand.y=m,gameObjects.roomStretchObjs.hand.velY=-.1,0<gameObjects.roomStretchObjs.hand.velX?gameObjects.roomStretchObjs.hand.velX=Math.max(0,.95*gameObjects.roomStretchObjs.hand.velX-.25):gameObjects.roomStretchObjs.hand.velX<0&&(gameObjects.roomStretchObjs.hand.velX=Math.min(0,.95*gameObjects.roomStretchObjs.hand.velX+.25))),gameObjects.roomStretchObjs.handButton.getIsDragged()?(gameObjects.roomStretchObjs.hand.scaleX=.83,gameObjects.roomStretchObjs.hand.scaleY=.83):(gameObjects.roomStretchObjs.hand.scaleX=.8,gameObjects.roomStretchObjs.hand.scaleY=.8),gameObjects.roomStretchObjs.handButton.getIsDragged()){gameObjects.roomStretchObjs.elbow.velY+=.08;let e=gameObjects.roomStretchObjs.handButton.getXPos(),a=gameObjects.roomStretchObjs.handButton.getYPos(),t=e-gameObjects.roomStretchObjs.hand.x,o=a-gameObjects.roomStretchObjs.hand.y,s=Math.sqrt(t*t+o*o);70<s&&(m=70/s,t*=m,o*=m),gameObjects.roomStretchObjs.hand.velX+=.034*t-.14*gameObjects.roomStretchObjs.hand.velX,gameObjects.roomStretchObjs.hand.velY+=.034*o-.14*gameObjects.roomStretchObjs.hand.velY}else o&&(gameObjects.roomStretchObjs.elbow.velY+=.22*s,gameObjects.roomStretchObjs.hand.velY+=.28*s,gameObjects.roomStretchObjs.handButton.setPos(gameObjects.roomStretchObjs.hand.x,gameObjects.roomStretchObjs.hand.y));var m=gameObjects.roomStretchObjs.overstretched?26:23,r=gameObjects.roomStretchObjs.hand.x-m*Math.cos(gameObjects.roomStretchObjs.hand.rotation)-gameObjects.roomStretchObjs.elbow.x,m=gameObjects.roomStretchObjs.hand.y-m*Math.sin(gameObjects.roomStretchObjs.hand.rotation)-gameObjects.roomStretchObjs.elbow.y,c=Math.sqrt(r*r+m*m);if(c>t){var b=c-t,l=b/t,n=r*l*a,l=m*l*a;gameObjects.roomStretchObjs.hand.velX-=n,gameObjects.roomStretchObjs.hand.velY-=l,gameObjects.roomStretchObjs.elbow.velX+=n,gameObjects.roomStretchObjs.elbow.velY+=l,(t+=.05*b*s)<110&&(t+=.015*b*s);let e=gameObjects.roomStretchObjs.hand.rotation;Math.abs(gameObjects.roomStretchObjs.hand.rotation-gameObjects.roomStretchObjs.armseg2.rotation)>Math.PI&&(gameObjects.roomStretchObjs.hand.rotation>gameObjects.roomStretchObjs.armseg2.rotation?e=gameObjects.roomStretchObjs.hand.rotation-2*Math.PI:gameObjects.roomStretchObjs.hand.rotation<gameObjects.roomStretchObjs.armseg2.rotation&&(e=gameObjects.roomStretchObjs.hand.rotation+2*Math.PI)),gameObjects.roomStretchObjs.hand.rotation=.9*e+.1*gameObjects.roomStretchObjs.armseg2.rotation}else!gameObjects.roomStretchObjs.overstretched&&82<t&&!gameObjects.roomStretchObjs.handButton.getIsDragged()&&(t=.96*t-2*s);var n=gameObjects.roomStretchObjs.elbow.x-gameObjects.roomStretchObjs.armseg1.x,l=gameObjects.roomStretchObjs.elbow.y-gameObjects.roomStretchObjs.armseg1.y,b=Math.sqrt(n*n+l*l),O=(b>t&&(i=l*(O=(b-t)/t)*a,gameObjects.roomStretchObjs.elbow.velX-=2*(n*O*a),gameObjects.roomStretchObjs.elbow.velY-=2*i),gameObjects.roomStretchObjs.armseg1.rotation=Math.atan2(l,n),gameObjects.roomStretchObjs.armseg1.scaleX=.01*b,91+.02*t),i=gameObjects.roomStretchObjs.armseg1.x+Math.cos(gameObjects.roomStretchObjs.armseg1.rotation)*O*gameObjects.roomStretchObjs.armseg1.scaleX,l=gameObjects.roomStretchObjs.armseg1.y+Math.sin(gameObjects.roomStretchObjs.armseg1.rotation)*O*gameObjects.roomStretchObjs.armseg1.scaleX;if(gameObjects.roomStretchObjs.armseg2.x=i,gameObjects.roomStretchObjs.armseg2.y=l,gameObjects.roomStretchObjs.armseg2.rotation=Math.atan2(m,r),gameObjects.roomStretchObjs.armseg2.scaleX=.0113*c-.035,o){let e,a=0;225<t&&gameObjects.roomStretchObjs.doHorrorSection?(290<t&&gameObjects.roomStretchObjs.loosenAmt<.15&&(gameObjects.roomStretchObjs.loosenAmt+=33e-6*s),a=26e-6*t+.83-gameObjects.roomStretchObjs.loosenAmt-.007*(s-1),339.5<t&&(console.log("She can't stretch any further"),e*=.999)):gameObjects.roomStretchObjs.doHorrorSection?a=.0035*t+.088:(a=.0048*t+.032,218<t&&(a*=2)),e=t-a*s;n=gameObjects.roomStretchObjs.armMinDist;if(gameObjects.roomStretchObjs.armMinDist=Math.max(gameObjects.roomStretchObjs.overstretched?230:80,e),120<t){gameObjects.roomStretchObjs.armMinDist>n+.02&&updateStretchSounds(t);let e=35e-5*(t-120);210<t&&(e+=.0045*(t-210)),gameObjects.roomStretchObjs.armseg1.scaleY=1-e,gameObjects.roomStretchObjs.armseg2.scaleY=1-e}}gameObjects.roomStretchObjs.doHorrorSection&&220<t&&gameObjects.roomStretchObjs.handButton.getIsDragged()&&!gameObjects.roomStretchObjs.roomCompleted&&(Math.random()<4e-4*(t-130)+gameObjects.roomStretchObjs.accumulateStatic-.0012?(gameObjects.roomStretchObjs.accumulateStatic=0,260<t&&Math.random()<gameObjects.roomStretchObjs.accumulateFlash-.4?(gameObjects.roomStretchObjs.accumulateFlash=0,showFlashRand(2),gameObjects.roomStretchObjs.armMinDist+=5):Math.random()<.4?(showStaticRand(1,void 0,void 0,.0025*(t-220)),gameObjects.roomStretchObjs.armMinDist+=1.9,gameObjects.roomStretchObjs.accumulateFlash*=.5):(gameObjects.roomStretchObjs.armMinDist+=.5,gameObjects.roomStretchObjs.accumulateFlash+=.1*s)):gameObjects.roomStretchObjs.accumulateStatic);b=gameObjects.roomStretchObjs.touchspot.x-gameObjects.roomStretchObjs.hand.x,O=gameObjects.roomStretchObjs.touchspot.y-gameObjects.roomStretchObjs.hand.y,i=b*b+O*O;if(i<10500&&!gameObjects.roomStretchObjs.doDarkCleanup)if(Math.abs(b)+Math.abs(O)<20)gameObjects.roomStretchObjs.roomUnlocked||(gameObjects.roomStretchObjs.roomUnlocked=!0,gameObjects.roomStretchObjs.doHorrorSection?(gameObjects.roomStretchObjs.roomCompleted=!0,setTimeout(()=>{removeFromUpdateFuncList(roomStretchUpdate)},1e4),gameObjects.roomStretchObjs.frame2.destroy(),gameObjects.roomStretchObjs.frame2x.alpha=1,gameObjects.roomStretchObjs.handButton.destroy(),playSound("tear6"),showStaticLite(9,10,2),showAltReality(["stretch2","stretch3","stretch4","stretch4","stretch5","stretch5","stretch6"],1.2),gameObjects.sounds.pumpamb.stop(),gameObjects.roomStretchObjs.hand.alpha=0,gameObjects.roomStretchObjs.hand.x=gameObjects.roomStretchObjs.dollPosX+25,gameObjects.roomStretchObjs.hand.y=500,l=globalScene.add.image(gameObjects.roomStretchObjs.touchspot.x,gameObjects.roomStretchObjs.touchspot.y,"roomStretch","hand"),gameObjects.roomStretchObjs.roomContainer.add(l),gameObjects.roomStretchObjs.armseg1.x=l.x-25,gameObjects.roomStretchObjs.armseg1.y=l.y+7,gameObjects.roomStretchObjs.handButton.setState("disable")):(gameVars.horrorPoint||gameObjects.roomStretchObjs.handButton.setState("disable"),setStretchDollImage("dollHappy",!0),m=globalScene.add.image(gameObjects.roomStretchObjs.dollPosX-65,gameObjects.roomStretchObjs.dollPosY-125,"roomStretch","exclamation"),gameObjects.roomStretchObjs.roomContainer.add(m),m.scaleX=.5,m.scaleY=.5,globalScene.tweens.timeline({targets:m,tweens:[{scaleX:1.2,scaleY:1.2,duration:150,ease:"Quad.easeOut"},{scaleX:0,scaleY:0,duration:450,ease:"Quad.easeIn"}]}),globalScene.tweens.timeline({targets:m,tweens:[{x:gameObjects.roomStretchObjs.dollPosX-100,y:gameObjects.roomStretchObjs.dollPosY-140,ease:"Quad.easeOut"}]})),setTimeout(()=>{if(gameVars.horrorPoint&&!gameObjects.roomStretchObjs.doHorrorSection){let e=globalScene.add.image(gameObjects.roomStretchObjs.dollPosX-100,gameObjects.roomStretchObjs.dollPosY-30,"buttons","key_yellow");playSound("keyfound"),gameObjects.roomStretchObjs.roomContainer.add(e),setTimeout(()=>{showStaticRand(1),setTimeout(()=>{e.destroy(),gameObjects.roomStretchObjs.doDarkCleanup=!0,showStaticRand(3,void 0,()=>{showFlashRand(3),messageBus.publish("startTrueStretchHorror")})},550)},800)}else createKey(gameObjects.roomStretchObjs.dollPosX-100,gameObjects.roomStretchObjs.dollPosY-30,gameObjects.roomStretchObjs.roomIndex,gameObjects.roomStretchObjs.roomContainer,!gameVars.horrorPoint),gameVars.horrorPoint&&setTimeout(()=>{gameObjects.generalDarkness.alpha=.1,setTimeout(()=>{gameObjects.generalDarkness.alpha=.04,setTimeout(()=>{gameObjects.generalDarkness.alpha=.15,setTimeout(()=>{gameObjects.generalDarkness.alpha=.07},100)},350)},100)},350)},gameVars.horrorPoint?700:300));else{let e=i<2200?45:25;gameObjects.roomStretchObjs.doHorrorSection&&(e*=4),gameObjects.roomStretchObjs.hand.velX+=b*e/i,gameObjects.roomStretchObjs.hand.velY+=O*e/i}gameObjects.roomStretchObjs.roomCompleted?setStretchDollImage("dollDefeated"):gameObjects.roomStretchObjs.roomUnlocked||(gameObjects.roomStretchObjs.overstretched?(gameObjects.sounds.pumpamb.volume=Math.max(.01,(t-260)/90),t<285?(setStretchDollImage("dollAnxious"),r=1.4*Math.random(),gameObjects.roomStretchObjs.doll.x=gameObjects.roomStretchObjs.dollPosX-.7+r+9):t<340?(playSoundOnce("tear4",250),setStretchDollImage("dollFearful"),gameObjects.roomStretchObjs.doll.rotation+=.035*(Math.random()-.25),c=1.7*Math.random()-.85,gameObjects.roomStretchObjs.doll.x=gameObjects.roomStretchObjs.dollPosX+c+9,gameObjects.roomStretchObjs.dollBody.x=gameObjects.roomStretchObjs.dollPosX+c,gameObjects.roomStretchObjs.armseg1.x=gameObjects.roomStretchObjs.dollPosX+35.5+c):(playSoundOnce("tear5",250),setStretchDollImage("dollHorrified"),gameObjects.roomStretchObjs.doll.rotation+=.16*(Math.random()-.25),n=3*Math.random()-1.5,gameObjects.roomStretchObjs.doll.x=gameObjects.roomStretchObjs.dollPosX+n+9,gameObjects.roomStretchObjs.dollBody.x=gameObjects.roomStretchObjs.dollPosX+n,gameObjects.roomStretchObjs.armseg1.x=gameObjects.roomStretchObjs.dollPosX+35.5+n)):t<120?setStretchDollImage("dollNeutral"):t<230?setStretchDollImage("dollExpectant"):t<290?260<t&&!gameObjects.roomStretchObjs.flashFear?(setStretchDollImage("dollFearful"),playSoundOnce("tear2"),showStaticLite(1,4,1.5),setTimeout(()=>{gameObjects.roomStretchObjs.flashFear||(gameObjects.roomStretchObjs.armMinDist+=5),gameObjects.roomStretchObjs.flashFear=!0},150)):(gameObjects.roomStretchObjs.flashStaticOnce||(gameObjects.roomStretchObjs.flashStaticOnce=!0,showStaticLite(2,8,1,.1),gameObjects.roomStretchObjs.armMinDist+=2,setTimeout(()=>{gameObjects.roomStretchObjs.armMinDist+=1,setTimeout(()=>{gameObjects.roomStretchObjs.armMinDist+=1},20)},20)),playSoundOnce("tear1"),setStretchDollImage("dollAnxious")):(gameObjects.roomStretchObjs.overstretched||(gameObjects.roomStretchObjs.overstretched=!0,gameObjects.sounds.pumpamb.play({loop:!0}),gameObjects.sounds.pumpamb.volume=.01,gameObjects.roomStretchObjs.armseg2.setOrigin(.022,.5),gameObjects.roomStretchObjs.armMinDist+=1,setTimeout(()=>{playSoundOnce("tear3"),showAltReality(["stretch1","stretch2","stretch3","stretch4"],1.06),gameObjects.roomStretchObjs.armMinDist+=8},100)),setStretchDollImage("dollFearful"))),gameObjects.roomStretchObjs.doll.rotation*=.75}}function stretchCleanup(){gameObjects.roomStretchObjs.doDarkCleanup=!0,gameObjects.roomStretchObjs.cleanupButton.destroy(),gameObjects.exhibit.needCleanup=!1,setTimeout(()=>{playSound("deepbell2"),updateInfoTextSoft("Room cleaned up.",2250)},400)}function setStretchDollImage(e,a=!1){var t;gameObjects.roomStretchObjs.doll!=gameObjects.roomStretchObjs.dollImages[e]&&(gameObjects.roomStretchObjs.doll.visible=!1,"dollDefeated"===e?(updateDollBodyImage("dollDefeated"),gameObjects.roomStretchObjs.doll.visible=!1):(updateDollBodyImage("dollBody"),gameObjects.roomStretchObjs.dollImages[e]||(t=globalScene.add.image(gameObjects.roomStretchObjs.dollPosX+9,gameObjects.roomStretchObjs.dollPosY+-91,"roomStretch",e),gameObjects.roomStretchObjs.dollImages[e]=t,gameObjects.roomStretchObjs.roomContainer.add(t)),gameObjects.roomStretchObjs.dollImages[e].visible=!0,gameObjects.roomStretchObjs.doll=gameObjects.roomStretchObjs.dollImages[e],gameObjects.roomStretchObjs.doHorrorSection,gameObjects.roomStretchObjs.doll.x=gameObjects.roomStretchObjs.dollPosX+9,gameObjects.roomStretchObjs.doll.y=gameObjects.roomStretchObjs.dollPosY+-91,a?(gameObjects.roomStretchObjs.doll.rotation=.075,gameObjects.roomStretchObjs.dollBody.scaleX=1.01,gameObjects.roomStretchObjs.dollBody.scaleY=1.01,gameObjects.roomStretchObjs.doll.scaleX=1.015,gameObjects.roomStretchObjs.doll.scaleY=1.02,setTimeout(()=>{gameObjects.roomStretchObjs.dollBody.scaleX=1.004,gameObjects.roomStretchObjs.dollBody.scaleY=1.004,gameObjects.roomStretchObjs.doll.scaleX=1.006,gameObjects.roomStretchObjs.doll.scaleY=1.008,setTimeout(()=>{gameObjects.roomStretchObjs.dollBody.scaleX=1.001,gameObjects.roomStretchObjs.dollBody.scaleY=1.001,gameObjects.roomStretchObjs.doll.scaleX=1.002,gameObjects.roomStretchObjs.doll.scaleY=1.003,setTimeout(()=>{gameObjects.roomStretchObjs.dollBody.scaleX=1,gameObjects.roomStretchObjs.dollBody.scaleY=1,gameObjects.roomStretchObjs.doll.scaleX=1,gameObjects.roomStretchObjs.doll.scaleY=1},40)},40)},50)):(gameObjects.roomStretchObjs.doll.rotation=.04,gameObjects.roomStretchObjs.dollBody.scaleY=1.008,gameObjects.roomStretchObjs.doll.scaleY=1.012,setTimeout(()=>{gameObjects.roomStretchObjs.dollBody.scaleY=1.003,gameObjects.roomStretchObjs.doll.scaleY=1.004,setTimeout(()=>{gameObjects.roomStretchObjs.dollBody.scaleY=1,gameObjects.roomStretchObjs.doll.scaleY=1},40)},50))))}function setStretchDollPos(e,a){gameObjects.roomStretchObjs.dollPosX=e,gameObjects.roomStretchObjs.dollPosY=a,gameObjects.roomStretchObjs.dollBody&&(gameObjects.roomStretchObjs.dollBody.x=gameObjects.roomStretchObjs.dollPosX,gameObjects.roomStretchObjs.dollBody.y=gameObjects.roomStretchObjs.dollPosY),gameObjects.roomStretchObjs.doll&&(gameObjects.roomStretchObjs.doll.x=gameObjects.roomStretchObjs.dollPosX+9,gameObjects.roomStretchObjs.doll.y=gameObjects.roomStretchObjs.dollPosY+-91)}function updateDollBodyImage(e){gameObjects.roomStretchObjs.dollBodyName!==e&&(gameObjects.roomStretchObjs.dollBodyName=e,gameObjects.roomStretchObjs.dollBody&&(gameObjects.roomStretchObjs.dollBody.visible=!1),gameObjects.roomStretchObjs.dollBodyList[e]?(gameObjects.roomStretchObjs.dollBodyList[e].visible=!0,gameObjects.roomStretchObjs.dollBody=gameObjects.roomStretchObjs.dollBodyList[e]):(gameObjects.roomStretchObjs.dollBody=globalScene.add.image(gameObjects.roomStretchObjs.dollPosX,gameObjects.roomStretchObjs.dollPosY,"roomStretch",e),gameObjects.roomStretchObjs.roomContainer.add(gameObjects.roomStretchObjs.dollBody),gameObjects.roomStretchObjs.dollBodyList[e]=gameObjects.roomStretchObjs.dollBody))}function updateStretchSounds(e){120<e&&(gameObjects.roomStretchObjs.lastSoundUpdate<=0?e<250?(playSound("rubber",5,.35),gameObjects.roomStretchObjs.lastSoundUpdate=80+Math.floor(50*Math.random())):(playSound("rubber",8,1),gameObjects.roomStretchObjs.lastSoundUpdate=60+Math.floor(10*Math.random())):gameObjects.roomStretchObjs.lastSoundUpdate--)}function updateStreamers(){for(let e=0;e<8;e++){var a=gameObjects.roomStretchObjs.streamersList[e];a.velY+=.1*(1-a.scaleY)-.03*a.velY,gameObjects.roomStretchObjs.streamersList[e].scaleY+=.014*a.velY}}function pullbackStreamers(){for(let e=0;e<8;e++){var a=gameObjects.roomStretchObjs.streamersList[e];a.y-=50,5!==e&&6!==e||(a.y-=100),a.scaleY+=.03+.08*Math.random()}addToUpdateFuncList(updateStreamers),setTimeout(()=>{removeFromUpdateFuncList(updateStreamers)},2e4)}function setupRoomJack(e,t,a){let o,s;gameObjects.exhibit.setBackgroundAtIndex(t,"bgs","bg8"),gameObjects.roomJackObjs||(gameObjects.roomJackObjs={roomIndex:t,roomContainer:a,jackJumpState:"default",shouldUpdate:!1,maxRotSpeed:.007,totalDistRotated:0,horrorCountdown:.6,horrorState:0,noteCount:0,rotateMusicAccumulate:0,speedRatio:1,canSpin:!0,eyeOffsetX:0,eyeOffsetY:0}),setupJackMusicSequence(),gameObjects.roomJackObjs.floor=e.add.image(0,960,"roomJack","floor"),gameObjects.roomJackObjs.floor.setOrigin(.5,1),a.add(gameObjects.roomJackObjs.floor),setupPortraits(a,e),gameObjects.roomJackObjs.streamers=e.add.image(0,-20,"roomJack","streamers"),gameObjects.roomJackObjs.streamers.scaleX=.88,gameObjects.roomJackObjs.streamers.scaleY=.9,gameObjects.roomJackObjs.streamers.setOrigin(.5,0),a.add(gameObjects.roomJackObjs.streamers),gameObjects.roomJackObjs.neck1=e.add.image(-450,-140,"roomJack","neck"),gameObjects.roomJackObjs.neck2=e.add.image(0,-150,"roomJack","neck"),gameObjects.roomJackObjs.neck3=e.add.image(450,-140,"roomJack","neck"),gameObjects.roomJackObjs.neck1.scaleX=.9,gameObjects.roomJackObjs.neck1.scaleY=.9,gameObjects.roomJackObjs.neck2.scaleX=-.9,gameObjects.roomJackObjs.neck2.scaleY=.9,gameObjects.roomJackObjs.neck2.rotation=2,gameObjects.roomJackObjs.neck3.scaleX=.9,gameObjects.roomJackObjs.neck3.scaleY=.9,gameObjects.roomJackObjs.neck2.rotation=3,gameObjects.roomJackObjs.neck1.visible=!1,gameObjects.roomJackObjs.neck2.visible=!1,gameObjects.roomJackObjs.neck3.visible=!1,a.add(gameObjects.roomJackObjs.neck1),a.add(gameObjects.roomJackObjs.neck2),a.add(gameObjects.roomJackObjs.neck3),setupJackArms(e),gameObjects.roomJackObjs.dollCreepy=e.add.image(-5,2010,"roomJack","dollcreepy"),gameObjects.roomJackObjs.dollCreepy.origYPos=2010,gameObjects.roomJackObjs.dollCreepy.scaleX=.42,a.add(gameObjects.roomJackObjs.dollCreepy),gameObjects.roomJackObjs.dollHeadUnder=e.add.image(-5,2010,"roomJack","dollEyeless").setOrigin(.5,1),gameObjects.roomJackObjs.dollHeadUnder.scaleX=.42,a.add(gameObjects.roomJackObjs.dollHeadUnder),gameObjects.roomJackObjs.headPopup1=e.add.image(-5,-9999,"roomJack","popup1"),gameObjects.roomJackObjs.headPopup1.visible=!1,a.add(gameObjects.roomJackObjs.headPopup1),gameObjects.roomJackObjs.pedestal=e.add.image(-10,gameVars.height+66,"roomJack","pedestal"),gameObjects.roomJackObjs.pedestal.setOrigin(.5,1),a.add(gameObjects.roomJackObjs.pedestal),gameObjects.roomJackObjs.dollHeadFlash1=e.add.image(-6,585,"roomJack","jack_flashes_rough_1").setOrigin(.5,1),gameObjects.roomJackObjs.dollHeadFlash1.visible=!1,a.add(gameObjects.roomJackObjs.dollHeadFlash1),gameObjects.roomJackObjs.dollHeadFlash2=e.add.image(-6,585,"roomJack","jack_flashes_rough_2").setOrigin(.5,1),gameObjects.roomJackObjs.dollHeadFlash2.visible=!1,a.add(gameObjects.roomJackObjs.dollHeadFlash2),gameObjects.roomJackObjs.box=e.add.image(0,665,"roomJack","box"),a.add(gameObjects.roomJackObjs.box),gameObjects.roomJackObjs.lid=e.add.image(93,575,"roomJack","lid"),gameObjects.roomJackObjs.lid.rotVel=0,a.add(gameObjects.roomJackObjs.lid),gameObjects.roomJackObjs.dollEyes=e.add.image(-5,2010,"roomJack","dollEyes").setOrigin(.5,1),gameObjects.roomJackObjs.dollEyes.scaleX=.8,gameObjects.roomJackObjs.dollEyes.visible=!1,a.add(gameObjects.roomJackObjs.dollEyes),gameObjects.roomJackObjs.dollHead=e.add.image(-5,2010,"roomJack","dollEyeless").setOrigin(.5,1),gameObjects.roomJackObjs.dollHead.scaleX=.8,gameObjects.roomJackObjs.dollHead.visible=!1,a.add(gameObjects.roomJackObjs.dollHead),gameObjects.roomJackObjs.halfHeightDiffDoll=.5*(gameObjects.roomJackObjs.dollCreepy.height-2*gameObjects.roomJackObjs.dollHead.height),gameObjects.roomJackObjs.dollHead.y=gameObjects.roomJackObjs.dollCreepy.y-gameObjects.roomJackObjs.halfHeightDiffDoll,gameObjects.roomJackObjs.dollHeadUnder.y=gameObjects.roomJackObjs.dollHead.y,gameObjects.roomJackObjs.dollEyes.y=gameObjects.roomJackObjs.dollHead.y,gameObjects.roomJackObjs.headPopup2=e.add.image(gameObjects.roomJackObjs.dollHead.x,-9999,"roomJack","popup2"),gameObjects.roomJackObjs.headPopup2.visible=!1,a.add(gameObjects.roomJackObjs.headPopup2),gameObjects.roomJackObjs.placard=new Button(e,a,()=>{gameVars.horrorPoint?updateInfoText("Turn the handle."):gameVars.darkPoint&&gameObjects.roomJackObjs.canSpin?updateInfoText("Unturn the handle."):updateInfoText("Jack in the Box")},{atlas:"buttons",ref:"placard",x:-4,y:gameVars.height-73},{atlas:"buttons",ref:"placard_hover",preload:!0}),gameObjects.roomJackObjs.spinner=e.add.image(0,670,"roomJack","spinner"),a.add(gameObjects.roomJackObjs.spinner),gameObjects.roomJackObjs.spinner.rotVel=0,gameObjects.roomJackObjs.dollface=e.add.image(80,-320,"roomJack","dollface"),gameObjects.roomJackObjs.dollface.rotation=3.16,gameObjects.roomJackObjs.dollface.scaleExpand=.001,gameObjects.roomJackObjs.dollface.scaleX=.5,gameObjects.roomJackObjs.dollface.scaleY=.5,gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.dollface),gameObjects.roomJackObjs.dollmouth=e.add.image(80,-320,"roomJack","dollmouth"),gameObjects.roomJackObjs.dollmouth.rotation=3.16,gameObjects.roomJackObjs.dollmouth.scaleX=.5,gameObjects.roomJackObjs.dollmouth.scaleY=.5,gameObjects.roomJackObjs.dollmouth.scaleYRatio=1.05,gameObjects.roomJackObjs.dollmouth.scaleYVel=.02,gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.dollmouth),gameObjects.roomJackObjs.spinnerButton=new Button(e,{container:a,normal:{ref:"blackPixel",x:0,y:gameVars.halfHeight,alpha:.001,scaleX:58,scaleY:58},isDraggable:!0,onDrop:resetSpinnerButton}),addToUpdateFuncList(roomJackUpdate),resetSpinnerButton(),messageBus.subscribe("exhibitMove",(e,a)=>{e===t?(tweenVolume("gladiator0",0),tweenVolume("gladiator1",.9),tweenVolume("gladiator2",.1),tweenVolume("gladiatorx",.1),gameVars.darkPoint&&(gameObjects.roomJackObjs.eyeOffsetX=4,setTimeout(()=>{removeFromUpdateFuncList(shakeJackHead),gameObjects.roomJackObjs.eyeOffsetX=0,gameObjects.roomJackObjs.dollHead.rotation=0,gameObjects.roomJackObjs.dollHeadSmile.visible=!1},1300)),addGuideArrowToContainer(gameObjects.roomJackObjs.roomContainer),updateGuideArrow(0,-9999),gameObjects.roomJackObjs.shouldUpdate=!0,gameObjects.roomJackObjs.lightsReady&&(gameObjects.moveLeftBtn.setOnMouseUpFunc(()=>{gameObjects.roomJackObjs.eyeOffsetY+=1,gameObjects.moveLeftBtn.setState("disable"),updateInfoText("There is no reason to turn back",4500),console.log("...")}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.lights,alpha:.8,scaleX:2,scaleY:2,duration:3e3}))):(setTimeout(()=>{gameObjects.roomJackObjs.shouldUpdate=!1},600),gameVars.darkPoint&&e<t&&a===t&&(gameObjects.roomJackObjs.fakeEyes=globalScene.add.image(gameVars.halfWidth,gameVars.halfHeight+20,"roomJack","dollEyesFake"),gameObjects.roomJackObjs.fakeEyes.scaleY=.01,setTimeout(()=>{gameObjects.roomJackObjs.dollHeadSmile.visible=!0},250),globalScene.tweens.add({targets:gameObjects.roomJackObjs.fakeEyes,scaleY:1,duration:150,ease:"Cubic.easeIn",delay:250}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.fakeEyes,x:gameVars.width+80+gameVars.halfWidth,duration:1510,ease:"Cubic.easeInOut",onComplete:()=>{gameObjects.roomJackObjs.fakeEyes.destroy(),gameObjects.roomJackObjs.dollHeadSmile.visible=!1}})))}),o=messageBus.subscribe("startDarkSequence",e=>{gameObjects.roomJackObjs.portraitBox.visible=!0,gameObjects.roomJackObjs.portraitGiraffe.visible=!0,gameObjects.roomJackObjs.noteCount=0,gameObjects.roomJackObjs.rotateMusicAccumulate=0,gameObjects.roomJackObjs.totalDistRotated=0,gameObjects.roomJackObjs.canSpin=!0,gameObjects.roomJackObjs.dollHeadSmile=globalScene.add.image(gameObjects.roomJackObjs.dollHead.x,gameObjects.roomJackObjs.dollHead.y,"roomJack","dollEyelessSmile").setOrigin(.5,1),gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.dollHeadSmile),addToUpdateFuncList(shakeJackHead),o.unsubscribe()}),s=messageBus.subscribe("startHorrorSequence",e=>{gameObjects.roomJackObjs.noteCount=0,gameObjects.roomJackObjs.rotateMusicAccumulate=0,gameObjects.roomJackObjs.totalDistRotated=0,gameObjects.roomJackObjs.canSpin=!0,gameObjects.roomJackObjs.eyeOffsetX=0,gameObjects.roomJackObjs.eyeOffsetY=0,s.unsubscribe()}),messageBus.subscribe("speedUp",()=>{gameObjects.roomJackObjs.speedRatio*=1.05}),messageBus.subscribe("speedDown",()=>{gameObjects.roomJackObjs.speedRatio*=.8}),messageBus.subscribe("passedSafePoint",()=>{gameObjects.roomJackObjs.passedSafePoint=!0})}function roomJackUpdate(b){if(gameObjects.roomJackObjs.shouldUpdate){if(gameObjects.roomJackObjs.spinnerButton.getIsDragged()&&gameObjects.roomJackObjs.canSpin||gameObjects.roomJackObjs.isAutopilot){let e=gameObjects.roomJackObjs.spinnerButton.getXPos(),a=gameObjects.roomJackObjs.spinnerButton.getYPos(),t=e-gameObjects.roomJackObjs.spinner.x,o=a-gameObjects.roomJackObjs.spinner.y,s=Math.atan2(o,t),m=(s>Math.PI&&(s-=2*Math.PI),s-gameObjects.roomJackObjs.spinner.rotation),r=(m>Math.PI?m-=2*Math.PI:m<-Math.PI&&(m+=2*Math.PI),gameObjects.roomJackObjs.maxRotSpeed*gameObjects.roomJackObjs.speedRatio),c=0;gameObjects.roomJackObjs.isAutopilot?(c=r,gameObjects.roomJackObjs.spinnerButton.getIsDragged()&&m<.01&&(c-=Math.min(.5*r,Math.abs(.003*m)))):.01<m&&!gameVars.darkPoint?c=Math.min(r,.02*m):gameVars.darkPoint&&m<.01&&(c=Math.max(-r,.02*m)),gameObjects.roomJackObjs.slowRotation&&(c*=.45),1e-5<Math.abs(c)&&(gameObjects.roomJackObjs.spinner.rotVel+=c*b),gameObjects.roomJackObjs.spinner.rotation+=gameObjects.roomJackObjs.spinner.rotVel,gameObjects.roomJackObjs.totalDistRotated+=gameObjects.roomJackObjs.spinner.rotVel,gameVars.darkPoint?checkMusicSequenceDark(gameObjects.roomJackObjs.spinner.rotVel):gameVars.horrorPoint?checkMusicSequenceHorror(gameObjects.roomJackObjs.spinner.rotVel,b):checkMusicSequenceNormal(gameObjects.roomJackObjs.spinner.rotVel)}gameObjects.roomJackObjs.spinnerButton.getIsDragged()&&gameObjects.roomJackObjs.canSpin&&updateGuideArrowJack(),gameObjects.roomJackObjs.spinner.rotVel*=.5,gameObjects.roomJackObjs.animateLid&&(gameObjects.roomJackObjs.lid.rotation+=gameObjects.roomJackObjs.lid.rotVel,gameObjects.roomJackObjs.lid.rotVel*=.831,gameObjects.roomJackObjs.lid.rotVel<=.01)&&(gameObjects.roomJackObjs.animateLid=!1),"jump"===gameObjects.roomJackObjs.jackJumpState&&(gameObjects.roomJackObjs.lid.rotation+=gameObjects.roomJackObjs.lid.rotVel,gameObjects.roomJackObjs.lid.rotVel*=.831,3<gameObjects.roomJackObjs.lid.rotation)&&(gameObjects.roomJackObjs.jackJumpState="finished",gameVars.horrorPoint||setTimeout(()=>{createKey(gameObjects.roomJackObjs.box.x,gameObjects.roomJackObjs.box.y-60,gameObjects.roomJackObjs.roomIndex,gameObjects.roomJackObjs.roomContainer,!0)},250)),gameObjects.roomJackObjs.dollHead.x=gameObjects.roomJackObjs.dollCreepy.x,gameObjects.roomJackObjs.dollHead.y=gameObjects.roomJackObjs.dollCreepy.y-gameObjects.roomJackObjs.halfHeightDiffDoll,gameObjects.roomJackObjs.dollHead.scaleX=gameObjects.roomJackObjs.dollCreepy.scaleX,gameObjects.roomJackObjs.dollEyes.x=gameObjects.roomJackObjs.dollCreepy.x+gameObjects.roomJackObjs.eyeOffsetX,gameObjects.roomJackObjs.dollEyes.y=gameObjects.roomJackObjs.dollCreepy.y-gameObjects.roomJackObjs.halfHeightDiffDoll+gameObjects.roomJackObjs.eyeOffsetY,gameObjects.roomJackObjs.dollEyes.scaleX=gameObjects.roomJackObjs.dollCreepy.scaleX,gameObjects.roomJackObjs.dollHeadUnder.x=gameObjects.roomJackObjs.dollHead.x,gameObjects.roomJackObjs.dollHeadUnder.y=gameObjects.roomJackObjs.dollHead.y,gameObjects.roomJackObjs.dollHeadUnder.scaleX=gameObjects.roomJackObjs.dollHead.scaleX,updateJackArmsLeft(b),(gameObjects.roomJackObjs.useAltArmMovement?updateJackArmsRightAuto:updateJackArmsRight)()}}function resetSpinnerButton(){var e=gameObjects.roomJackObjs.spinner.x+121*Math.cos(gameObjects.roomJackObjs.spinner.rotation),a=gameObjects.roomJackObjs.spinner.y+121*Math.sin(gameObjects.roomJackObjs.spinner.rotation);gameObjects.roomJackObjs.spinnerButton.setPos(e,a),resetGuideArrowJack()}function createNoteVisual(e,a,t=15728640){let o=null,s=(0<gameObjects.noteList.length?o=gameObjects.noteList.pop():((o=globalScene.add.image(0,0,"misc","note")).depth=999,gameObjects.roomJackObjs.roomContainer.add(o)),o.x=e,o.y=a,o.scaleX=.85,o.scaleY=.85,o.setTint(t),.1*Math.random());globalScene.tweens.add({targets:o,ease:"Cubic.easeOut",scaleX:1.03+s,scaleY:1.03+s,duration:250,onComplete:()=>{globalScene.tweens.add({targets:o,ease:"Cubic.easeIn",scaleX:.99+s,scaleY:.99+s,duration:250,onComplete:()=>{globalScene.tweens.add({targets:o,scaleX:1+s,scaleY:1+s,duration:200,onComplete:()=>{globalScene.tweens.add({targets:o,ease:"Cubic.easeIn",scaleX:0,scaleY:0,duration:125})}})}})}}),globalScene.tweens.add({targets:o,ease:"Cubic.easeOut",y:o.y-50+10*Math.random(),duration:700,onComplete:()=>{gameObjects.noteList.push(o)}})}function checkMusicSequenceNormal(e){"default"===gameObjects.roomJackObjs.jackJumpState&&(gameObjects.roomJackObjs.rotateMusicAccumulate+=e,gameObjects.roomJackObjs.noteCount>=gameObjects.roomJackObjs.musicDataNormal.length?(gameObjects.roomJackObjs.jackJumpState="jump",gameObjects.roomJackObjs.lid.rotVel=.51,animatePopUp(),playLastNotes(),playSound("nyaha"),playSound("squeakopen"),gameObjects.roomJackObjs.canSpin=!1,resetGuideArrowJack()):(e=gameObjects.roomJackObjs.musicDataNormal[gameObjects.roomJackObjs.noteCount],gameObjects.roomJackObjs.rotateMusicAccumulate>e.accumulate&&(e.static?showStaticRand(1,void 0,void 0,.06):e.slowSpin?gameObjects.roomJackObjs.slowRotation=!0:(playMusicBoxNote(e.note,e.volume,e.tint,void 0),gameObjects.roomJackObjs.slowRotation=!1),gameObjects.roomJackObjs.noteCount++,gameObjects.roomJackObjs.rotateMusicAccumulate=0)))}function checkMusicSequenceDark(e){var a;gameObjects.exhibit.needCleanup&&(gameObjects.roomJackObjs.rotateMusicAccumulate-=e,(a=gameObjects.roomJackObjs.musicDataDark[gameObjects.roomJackObjs.noteCount])?gameObjects.roomJackObjs.rotateMusicAccumulate>a.accumulate&&(a.static?showStaticRand(1,void 0,void 0,.06):a.slowSpin?gameObjects.roomJackObjs.slowRotation=!0:(playMusicBoxNote(a.note,a.volume,a.tint),gameObjects.roomJackObjs.slowRotation=!1),gameObjects.roomJackObjs.noteCount++,gameObjects.roomJackObjs.rotateMusicAccumulate=0):(gameObjects.roomJackObjs.lid.rotation-=.09,gameObjects.roomJackObjs.dollCreepy.y=Math.min(2010,gameObjects.roomJackObjs.dollCreepy.y+11),gameObjects.roomJackObjs.dollCreepy.scaleX=Math.max(.4,gameObjects.roomJackObjs.dollCreepy.scaleX-.07),gameObjects.roomJackObjs.dollHead.visible=!1,gameObjects.roomJackObjs.dollEyes.visible=!1,gameObjects.roomJackObjs.dollHeadUnder.visible=!0,gameObjects.roomJackObjs.playedSlam||(setTimeout(()=>{playSound("lidslam"),setTimeout(()=>{zoomTemp(1.028),gameObjects.roomJackObjs.dollCreepy.y=2010,gameObjects.roomJackObjs.lid.rotation=0},170)},70),gameObjects.roomJackObjs.playedSlam=!0)),gameObjects.roomJackObjs.dollCreepy.y=Math.min(2010,gameObjects.roomJackObjs.dollCreepy.y-5*e),gameObjects.roomJackObjs.lid.rotation=Math.max(0,gameObjects.roomJackObjs.lid.rotation+.2*e),gameObjects.roomJackObjs.lid.rotation<=.01)&&(gameObjects.roomJackObjs.lid.rotation=0,gameObjects.exhibit.needCleanup=!1,gameObjects.roomJackObjs.canSpin=!1,resetGuideArrowJack(),setTimeout(()=>{playSound("deepbell1"),updateInfoTextSoft("Room cleaned up.",2500)},400))}function checkMusicSequenceHorror(e,a=0){var t;gameObjects.roomJackObjs.rotateMusicAccumulate+=e,gameObjects.roomJackObjs.startFinale&&(t=e*(gameObjects.roomJackObjs.isAutopilot?23:7),gameObjects.roomJackObjs.dollCreepy.y-=t,gameObjects.roomJackObjs.neck1.rotation+=.004*t,gameObjects.roomJackObjs.neck2.rotation-=.004*t,gameObjects.roomJackObjs.neck3.rotation+=.004*t,gameObjects.roomJackObjs.eyeOffsetY-=.05*t,gameObjects.roomJackObjs.eyeOffsetY<-24&&(gameObjects.roomJackObjs.eyeOffsetY=24),addScreenShake((Math.random()-.5)*e*3,(Math.random()-.5)*e*3),gameObjects.roomJackObjs.dollCreepy.y<-600?(addScreenShake((Math.random()-.5)*e*4,(Math.random()-.5)*e*8),gameObjects.roomJackObjs.dollface.y+=40*e,gameObjects.roomJackObjs.dollface.x-=3*e,gameObjects.roomJackObjs.dollface.rotation+=.001*e,gameObjects.roomJackObjs.dollface.scaleY=gameObjects.roomJackObjs.dollface.scaleY+.035*e,gameObjects.roomJackObjs.dollface.scaleX=gameObjects.roomJackObjs.dollface.scaleY*(1+.05*Math.sin(20*gameObjects.roomJackObjs.rotateMusicAccumulate)),showStaticLite(),590<gameObjects.roomJackObjs.dollface.y&&(removeFromUpdateFuncList(roomJackUpdate),disableMoveLeftButton(),showFlashRand(5,void 0,()=>{showStaticRand(4),gameObjects.sounds.squeak3.stop(),gameObjects.exhibit.moveRight(!0),gameObjects.roomJackObjs.neck1.visible=!1,gameObjects.roomJackObjs.neck2.visible=!1,gameObjects.roomJackObjs.neck3.visible=!1,disableMoveButtons(),gameObjects.roomJackObjs.dollface.destroy(),gameObjects.roomJackObjs.dollmouth.destroy(),showFlashArr([5,6,7,8,17,9,17,10,18],()=>{disableMoveLeftButton(),setTimeout(()=>{disableMoveLeftButton()},20)})}))):gameObjects.roomJackObjs.dollCreepy.y<950&&(Math.random()<.25&&showStaticLite(1),gameObjects.roomJackObjs.playedLaugh||(gameObjects.roomJackObjs.playedLaugh=!0,playSound("clownlaughfinal"),tweenVolume("gladiatorx",0),messageBus.publish("prepareFinalClown")))),gameObjects.roomJackObjs.dollmouth.x=gameObjects.roomJackObjs.dollface.x,gameObjects.roomJackObjs.dollmouth.y=gameObjects.roomJackObjs.dollface.y,gameObjects.roomJackObjs.dollmouth.scaleX=gameObjects.roomJackObjs.dollface.scaleX,gameObjects.roomJackObjs.dollmouth.scaleY=gameObjects.roomJackObjs.dollface.scaleY*gameObjects.roomJackObjs.dollmouth.scaleYRatio,gameObjects.roomJackObjs.dollmouth.scaleYRatio<=1?gameObjects.roomJackObjs.dollmouth.scaleYVel=.035:1.14<=gameObjects.roomJackObjs.dollmouth.scaleYRatio&&(gameObjects.roomJackObjs.dollmouth.scaleYVel=-.035),gameObjects.roomJackObjs.dollmouth.scaleYRatio+=gameObjects.roomJackObjs.dollmouth.scaleYVel,gameObjects.roomJackObjs.noteCount>=gameObjects.roomJackObjs.musicDataHorror.length||(t=gameObjects.roomJackObjs.musicDataHorror[gameObjects.roomJackObjs.noteCount],gameObjects.roomJackObjs.rotateMusicAccumulate>t.accumulate&&(t.sfx&&playSound(t.sfx),t.static?(t.duration,e=t.duration?1:.25,showStaticRand(1,void 0,void 0,e)):t.slowSpin?gameObjects.roomJackObjs.slowRotation=!0:t.popupHeadHorror?(gameObjects.roomJackObjs.placard.setOnMouseUpFunc(()=>{showStaticLite(),updateInfoText("TURN THE HANDLE")}),gameObjects.roomJackObjs.jackJumpState="jump",gameObjects.roomJackObjs.lid.rotVel=.4,gameObjects.roomJackObjs.dollHeadUnder.destroy(),animatePopUp(),playSound("nyaha"),playSound("squeakopen"),setTimeout(()=>{showStaticRand(2,void 0,void 0,.15),setTimeout(()=>{showStaticRand(1,void 0,void 0,.07)},3e3)},1600)):t.startFinale?startFinale():t.showLeftArm?(gameObjects.roomJackObjs.dollHeadFlash2.visible=!1,showFlashRand(2),jumpOutLeftArm(),showStaticRand(2,void 0,void 0,.15),setTimeout(()=>{gameObjects.roomJackObjs.passedSafePoint||(gameObjects.sounds.pumpamb.play(),gameObjects.sounds.pumpamb.volume=1,gameObjects.roomJackObjs.dollHeadFlash2.visible=!0,gameObjects.roomJackObjs.dollHeadFlash2.scaleX=.9,gameObjects.roomJackObjs.dollHeadFlash2.scaleY=.9,gameObjects.roomJackObjs.dollHead.visible=!1,gameObjects.roomJackObjs.dollEyes.visible=!1,gameObjects.roomJackObjs.dollCreepy.visible=!1,addToUpdateFuncList(shakeHeadFlashTwo),setTimeout(()=>{gameObjects.sounds.pumpamb.stop(),gameObjects.roomJackObjs.dollHeadFlash2.visible=!1,removeFromUpdateFuncList(shakeHeadFlashTwo),showStaticRand(1),showFlashRand(1),gameObjects.roomJackObjs.dollHead.visible=!0,gameObjects.roomJackObjs.dollEyes.visible=!0,gameObjects.roomJackObjs.dollCreepy.visible=!0},385))},7e3)):t.showRightArm?(gameObjects.roomJackObjs.dollHead.visible=!1,gameObjects.roomJackObjs.dollEyes.visible=!1,gameObjects.roomJackObjs.dollCreepy.visible=!1,gameObjects.roomJackObjs.lights.alpha*=.5,gameObjects.roomJackObjs.dollHeadFlash1.visible=!0,gameObjects.roomJackObjs.dollHeadFlash1.scaleX=.8,gameObjects.roomJackObjs.dollHeadFlash1.scaleY=.8,addToUpdateFuncList(shakeHeadFlashOne),showFlashRand(2),setTimeout(()=>{showFlashRand(1),playSound("squeak1")},150),playSound("void"),playSound("stopmusic"),setTimeout(()=>{showFlashRand(2),gameObjects.roomJackObjs.dollHead.visible=!0,gameObjects.roomJackObjs.dollEyes.visible=!0,gameObjects.roomJackObjs.dollCreepy.visible=!0,removeFromUpdateFuncList(shakeHeadFlashOne),gameObjects.roomJackObjs.dollHeadFlash1.destroy(),gameObjects.roomJackObjs.lights.alpha*=2,jumpOutRightArm(),gameObjects.sounds.void.stop()},475),showStaticRand(2,void 0,void 0,.15)):t.message?messageBus.publish(t.message):t.startAutoSpin?(gameObjects.roomJackObjs.spinnerButton.destroy(),gameObjects.roomJackObjs.speedRatio=12.5,flipToAutoSpinArm()):t.updateProp?gameObjects.roomJackObjs[t.updateProp]=t.updateVal:t.special||(playMusicBoxNote(t.note,t.volume,t.tint),gameObjects.roomJackObjs.slowRotation=!1),gameObjects.roomJackObjs.noteCount++,gameObjects.roomJackObjs.rotateMusicAccumulate=0))}function setupJackMusicSequence(){gameObjects.roomJackObjs.musicDataNormal=[{accumulate:.1,note:"g6",tint:6684842},{accumulate:.195,slowSpin:!0},{accumulate:.05,note:"c7b",tint:1118702},{accumulate:.4,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.4,note:"d7",tint:56831},{accumulate:.2,note:"e7",tint:65280},{accumulate:.2,note:"g7",tint:16711680},{accumulate:.2,note:"e7",tint:65280},{accumulate:.2,note:"c7",tint:4607},{accumulate:.45,slowSpin:!0},{accumulate:.05,static:!0},{accumulate:.15,static:!0},{accumulate:.4,note:"g6",tint:3342506,volume:.5},{accumulate:.01,note:"c7",tint:4607,volume:.4},{accumulate:.01,note:"e7",tint:2280618,volume:.3},{accumulate:.01,note:"a7",tint:16724787}],gameObjects.roomJackObjs.musicDataDark=[{accumulate:.02,slowSpin:!0},{accumulate:.05,static:!0},{accumulate:.1,note:"a7",tint:16724787},{accumulate:.6,note:"g7",tint:15597568},{accumulate:.6,note:"f7b",tint:11184674},{accumulate:.6,note:"e7",tint:2263159},{accumulate:.6,note:"d7",tint:26231},{accumulate:.6,note:"c7b",tint:1118532},{accumulate:.8,static:!0},{accumulate:.02,slowSpin:!0},{accumulate:.01,note:"g6s",tint:0}],gameObjects.roomJackObjs.musicDataHorror=[{accumulate:.02,slowSpin:!0},{accumulate:.05,note:"g6",tint:3342506},{accumulate:.1,static:!0,duration:4},{accumulate:.02,slowSpin:!0,sfx:"squeak2"},{accumulate:.4,note:"c7",tint:4607},{accumulate:.5,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.4,note:"d7",tint:56831},{accumulate:.2,note:"e7",tint:2280618},{accumulate:.2,note:"g7",tint:16711680},{accumulate:.2,note:"e7",tint:65280},{accumulate:.2,note:"c7",tint:4607},{accumulate:.8,note:"g6",tint:3342506},{accumulate:.2,note:"c7",tint:4607},{accumulate:.4,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.4,note:"d7",tint:56831},{accumulate:.2,note:"e7",tint:65280},{accumulate:.65,note:"c7",tint:4607},{accumulate:.2,note:"g6",tint:3342506},{accumulate:.2,note:"c7",tint:4607},{accumulate:.4,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.4,note:"d7",tint:56831},{accumulate:.2,note:"e7",tint:65280},{accumulate:.2,note:"g7",tint:16711680},{accumulate:.2,note:"e7",tint:2280618},{accumulate:.2,note:"c7",tint:4607},{accumulate:.01,static:!0},{accumulate:.2,slowSpin:!0},{accumulate:.01,static:!0},{accumulate:.2,slowSpin:!0,sfx:"squeak2"},{accumulate:.05,popupHeadHorror:!0},{accumulate:.3,slowSpin:!0},{accumulate:.35,startFinale:!0,sfx:"squeak1"},{accumulate:.4,note:"g6",tint:3342506},{accumulate:.2,note:"c7",tint:4607},{accumulate:.4,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.4,note:"d7",tint:56831},{accumulate:.2,note:"e7",tint:65280},{accumulate:.01,showLeftArm:!0},{accumulate:.01,slowSpin:!0},{accumulate:.3,slowSpin:!0,sfx:"squeak1"},{accumulate:.3,note:"c7",tint:4607},{accumulate:.4,note:"g6",tint:3342506},{accumulate:.01,message:"passedSafePoint"},{accumulate:.01,message:"speedDown"},{accumulate:.2,note:"c7",tint:4607},{accumulate:.4,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.4,note:"d7",tint:56831},{accumulate:.2,note:"e7",tint:65280},{accumulate:.2,note:"g7",tint:16711680},{accumulate:.2,note:"e7",tint:65280},{accumulate:.2,showRightArm:!0},{accumulate:.01,note:"c7",tint:4607},{accumulate:.8,note:"g6",tint:3342506},{accumulate:.2,note:"c7",tint:4607},{accumulate:.4,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.4,note:"d7",tint:56831},{accumulate:.4,note:"d7",tint:56831},{accumulate:.5,note:"d7",tint:56831},{accumulate:.6,note:"d7",tint:56831},{accumulate:.3,startAutoSpin:!0}];var e=[{accumulate:.2,note:"c7",tint:4607},{accumulate:.4,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.4,note:"d7",tint:56831},{accumulate:.2,note:"e7",tint:65280},{accumulate:.2,note:"g7",tint:16711680},{accumulate:.2,note:"e7",tint:65280},{accumulate:.2,note:"c7",tint:4607},{accumulate:.4,note:"g6",tint:3342506},{accumulate:.2,note:"c7",tint:4607},{accumulate:.4,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.4,note:"d7",tint:56831},{accumulate:.2,note:"e7",tint:65280},{accumulate:.6,note:"c7",tint:4607},{accumulate:.4,note:"g6",tint:3342506}],a=[{accumulate:.2,note:"c7",tint:4607},{accumulate:.2,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.2,note:"g7",tint:65280},{accumulate:.01,message:"speedUp"}],t=[{accumulate:.2,note:"f7",tint:4607},{accumulate:.2,note:"f7b",tint:4607},{accumulate:.01,message:"speedUp"}];gameObjects.roomJackObjs.musicDataHorror=gameObjects.roomJackObjs.musicDataHorror.concat([{accumulate:.4,note:"g6",tint:3342506},{accumulate:.2,note:"c7",tint:4607},{accumulate:.4,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.4,note:"d7",tint:56831},{accumulate:.01,message:"disableMoveButtons"},{accumulate:.2,note:"e7",tint:65280},{accumulate:.2,note:"g7",tint:16711680},{accumulate:.2,note:"e7",tint:65280},{accumulate:.2,note:"c7",tint:4607},{accumulate:.01,message:"speedUp"},{accumulate:.4,note:"g6",tint:3342506},{accumulate:.2,note:"c7",tint:4607},{accumulate:.4,note:"c7",tint:4607},{accumulate:.2,note:"d7",tint:56831},{accumulate:.8,note:"d7",tint:56831},{accumulate:.2,note:"e7",tint:65280},{accumulate:.4,note:"c7",tint:4607},{accumulate:.01,message:"speedUp"}]),gameObjects.roomJackObjs.musicDataHorror=gameObjects.roomJackObjs.musicDataHorror.concat(e),gameObjects.roomJackObjs.musicDataHorror=gameObjects.roomJackObjs.musicDataHorror.concat(e),gameObjects.roomJackObjs.musicDataHorror=gameObjects.roomJackObjs.musicDataHorror.concat(a),gameObjects.roomJackObjs.musicDataHorror=gameObjects.roomJackObjs.musicDataHorror.concat(a),gameObjects.roomJackObjs.musicDataHorror=gameObjects.roomJackObjs.musicDataHorror.concat(t),gameObjects.roomJackObjs.musicDataHorror=gameObjects.roomJackObjs.musicDataHorror.concat(t),gameObjects.roomJackObjs.musicDataHorror=gameObjects.roomJackObjs.musicDataHorror.concat(t),gameObjects.roomJackObjs.musicDataHorror=gameObjects.roomJackObjs.musicDataHorror.concat(t),gameObjects.roomJackObjs.musicDataHorror=gameObjects.roomJackObjs.musicDataHorror.concat([{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.01,message:"speedUp"},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.01,message:"speedUp"},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.01,message:"speedUp"},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.01,message:"speedUp"},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.2,note:"creepysfx",tint:0},{accumulate:.01,message:"speedUp"}])}function playLastNotes(){setTimeout(()=>{playMusicBoxNote("d7",void 0,56831),setTimeout(()=>{playMusicBoxNote("f7",void 0,16776960),setTimeout(()=>{playMusicBoxNote("e7",void 0,65280),setTimeout(()=>{playMusicBoxNote("c7",void 0,4607)},400)},200)},200)},1e3)}function playMusicBoxNote(e,a,t,o){playSound(e,void 0,a);let s=o;createNoteVisual(s=null==s?gameObjects.roomJackObjs.box.x+150*(Math.random()-.5):s,gameObjects.roomJackObjs.box.y-8*Math.random()-110,t)}function updateGuideArrowJack(){let e=gameObjects.roomJackObjs.spinner.x,a=gameObjects.roomJackObjs.spinner.y,t=gameObjects.roomJackObjs.spinner.rotation,o=e+121*Math.cos(t),s=a+121*Math.sin(t),m=gameVars.mouseposx-o-gameVars.halfWidth,r=gameVars.mouseposy-s,c=Math.min(120,Math.sqrt(m*m+r*r));c<35&&(c=0),updateGuideArrow(o,s,Math.atan2(r,m),c)}function resetGuideArrowJack(){updateGuideArrow(0,-9999)}function animatePopUp(){gameObjects.roomJackObjs.headPopup1.visible=!0,gameObjects.roomJackObjs.dollCreepy.visible=!1,addToUpdateFuncList(updatePopUp),globalScene.tweens.add({targets:gameObjects.roomJackObjs.dollCreepy,y:gameObjects.roomJackObjs.dollCreepy.origYPos-266,ease:"Cubic.easeOut",duration:275,onComplete:()=>{globalScene.tweens.add({targets:gameObjects.roomJackObjs.dollCreepy,y:gameObjects.roomJackObjs.dollCreepy.origYPos-260,ease:"Elastic",easeParams:[1.3,.25],duration:500})}}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.dollCreepy,scaleX:.65,ease:"Cubic.easeIn",duration:75,onComplete:()=>{gameObjects.roomJackObjs.headPopup1.visible=!1,gameObjects.roomJackObjs.headPopup2.visible=!0,globalScene.tweens.add({targets:gameObjects.roomJackObjs.dollCreepy,scaleX:1.3,ease:"Cubic.easeIn",duration:110,onComplete:()=>{globalScene.tweens.add({targets:gameObjects.roomJackObjs.dollCreepy,scaleX:1,ease:"Cubic.easeOut",duration:60,onComplete:()=>{gameObjects.roomJackObjs.headPopup2.visible=!1,gameObjects.roomJackObjs.dollEyes.visible=!0,gameObjects.roomJackObjs.dollHead.visible=!0,gameObjects.roomJackObjs.dollCreepy.visible=!0,gameObjects.roomJackObjs.dollHeadUnder.visible=!1,removeFromUpdateFuncList(updatePopUp)}})}})}})}function updatePopUp(){var e=gameObjects.roomJackObjs.dollCreepy.y-1400,a=gameObjects.roomJackObjs.dollCreepy.scaleX;gameObjects.roomJackObjs.headPopup1.y=e,gameObjects.roomJackObjs.headPopup2.y=e,gameObjects.roomJackObjs.headPopup2.scaleX=a}function setupJackArms(e){gameObjects.roomJackObjs.leftArm1=e.add.image(-52,gameVars.height+310,"roomJack","upperArm").setOrigin(.02,.5),gameObjects.roomJackObjs.leftArm1.shadowLength=.03,gameObjects.roomJackObjs.leftArm1.origX=gameObjects.roomJackObjs.leftArm1.x,gameObjects.roomJackObjs.leftArm1.rotation=.5*-Math.PI,gameObjects.roomJackObjs.leftArm1.goalRot=gameObjects.roomJackObjs.leftArm1.rotation,gameObjects.roomJackObjs.leftArm1.trueRot=gameObjects.roomJackObjs.leftArm1.rotation,gameObjects.roomJackObjs.leftArm2=e.add.image(0,9999,"roomJack","midArm").setOrigin(.06,.5),gameObjects.roomJackObjs.leftArm2.rotation=.5*Math.PI,gameObjects.roomJackObjs.leftArm2.goalRot=gameObjects.roomJackObjs.leftArm2.rotation,gameObjects.roomJackObjs.leftArm2.trueRot=gameObjects.roomJackObjs.leftArm2.rotation,gameObjects.roomJackObjs.leftArm2.scaleY=-1,gameObjects.roomJackObjs.leftArm3=e.add.image(0,9999,"roomJack","lowerArm").setOrigin(.07,.5),gameObjects.roomJackObjs.leftArm3.scaleY=-1,gameObjects.roomJackObjs.leftArm3.rotation=.5*Math.PI,gameObjects.roomJackObjs.leftArm3.goalRot=gameObjects.roomJackObjs.leftArm3.rotation,gameObjects.roomJackObjs.leftArm3.trueRot=gameObjects.roomJackObjs.leftArm3.rotation,gameObjects.roomJackObjs.leftHand=e.add.image(0,9999,"roomJack","hand2"),gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.leftArm1),gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.leftArm2),gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.leftArm3),gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.leftHand),gameObjects.roomJackObjs.rightArm1=e.add.image(52,gameVars.height+310,"roomJack","upperArm").setOrigin(.02,.5),gameObjects.roomJackObjs.rightArm1.shadowLength=.03,gameObjects.roomJackObjs.rightArm1.origX=gameObjects.roomJackObjs.rightArm1.x,gameObjects.roomJackObjs.rightArm1.rotation=.5*-Math.PI,gameObjects.roomJackObjs.rightArm1.goalRot=gameObjects.roomJackObjs.rightArm1.rotation,gameObjects.roomJackObjs.rightArm1.trueRot=gameObjects.roomJackObjs.rightArm1.rotation,gameObjects.roomJackObjs.rightArm2=e.add.image(0,9999,"roomJack","midArm").setOrigin(.06,.45),gameObjects.roomJackObjs.rightArm2.rotation=.5*Math.PI,gameObjects.roomJackObjs.rightArm2.goalRot=gameObjects.roomJackObjs.rightArm2.rotation,gameObjects.roomJackObjs.rightArm2.trueRot=gameObjects.roomJackObjs.rightArm2.rotation,gameObjects.roomJackObjs.rightArm3=e.add.image(0,9999,"roomJack","lowerArm").setOrigin(.07,.5),gameObjects.roomJackObjs.rightArm3.scaleY=-1,gameObjects.roomJackObjs.rightArm3.rotation=.5*Math.PI,gameObjects.roomJackObjs.rightArm3.goalRot=gameObjects.roomJackObjs.rightArm3.rotation,gameObjects.roomJackObjs.rightArm3.trueRot=gameObjects.roomJackObjs.rightArm3.rotation,gameObjects.roomJackObjs.rightHand=e.add.image(0,9999,"roomJack","hand2"),gameObjects.roomJackObjs.rightHand.scaleX=-1,gameObjects.roomJackObjs.rightElbow={x:0,y:0,velX:0,velY:0},gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.rightArm1),gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.rightArm2),gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.rightArm3),gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.rightHand),updateJackArmsLeft(),updateJackArmsRight()}function updateJackArmsLeft(){var e=gameObjects.roomJackObjs.leftArm1,a=gameObjects.roomJackObjs.leftArm2,t=gameObjects.roomJackObjs.leftArm3;gameObjects.roomJackObjs.leftHand,a.x=e.x+e.width*e.scaleX*Math.cos(e.rotation)*(.87+e.shadowLength),a.y=e.y+e.width*e.scaleX*Math.sin(e.rotation)*(.87+e.shadowLength),t.x=a.x+a.width*a.scaleX*Math.cos(a.rotation)*.97,t.y=a.y+a.width*a.scaleX*Math.sin(a.rotation)*.97,gameObjects.roomJackObjs.leftHand.x=t.x+t.width*t.scaleX*Math.cos(t.rotation)*.95,gameObjects.roomJackObjs.leftHand.y=t.y+t.width*t.scaleX*Math.sin(t.rotation)*.95,e.x=gameObjects.roomJackObjs.leftArm1.origX-Math.random(),gameObjects.roomJackObjs.leftArm1.trueRot=.1*gameObjects.roomJackObjs.leftArm1.trueRot+.9*gameObjects.roomJackObjs.leftArm1.goalRot,gameObjects.roomJackObjs.leftArm2.trueRot=.1*gameObjects.roomJackObjs.leftArm2.trueRot+.9*gameObjects.roomJackObjs.leftArm2.goalRot,gameObjects.roomJackObjs.leftArm3.trueRot=.1*gameObjects.roomJackObjs.leftArm3.trueRot+.9*gameObjects.roomJackObjs.leftArm3.goalRot,gameObjects.roomJackObjs.leftArm1.rotation=gameObjects.roomJackObjs.leftArm1.trueRot+.02*Math.random(),gameObjects.roomJackObjs.leftArm2.rotation=gameObjects.roomJackObjs.leftArm2.trueRot+.02*Math.random(),gameObjects.roomJackObjs.leftArm3.rotation=gameObjects.roomJackObjs.leftArm3.trueRot+.01*Math.random()}function updateJackArmsRight(){var e=gameObjects.roomJackObjs.rightArm1,a=gameObjects.roomJackObjs.rightArm2,t=gameObjects.roomJackObjs.rightArm3;a.x=e.x+e.width*e.scaleX*Math.cos(e.rotation)*(.86+e.shadowLength),a.y=e.y+e.width*e.scaleX*Math.sin(e.rotation)*(.86+e.shadowLength),t.x=a.x+a.width*a.scaleX*Math.cos(a.rotation),t.y=a.y+a.width*a.scaleX*Math.sin(a.rotation),gameObjects.roomJackObjs.rightHand.x=t.x+t.width*t.scaleX*Math.cos(t.rotation)*.97,gameObjects.roomJackObjs.rightHand.y=t.y+t.width*t.scaleX*Math.sin(t.rotation)*.97,e.x=gameObjects.roomJackObjs.rightArm1.origX-Math.random(),gameObjects.roomJackObjs.rightArm1.trueRot=.1*gameObjects.roomJackObjs.rightArm1.trueRot+.9*gameObjects.roomJackObjs.rightArm1.goalRot,gameObjects.roomJackObjs.rightArm2.trueRot=.1*gameObjects.roomJackObjs.rightArm2.trueRot+.9*gameObjects.roomJackObjs.rightArm2.goalRot,gameObjects.roomJackObjs.rightArm3.trueRot=.1*gameObjects.roomJackObjs.rightArm3.trueRot+.9*gameObjects.roomJackObjs.rightArm3.goalRot,gameObjects.roomJackObjs.rightArm1.rotation=gameObjects.roomJackObjs.rightArm1.trueRot+.02*Math.random(),gameObjects.roomJackObjs.rightArm2.rotation=gameObjects.roomJackObjs.rightArm2.trueRot+.02*Math.random(),gameObjects.roomJackObjs.rightArm3.rotation=gameObjects.roomJackObjs.rightArm3.trueRot+.01*Math.random(),gameObjects.roomJackObjs.rightElbow.x=a.x+a.width*a.scaleX*Math.cos(a.rotation)*.96,gameObjects.roomJackObjs.rightElbow.y=a.y+a.width*a.scaleX*Math.sin(a.rotation)*.96}function updateJackArmsRightAuto(){var e=gameObjects.roomJackObjs.rightArm1,a=gameObjects.roomJackObjs.rightArm2,t=gameObjects.roomJackObjs.rightArm3,o=(gameObjects.roomJackObjs.rightArm1.rotation=gameObjects.roomJackObjs.rightArm1.trueRot+.01*Math.random()+.3*Math.sin(gameObjects.roomJackObjs.spinner.rotation)+.25,gameObjects.roomJackObjs.readyToGrabSpinner&&(o=gameObjects.roomJackObjs.spinner.x+121*Math.cos(gameObjects.roomJackObjs.spinner.rotation),s=gameObjects.roomJackObjs.spinner.y+121*Math.sin(gameObjects.roomJackObjs.spinner.rotation),gameObjects.roomJackObjs.rightHand.x=o,gameObjects.roomJackObjs.rightHand.y=s,gameObjects.roomJackObjs.rightHand.rotation=.35*(t.rotation-2.38)),gameObjects.roomJackObjs.readyToGrabSpinner?(t.x=gameObjects.roomJackObjs.rightHand.x+105,t.y=gameObjects.roomJackObjs.rightHand.y+45):(t.x=gameObjects.roomJackObjs.rightHand.x,t.y=gameObjects.roomJackObjs.rightHand.y),a.x=e.x+e.width*e.scaleX*Math.cos(e.rotation)*.87,a.y=e.y+e.width*e.scaleX*Math.sin(e.rotation)*.87,gameObjects.roomJackObjs.rightElbow.y-a.y),s=gameObjects.roomJackObjs.rightElbow.x-a.x,e=gameObjects.roomJackObjs.rightElbow.y-t.y,m=gameObjects.roomJackObjs.rightElbow.x-t.x,r=(a.rotation=Math.atan2(o,s),gameObjects.roomJackObjs.rightArm2.rotation<.5*-Math.PI&&(a.rotation=.4,gameObjects.roomJackObjs.rightElbow.x=a.x+a.width*a.scaleX*Math.cos(a.rotation)*.96,gameObjects.roomJackObjs.rightElbow.y=a.y+a.width*a.scaleX*Math.sin(a.rotation)*.96),t.rotation=Math.atan2(e,m)+Math.PI,.97*Math.sqrt(s*s+o*o)),c=1.1*Math.sqrt(m*m+e*e),r=r-a.width,a=(gameObjects.roomJackObjs.rightElbow.velX+=s*r*-.003,gameObjects.roomJackObjs.rightElbow.velY+=o*r*-.003,c-t.width);gameObjects.roomJackObjs.rightElbow.velX+=m*a*-.003,gameObjects.roomJackObjs.rightElbow.velY+=e*a*-.003,gameObjects.roomJackObjs.rightElbow.x+=gameObjects.roomJackObjs.rightElbow.velX,gameObjects.roomJackObjs.rightElbow.y+=gameObjects.roomJackObjs.rightElbow.velY+.01,gameObjects.roomJackObjs.rightElbow.velX*=.75,gameObjects.roomJackObjs.rightElbow.velY*=.75}function flipToAutoSpinArm(){var e,a;gameObjects.roomJackObjs.triggeredAutopilot||(gameObjects.roomJackObjs.triggeredAutopilot=!0,gameObjects.roomJackObjs.rightArm2.setOrigin(-.03,.5),e=gameObjects.roomJackObjs.rightArm3.rotation,gameObjects.roomJackObjs.rightArm3.rotation=e+2*Math.PI,gameObjects.roomJackObjs.rightArm3.setOrigin(.98,.5),gameObjects.roomJackObjs.rightArm3.x=gameObjects.roomJackObjs.rightHand.x,gameObjects.roomJackObjs.rightArm3.y=gameObjects.roomJackObjs.rightHand.y,globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm1,scaleX:.9,x:"-=15",y:"-=20",ease:"Quad.easeOut",duration:200}),e=gameObjects.roomJackObjs.spinner.x+121*Math.cos(gameObjects.roomJackObjs.spinner.rotation),a=gameObjects.roomJackObjs.spinner.y+121*Math.sin(gameObjects.roomJackObjs.spinner.rotation),gameObjects.roomJackObjs.useAltArmMovement=!0,globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightHand,x:e+120,y:a+5,ease:"Quad.easeIn",duration:225,onComplete:()=>{gameObjects.roomJackObjs.isAutopilot=!0,gameObjects.roomJackObjs.readyToGrabSpinner=!0,setTimeout(()=>{gameObjects.sounds.squeak3.play({loop:!0}),gameObjects.sounds.squeak3.volume=1,showStaticLite()},2200);var e=gameObjects.roomJackObjs.rightHand.x,a=gameObjects.roomJackObjs.rightHand.y;gameObjects.roomJackObjs.rightHand.rotation,gameObjects.roomJackObjs.rightHand.destroy(),gameObjects.roomJackObjs.rightHand=globalScene.add.image(e,a,"roomJack","hand3"),gameObjects.roomJackObjs.rightHand.rotation=0,gameObjects.roomJackObjs.rightHand.scaleY=1.08,gameObjects.roomJackObjs.rightArm3.scaleY=1.15,zoomTemp(1.01),gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.rightHand),resetJackLights(),gameObjects.roomJackObjs.lights.alpha*=.5,setTimeout(()=>{gameObjects.roomJackObjs.lights.alpha*=2},80),globalScene.tweens.add({targets:[gameObjects.roomJackObjs.rightHand,gameObjects.roomJackObjs.rightArm3],scaleY:1,ease:"Quad.easeOut",duration:200})}}),gameObjects.roomJackObjs.roomContainer.bringToTop(gameObjects.roomJackObjs.rightArm3),gameObjects.roomJackObjs.roomContainer.bringToTop(gameObjects.roomJackObjs.rightHand),resetJackLights(),updateJackArmsRightAuto(),gameObjects.roomJackObjs.rightArm2.rotation<.5*-Math.PI&&(gameObjects.roomJackObjs.rightArm2.rotation=-.1))}function jumpOutLeftArm(){var e=gameObjects.roomJackObjs.leftArm1;gameObjects.roomJackObjs.leftArm2,gameObjects.roomJackObjs.leftArm3,gameObjects.roomJackObjs.leftHand,e.y=gameVars.height+300,gameObjects.roomJackObjs.leftArm3.rotation=.5*Math.PI,playSound("emerge1"),gameObjects.roomJackObjs.dollHead.rotation=.15,gameObjects.roomJackObjs.dollEyes.rotation=.16,globalScene.tweens.add({targets:[gameObjects.roomJackObjs.dollHead,gameObjects.roomJackObjs.dollEyes],rotation:0,ease:"Cubic.easesIn",duration:600}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftArm2,goalRot:1.5,ease:"Quad.easeIn",duration:250,onComplete:()=>{globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftArm3,ease:"Elastic",easeParams:[.1,.92],goalRot:1.4,duration:400,onComplete:()=>{globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftArm3,ease:"Cubic.easeIn",goalRot:2.44,duration:1400,onComplete:()=>{globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftArm3,ease:"Cubic.easeIn",goalRot:1.68,duration:300,onComplete:()=>{zoomTemp(1.03),playSound("groundthud2"),gameObjects.roomJackObjs.leftArm1.scaleY=1.1,gameObjects.roomJackObjs.leftArm2.scaleY=-1.12,gameObjects.roomJackObjs.leftArm3.scaleY=-1.12,globalScene.tweens.add({targets:[gameObjects.roomJackObjs.leftArm1],ease:"Cubic.easeIn",scaleY:1,duration:250}),globalScene.tweens.add({targets:[gameObjects.roomJackObjs.leftArm2,gameObjects.roomJackObjs.leftArm3],ease:"Cubic.easeIn",scaleY:-1,duration:250}),gameObjects.roomJackObjs.portraitGiraffe.destroy(),gameObjects.roomJackObjs.portraitGiraffe2.visible=!0,gameObjects.roomJackObjs.portraitBox.destroy(),gameObjects.roomJackObjs.portraitBox2.visible=!0,gameObjects.roomJackObjs.streamers.destroy(),gameObjects.roomJackObjs.neck1.visible=!0,gameObjects.roomJackObjs.neck2.visible=!0,gameObjects.roomJackObjs.neck3.visible=!0,setTimeout(()=>{gameObjects.roomJackObjs.lights.alpha*=.5,setTimeout(()=>{gameObjects.roomJackObjs.lights.alpha*=2},80)},50)}}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftArm2,ease:"Cubic.easeIn",scaleX:1.08,goalRot:2.86,duration:300}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftArm1,shadowLength:0,scaleX:.8,goalRot:-1.9,ease:"Cubic.easeIn",origX:"-=80",y:"+=23",duration:300});var e=gameObjects.roomJackObjs.leftHand.x,a=gameObjects.roomJackObjs.leftHand.y,t=gameObjects.roomJackObjs.leftHand.rotation;gameObjects.roomJackObjs.leftHand.destroy(),gameObjects.roomJackObjs.leftHand=globalScene.add.image(e,a,"roomJack","hand1"),gameObjects.roomJackObjs.leftHand.rotation=t,gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.leftHand),resetJackLights(),globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftHand,rotation:0,ease:"Cubic.easeIn",duration:280})}}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftArm2,ease:"Quad.easeOut",goalRot:4.7,duration:1400}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftArm1,goalRot:-1.2,ease:"Quad.easeInOut",origX:"-=10",y:"-=60",duration:1400}),gameObjects.roomJackObjs.leftArm2.setOrigin(.05,.5)}}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftArm2,goalRot:2.7,duration:450}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftArm1,shadowLength:.02,scaleX:1.1,goalRot:-1.35,origX:"+=60",y:"-=240",duration:350})}}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.leftArm1,ease:"Quad.easeIn",scaleX:1.05,goalRot:-1.48,origX:"+=30",y:"-=350",duration:250})}function jumpOutRightArm(){var e=gameObjects.roomJackObjs.rightArm1;gameObjects.roomJackObjs.rightArm2,gameObjects.roomJackObjs.rightArm3,gameObjects.roomJackObjs.rightHand,e.scaleX=.8,e.y=gameVars.height+300,gameObjects.roomJackObjs.rightArm3.rotation=.5*Math.PI,playSound("emerge2"),gameObjects.roomJackObjs.dollHead.rotation=-.15,gameObjects.roomJackObjs.dollEyes.rotation=-.16,globalScene.tweens.add({targets:[gameObjects.roomJackObjs.dollHead,gameObjects.roomJackObjs.dollEyes],rotation:0,ease:"Cubic.easesIn",duration:600}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm2,goalRot:1.65,ease:"Quad.easeIn",duration:200,onComplete:()=>{globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm3,ease:"Elastic",easeParams:[.1,.92],goalRot:1.78,duration:350,onComplete:()=>{globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm3,ease:"Cubic.easeIn",goalRot:.7,duration:1200,onComplete:()=>{globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm3,ease:"Cubic.easeIn",goalRot:1.44,duration:300,onComplete:()=>{zoomTemp(1.03),playSound("groundthud2"),gameObjects.roomJackObjs.rightArm1.scaleY=1.1,gameObjects.roomJackObjs.rightArm2.scaleY=1.12,gameObjects.roomJackObjs.rightArm3.scaleY=1.12,globalScene.tweens.add({targets:[gameObjects.roomJackObjs.rightArm1,gameObjects.roomJackObjs.rightArm2,gameObjects.roomJackObjs.rightArm3],ease:"Cubic.easeIn",scaleY:1,duration:250}),gameObjects.roomJackObjs.portraitGiraffe2.destroy(),gameObjects.roomJackObjs.portraitGiraffe3.visible=!0,gameObjects.roomJackObjs.portraitBox2.destroy(),gameObjects.roomJackObjs.portraitBox3.visible=!0,setTimeout(()=>{playSound("metalsqueak2"),gameObjects.roomJackObjs.placard.tweenScale({y:"+= 1",rotation:.5,duration:200,ease:"Cubic.easeOut"}),gameObjects.roomJackObjs.placard.setOnMouseUpFunc(showTurnHandleLots)},300),gameObjects.roomJackObjs.lights.alpha*=.5,setTimeout(()=>{gameObjects.roomJackObjs.lights.alpha*=2},80),setTimeout(()=>{flipToAutoSpinArm()},7500)}}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm2,ease:"Cubic.easeIn",scaleX:1.08,goalRot:.2,duration:300}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm1,scaleX:.8,goalRot:-1.28,ease:"Cubic.easeIn",origX:"+=80",y:"+=23",duration:300});var e=gameObjects.roomJackObjs.rightHand.x,a=gameObjects.roomJackObjs.rightHand.y,t=gameObjects.roomJackObjs.rightHand.rotation;gameObjects.roomJackObjs.rightHand.destroy(),gameObjects.roomJackObjs.rightHand=globalScene.add.image(e,a,"roomJack","hand1"),gameObjects.roomJackObjs.rightHand.scaleX=-1,gameObjects.roomJackObjs.rightHand.rotation=t,gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.rightHand),resetJackLights(),globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightHand,rotation:0,ease:"Cubic.easeIn",duration:280}),gameObjects.roomJackObjs.rightArm2.setOrigin(0,.5)}}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm2,ease:"Quad.easeOut",goalRot:-1.56,duration:1200}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm1,shadowLength:0,goalRot:-1.94,ease:"Quad.easeInOut",origX:"+=10",y:"-=60",duration:1200}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightHand,ease:"Cubic.easeIn",rotation:-.2,delay:1200,duration:200}),gameObjects.roomJackObjs.rightArm2.setOrigin(.05,.5)}}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm2,goalRot:.44,duration:400}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm1,shadowLength:.02,scaleX:1.1,goalRot:-1.79,origX:"-=60",y:"-=240",duration:300})}}),globalScene.tweens.add({targets:gameObjects.roomJackObjs.rightArm1,ease:"Quad.easeIn",scaleX:1.05,goalRot:-1.66,origX:"-=30",y:"-=350",duration:200})}function showTurnHandleLots(){gameObjects.roomJackObjs.placard.setOnMouseUpFunc(()=>{}),showInfoTextLoop([{text:"TURN THE HANDLE",time:1e3},{text:"TURN THE HANDLE TURN THE HANDLE",time:500},{text:"TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE",time:100},{text:"TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE",time:50},{text:dupeTurnTheHandle(1),time:100},{text:dupeTurnTheHandle(2),time:100},{text:dupeTurnTheHandle(3),time:100},{text:dupeTurnTheHandle(4),time:100},{text:dupeTurnTheHandle(5),time:200},{text:" ",time:800}],void 0,!1),setTimeout(()=>{flipToAutoSpinArm()},3300)}function startFinale(){gameObjects.roomJackObjs.startFinale=!0,gameObjects.roomJackObjs.dollface=globalScene.add.image(80,-320,"roomJack","dollface"),gameObjects.roomJackObjs.dollface.rotation=3.16,gameObjects.roomJackObjs.dollface.scaleExpand=.001,gameObjects.roomJackObjs.dollface.scaleX=.5,gameObjects.roomJackObjs.dollface.scaleY=.5,gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.dollface),gameObjects.roomJackObjs.dollmouth=globalScene.add.image(80,-320,"roomJack","dollmouth"),gameObjects.roomJackObjs.dollmouth.rotation=3.16,gameObjects.roomJackObjs.dollmouth.scaleX=.5,gameObjects.roomJackObjs.dollmouth.scaleY=.5,gameObjects.roomJackObjs.dollmouth.scaleYRatio=1.05,gameObjects.roomJackObjs.dollmouth.scaleYVel=.02,gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.dollmouth)}function dupeTurnTheHandle(e=0){let a="TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE TURN THE HANDLE\n";for(;0<e;)--e,a+=a;return a}function resetJackLights(){var e=gameObjects.roomJackObjs.lights.x,a=gameObjects.roomJackObjs.lights.y,t=gameObjects.roomJackObjs.lights.alpha;gameObjects.roomJackObjs.lights.destroy(),gameObjects.roomJackObjs.lights=globalScene.add.image(e,a,"roomJack","lights2"),gameObjects.roomJackObjs.lights.alpha=t+.03,gameObjects.roomJackObjs.lights.scaleX=2,gameObjects.roomJackObjs.lights.scaleY=2,gameObjects.roomJackObjs.roomContainer.add(gameObjects.roomJackObjs.lights)}function shakeJackHead(){gameObjects.roomJackObjs.dollHeadSmile.rotation=-.01*Math.random()}function setupPortraits(e,a){gameObjects.roomJackObjs.portraitBox=a.add.image(-345,295,"roomJack","portrait1"),gameObjects.roomJackObjs.portraitBox.visible=!1,e.add(gameObjects.roomJackObjs.portraitBox),gameObjects.roomJackObjs.portraitBox2=a.add.image(gameObjects.roomJackObjs.portraitBox.x,gameObjects.roomJackObjs.portraitBox.y,"roomJack","portrait2"),gameObjects.roomJackObjs.portraitBox2.visible=!1,e.add(gameObjects.roomJackObjs.portraitBox2),gameObjects.roomJackObjs.portraitBox3=a.add.image(gameObjects.roomJackObjs.portraitBox.x,gameObjects.roomJackObjs.portraitBox.y,"roomJack","portrait3"),gameObjects.roomJackObjs.portraitBox3.visible=!1,e.add(gameObjects.roomJackObjs.portraitBox3),gameObjects.roomJackObjs.portraitGiraffe=a.add.image(330,400,"roomJack","portrait4").setOrigin(.5,1),gameObjects.roomJackObjs.portraitGiraffe.visible=!1,e.add(gameObjects.roomJackObjs.portraitGiraffe),gameObjects.roomJackObjs.portraitGiraffe2=a.add.image(330,400,"roomJack","portrait7").setOrigin(.5,1),gameObjects.roomJackObjs.portraitGiraffe2.visible=!1,e.add(gameObjects.roomJackObjs.portraitGiraffe2),gameObjects.roomJackObjs.portraitGiraffe3=a.add.image(330,400,"roomJack","portrait4x").setOrigin(.5,1),gameObjects.roomJackObjs.portraitGiraffe3.visible=!1,e.add(gameObjects.roomJackObjs.portraitGiraffe3)}function shakeHeadFlashOne(e=1){var a=Math.floor(.45*gameObjects.roomJackObjs.dollHeadFlash1.scaleX*7)/7-.4,a=(gameObjects.roomJackObjs.dollHeadFlash1.rotation=.04*(Math.random()-.5)-a,.001+gameObjects.roomJackObjs.dollHeadFlash1.scaleX*gameObjects.roomJackObjs.dollHeadFlash1.scaleX*.006);gameObjects.roomJackObjs.dollHeadFlash1.scaleX+=a*e,gameObjects.roomJackObjs.dollHeadFlash1.scaleY+=a*e}function shakeHeadFlashTwo(e=1){var a=Math.floor(.25*gameObjects.roomJackObjs.dollHeadFlash1.scaleX*6)/6-.2,a=(gameObjects.roomJackObjs.dollHeadFlash2.rotation=.05*(Math.random()-.5)-a,.001+gameObjects.roomJackObjs.dollHeadFlash2.scaleX*gameObjects.roomJackObjs.dollHeadFlash2.scaleX*.006);gameObjects.roomJackObjs.dollHeadFlash2.scaleX+=a*e,gameObjects.roomJackObjs.dollHeadFlash2.scaleY+=a*e}function setupRoomClown1(e,o,a){let s;gameObjects.exhibit.setBackgroundAtIndex(o,"bgs","bg4"),gameObjects.roomClown1={roomIndex:o,roomContainer:a},gameObjects.roomClown1.portraitWhite=globalScene.add.image(0,gameVars.halfHeight-50,"roomClown","portraitWhite"),a.add(gameObjects.roomClown1.portraitWhite),gameObjects.roomClown1.portrait=globalScene.add.image(0,gameVars.halfHeight-50,"roomClown","portrait"),a.add(gameObjects.roomClown1.portrait),gameObjects.roomClown1.flower=e.add.image(300,gameVars.height-28,"misc","flower1"),gameObjects.roomClown1.flower.setOrigin(.5,1),a.add(gameObjects.roomClown1.flower),gameObjects.roomClown1.clown=globalScene.add.image(0,gameVars.halfHeight+93,"roomClown","clownsmall1"),a.add(gameObjects.roomClown1.clown),gameObjects.roomClown1.nose=new Button(e,a,()=>{nosePress1(o,a)},{atlas:"roomClown",ref:"noseglow",x:12,y:gameVars.halfHeight+73,alpha:.001,scaleX:.155,scaleY:.155},{atlas:"roomClown",ref:"noseglow",alpha:1,scaleX:.158,scaleY:.158}),gameObjects.roomClown1.nose.setScale(145,30),s=messageBus.subscribe("exhibitMove",e=>{var a,t;e===o&&(s.unsubscribe(),e=gameObjects.clownWelcomePic.x,a=gameObjects.clownWelcomePic.y,t=gameObjects.clownWelcomePic.scaleX,gameObjects.clownWelcomePic.destroy(),gameObjects.clownWelcomePic=globalScene.add.image(e,a,"menu","framesEnter4"),gameObjects.clownWelcomePic.scaleX=t,gameObjects.clownWelcomePic.scaleY=t,gameObjects.clownWelcomePic.cantChange=!0,gameObjects.gameCtnr1.add(gameObjects.clownWelcomePic),tweenVolume("gladiator0",.5))})}function setupRoomClown2(e,a,t){let o;gameObjects.exhibit.setBackgroundAtIndex(a,"bgs","bg7"),gameObjects.roomClown2||(gameObjects.roomClown2={roomIndex:a,roomContainer:t}),gameObjects.roomClown2.portraitWhite=globalScene.add.image(0,gameVars.halfHeight-50,"roomClown","portraitWhite"),t.add(gameObjects.roomClown2.portraitWhite),gameObjects.roomClown2.portrait=globalScene.add.image(0,gameVars.halfHeight-50,"roomClown","portrait"),t.add(gameObjects.roomClown2.portrait),gameObjects.roomClown2.flower=e.add.image(300,gameVars.height-28,"misc","flower1"),gameObjects.roomClown2.flower.setOrigin(.5,1),t.add(gameObjects.roomClown2.flower),gameObjects.roomClown2.clown=globalScene.add.image(0,gameVars.halfHeight+14,"roomClown","clownnormal"),t.add(gameObjects.roomClown2.clown),gameObjects.roomClown2.clown.scaleX=.25,gameObjects.roomClown2.clown.scaleY=.25,gameObjects.roomClown2.nose=new Button(e,t,()=>{nosePress2(a,t)},{atlas:"roomClown",ref:"noseglow",x:19,y:gameVars.halfHeight-14,alpha:.001,scaleX:.25,scaleY:.25},{atlas:"roomClown",ref:"noseglow",alpha:1,scaleX:.25,scaleY:.25}),o=messageBus.subscribe("exhibitMove",e=>{e===a&&(o.unsubscribe(),gameObjects.roomClown1)&&gameObjects.exhibit.removeIndex(gameObjects.roomClown1.roomIndex)})}function setupRoomClown3(a,t,o){let s;gameObjects.exhibit.setBackgroundAtIndex(t,"bgs","bg9"),gameObjects.roomClown3||(gameObjects.roomClown3={roomIndex:t,roomContainer:o}),gameObjects.roomClown3.portraitWhite=globalScene.add.image(5,gameVars.halfHeight-50,"roomClown","portraitWhite"),o.add(gameObjects.roomClown3.portraitWhite),gameObjects.roomClown3.portrait=globalScene.add.image(5,gameVars.halfHeight-50,"roomClown","portrait"),o.add(gameObjects.roomClown3.portrait),gameObjects.roomClown3.clown=globalScene.add.image(0,gameVars.halfHeight-46,"roomClown","clownlarge1"),o.add(gameObjects.roomClown3.clown),gameObjects.roomClown3.nose=new Button(a,{container:o,normal:{atlas:"roomClown",ref:"noseglow",x:25.5,y:gameVars.halfHeight-83,alpha:.001,scaleX:.33,scaleY:.33},hover:{atlas:"roomClown",ref:"noseglow",alpha:1,scaleX:.335,scaleY:.335},onMouseUp:()=>{nosePress3(t,o)}}),s=messageBus.subscribe("exhibitMove",e=>{e===t&&(s.unsubscribe(),gameObjects.roomClown2)&&gameObjects.exhibit.removeIndex(gameObjects.roomClown2.roomIndex)}),messageBus.subscribe("prepareFinalClown",e=>{disableMoveButtons(),gameObjects.roomClown3.portrait.destroy(),gameObjects.roomClown3.clown=globalScene.add.image(0,gameVars.halfHeight+60,"roomClown","clowncreepy"),gameObjects.roomClown3.clown.scaleX=.75,gameObjects.roomClown3.clown.scaleY=.75,gameObjects.roomClown3.clownLeftEye=globalScene.add.image(-66,gameVars.halfHeight-100,"roomClown","leftEye"),gameObjects.roomClown3.clownLeftEye.origX=gameObjects.roomClown3.clownLeftEye.x,gameObjects.roomClown3.clownLeftEye.origY=gameObjects.roomClown3.clownLeftEye.y,gameObjects.roomClown3.clownLeftEye.scaleX=.75,gameObjects.roomClown3.clownLeftEye.scaleY=.75,gameObjects.roomClown3.clownRightEye=globalScene.add.image(203,gameVars.halfHeight-60,"roomClown","leftEye"),gameObjects.roomClown3.clownRightEye.origX=gameObjects.roomClown3.clownRightEye.x,gameObjects.roomClown3.clownRightEye.origY=gameObjects.roomClown3.clownRightEye.y,gameObjects.roomClown3.clownRightEye.scaleX=.75,gameObjects.roomClown3.clownRightEye.scaleY=.75,o.add(gameObjects.roomClown3.clown),o.add(gameObjects.roomClown3.clownLeftEye),o.add(gameObjects.roomClown3.clownRightEye),addToUpdateFuncList(shakeClownEyes),disableMoveLeftButton(),gameObjects.roomClown3.nose2=new Button(a,o,()=>{nosePressFinal(t,o)},{atlas:"roomClown",ref:"noseglow",x:58,y:gameVars.halfHeight-22,alpha:.01,scaleX:.75,scaleY:.75},{atlas:"roomClown",ref:"noseglow",alpha:.25})})}function shakeClownEyes(){gameObjects.roomClown3.clownRightEye.x=gameObjects.roomClown3.clownRightEye.origX+2*Math.random()+.003*(gameVars.mouseposx-gameVars.halfWidth),gameObjects.roomClown3.clownRightEye.y=gameObjects.roomClown3.clownRightEye.origY+2*Math.random()+.0012*(gameVars.mouseposy-gameVars.halfHeight),gameObjects.roomClown3.clownLeftEye.x=gameObjects.roomClown3.clownLeftEye.origX+2*Math.random()+.003*(gameVars.mouseposx-gameVars.halfWidth),gameObjects.roomClown3.clownLeftEye.y=gameObjects.roomClown3.clownLeftEye.origY+2*Math.random()+.0012*(gameVars.mouseposy-gameVars.halfHeight)}function nosePress1(e,a){let t,o=gameObjects.roomClown1.clown.y;gameObjects.roomClown1.clown.destroy(),gameObjects.roomClown1.clown=globalScene.add.image(0,o,"roomClown","clownsmall2"),a.add(gameObjects.roomClown1.clown),gameObjects.roomClown1.nose.destroy(),setTimeout(()=>{createKey(5,gameVars.halfHeight+130,gameObjects.roomClown1.roomIndex,gameObjects.roomClown1.roomContainer,!0)},100),t=messageBus.subscribe("exhibitMoveRight",()=>{t.unsubscribe(),setTimeout(()=>{let e=globalScene.add.image(0,o,"roomClown","clownsmall3");a.add(e),playSound("clownlaugh1"),setTimeout(()=>{e.destroy()},1e3),showStaticRand(1,null,void 0,.08),gameObjects.generalDarkness.alpha=.05,setTimeout(()=>{gameObjects.generalDarkness.alpha=0},50)},350)})}function nosePress2(e,a){gameObjects.roomClown2.nose.destroy();var t=gameObjects.roomClown2.clown.y;gameObjects.roomClown2.clown.destroy(),gameObjects.roomClown2.clown=globalScene.add.image(0,t,"roomClown","clownlarge1"),a.add(gameObjects.roomClown2.clown),gameObjects.roomClown2.clown.scaleX=.76,gameObjects.roomClown2.clown.scaleY=.76,setTimeout(()=>{gameObjects.generalDarkness.alpha=.03,setTimeout(()=>{gameObjects.generalDarkness.alpha=.1,setTimeout(()=>{gameObjects.generalDarkness.alpha=0,setTimeout(()=>{gameObjects.generalDarkness.alpha=.05,setTimeout(()=>{gameObjects.generalDarkness.alpha=0},10)},500)},10)},50)},23),setTimeout(()=>{createKey(12,gameVars.halfHeight+150,gameObjects.roomClown2.roomIndex,gameObjects.roomClown2.roomContainer,!0)},500)}function nosePress3(o,s){if(gameObjects.roomClown3.nose.setPos(19,-9999),gameObjects.roomClown3.clickedOnce){gameObjects.roomClown3.nose.destroy(),playSound("keyfound"),setTimeout(()=>{playSound("click3")},500);var a=globalScene.add.image(0,600,"buttons","key_red");s.add(a),gameVars.clownRedKeyUp=!0;let e=new Button(globalScene,{container:s,normal:{ref:"blackPixel",x:0,y:615,scaleX:55,scaleY:25,alpha:.001},onHover:()=>{e.destroy(),gameObjects.roomClown3.clown.visible=!1,gameObjects.roomClown3.clown.destroy();let t=globalScene.add.image(0,gameVars.halfHeight-50,"roomClown","clownlarge2");s.add(t),showStaticRand(3),playSound("clownlaugh2"),tempFreeze(800),setTimeout(()=>{t.x=-3,setTimeout(()=>{t.scaleX=1.03,t.x=4,setTimeout(()=>{t.x=-7,t.scaleX=1.08,t.scaleY=1.02,setTimeout(()=>{t.x=9,t.scaleX=1.18,t.scaleY=1.05,setTimeout(()=>{t.visible=!1;let a=globalScene.add.image(-150,gameVars.halfHeight-94,"roomClown","clownunleashed");s.add(a),setTimeout(()=>{a.visible=!1;let e=globalScene.add.image(0,gameVars.halfHeight+70,"roomClown","clownunleashed2");e.scaleX=1.02,e.scaleY=1,s.add(e),setTimeout(()=>{e.scaleX=1.3,e.scaleY=1.3,setTimeout(()=>{e.scaleX=1.25,e.scaleY=1.25,showFlashArr([0,1,12,2,3,12,6,13,7,14,8],()=>{a.destroy(),t.destroy(),e.destroy(),gameObjects.roomClown3.portrait.destroy(),gameObjects.roomClown3.portrait=globalScene.add.image(0,gameVars.halfHeight-50,"roomClown","portraitbroken"),s.add(gameObjects.roomClown3.portrait),initDarkSequence(o),enableMoveButtons(),setTimeout(()=>{gameObjects.sounds.gladiator1.volume=.25,gameObjects.sounds.gladiator2.volume=0,tweenVolume("gladiator1",1),gameObjects.musicBoxNote.alpha=1,gameObjects.musicBoxNote2.alpha=1,gameObjects.musicBoxNote.origX=gameObjects.musicBox.x,gameObjects.musicBoxNote.origY=gameObjects.musicBox.y-50,gameObjects.sounds.gladiator0.stop(),gameObjects.sounds.gladiator1.play({loop:!0}),gameObjects.sounds.gladiator2.play({loop:!0}),globalScene.tweens.timeline({targets:[gameObjects.moveRightBtnHighlight,gameObjects.moveLeftBtnHighlight],tweens:[{alpha:1,ease:"Cubic.easeIn",duration:800},{alpha:0,ease:"Quad.easeOut",duration:2e3}]})},1700)})},50)},50)},200)},20)},40)},40)},40)},10)}})}else setTimeout(()=>{playSound("keyfound");let t=globalScene.add.image(gameVars.halfWidth+20,600,"buttons","key_yellow");setTimeout(()=>{gameObjects.roomClown3.clownTemp=globalScene.add.image(-100,gameVars.halfHeight-46,"roomClown","clownlarge2"),gameObjects.roomClown3.clownTemp.scaleX=1.5,s.add(gameObjects.roomClown3.clownTemp),setTimeout(()=>{gameObjects.roomClown3.clownTemp.x=20},0),setTimeout(()=>{let e=globalScene.add.image(gameVars.halfWidth+38,gameVars.halfHeight-144,"roomClown","clownnoseflash"),a=(globalScene.tweens.add({targets:e,alpha:0,duration:700,completeDelay:2e3,onComplete:()=>{gameVars.clownRedKeyUp?e.destroy():(e.alpha=.7,e.scaleX=1.2,e.scaleY=1.2,globalScene.tweens.add({targets:e,alpha:0,ease:"Quad.easeOut",duration:800,onComplete:()=>{e.destroy()}}),globalScene.tweens.add({targets:e,scaleX:2,scaleY:2,ease:"Cubic.easeOut",duration:800}))}}),globalScene.tweens.add({targets:e,scaleX:2,scaleY:2,ease:"Cubic.easeOut",duration:700}),globalScene.add.image(gameVars.halfWidth,gameVars.halfHeight,"roomClown","clownlarge3"));a.setScale(2),globalScene.tweens.add({targets:a,alpha:0,ease:"Quart.easeOut",duration:120,onComplete:()=>{a.destroy()}}),gameObjects.roomClown3.clown.destroy(),gameObjects.roomClown3.clownTemp.destroy(),gameObjects.roomClown3.clown=globalScene.add.image(0,gameVars.halfHeight-47,"roomClown","clownlarge3"),gameObjects.roomClown3.clown.scaleX=.93,gameObjects.roomClown3.clown.scaleY=.96,s.add(gameObjects.roomClown3.clown),gameObjects.roomClown3.mouthlarge=globalScene.add.image(0,gameVars.halfHeight-50,"roomClown","mouthlarge"),gameObjects.roomClown3.mouthlarge.scaleX=.93,gameObjects.roomClown3.mouthlarge.scaleY=.96,gameObjects.roomClown3.mouthlarge.origScaleY=gameObjects.roomClown3.mouthlarge.scaleY,s.add(gameObjects.roomClown3.mouthlarge),addToUpdateFuncList(shakeClownMouth),playSound("click1"),setTimeout(()=>{t.destroy(),playSound("click",4),showStaticRand(3,null,()=>{showFlashRand(1)},.3),setTimeout(()=>{showStaticLite(3,3)},300),setTimeout(()=>{gameObjects.roomClown3.nose.setPos(35,gameVars.halfHeight-155),playSound("click1")},400),gameObjects.roomClown3.clickedOnce=!0},40)},50)},700)},100)}function nosePressFinal(e,a){gameObjects.roomClown3.nose2.destroy(),gameObjects.roomClown3.clown.destroy(),gameObjects.roomClown3.mouthlarge.destroy(),removeFromUpdateFuncList(shakeClownMouth),gameObjects.roomClown3.clown=globalScene.add.image(0,gameVars.halfHeight+60,"roomClown","clownnormal"),gameObjects.roomClown3.clown.scaleX=.75,gameObjects.roomClown3.clown.scaleY=.75,a.add(gameObjects.roomClown3.clown),setTimeout(()=>{createKey(25,gameVars.halfHeight+180,gameObjects.roomClown3.roomIndex,gameObjects.roomClown3.roomContainer,!0,disableMoveLeftButton)},100)}function shakeClownMouth(){gameObjects.roomClown3.mouthlarge.scaleY=gameObjects.roomClown3.mouthlarge.origScaleY+.05*Math.random()+.01}function setupRoomFinal(e,a,t){gameObjects.exhibit.setBackgroundAtIndex(a,"bgs","bg4");a=e.add.image(0,507,"buttons","exitDoorWhite");t.add(a),gameObjects.exitDoorFinal=new Button(e,t,()=>{onFinalExitClick(e)},{atlas:"buttons",ref:"exitDoorNormal",x:-210,y:507},{atlas:"buttons",ref:"exitDoorOver"},{atlas:"buttons",ref:"exitDoorOver"},{atlas:"buttons",ref:"exitDoorNormal"}),gameObjects.exitDoorFinal.setOrigin(0,.5)}function onFinalExitClick(t){gameObjects.exitDoorFinal.setState("disable"),setTimeout(()=>{playSound("dooropen2")},50),t.tweens.add({targets:t.cameras.main,zoom:4.1,ease:"Quad.easeIn",duration:6250,onComplete:()=>{t.cameras.main.setZoom(1);let e=t.add.image(0,gameVars.halfHeight,"misc","scrollworld");e.x=gameVars.width-.5*e.width,e.y=.5*e.height;var a=t.add.image(gameVars.halfWidth,gameVars.halfHeight,"whitePixel");a.scaleX=1e3,a.scaleY=800,t.tweens.add({targets:a,alpha:0,duration:2200}),t.tweens.add({targets:a,scaleX:a.scaleX+1,duration:2400,onComplete:()=>{runEpilogue(e)}}),t.tweens.add({targets:e,y:e.y-(e.height-gameVars.height),duration:25e3})}}),gameObjects.exitDoorFinal.tweenScale({scaleX:.96,duration:100,ease:"Cubic.easeOut",onComplete:()=>{gameObjects.exitDoorFinal.tweenScale({scaleX:.2,duration:5e3,ease:"Cubic.easeIn",onComplete:()=>{gameObjects.exitDoorFinal.tweenScale({scaleX:.15,duration:500,ease:"Cubic.easeOut",onComplete:()=>{}})}})}})}function runEpilogue(e){let a=globalScene.add.image(gameVars.halfWidth+95,450,"roomClown","clowndoor");var t=globalScene.add.image(gameVars.halfWidth-1200,457,"buttons","exitDoorOpenSurround");let o=globalScene.add.image(gameVars.halfWidth+40,565,"roomClown","clownhand"),s=(a.scaleX=-.3,a.scaleY=.72,a.rotation=-.9,a.visible=!1,o.visible=!1,globalScene.add.image(gameVars.halfWidth+100,774,"buttons","musicBox")),m=(s.visible=!1,globalScene.add.image(gameVars.halfWidth-1200+200,507,"buttons","exitDoorNormal"));m.setOrigin(0,.5),m.scaleX=-.6,globalScene.tweens.add({targets:e,x:e.x+1200,ease:"Cubic.easeInOut",duration:3200}),globalScene.tweens.add({targets:[m,t],x:"+=1200",ease:"Cubic.easeInOut",duration:3200,onComplete:()=>{a.visible=!0,o.visible=!0,globalScene.tweens.add({targets:a,x:"-=125",scaleX:-.71,ease:"Cubic.easeOut",duration:1e3,onComplete:()=>{gameObjectsTemp.boxBroken||(s.visible=!0,globalScene.tweens.add({targets:[s],x:"-=350",ease:"Cubic.easeOut",duration:1e3,onComplete:()=>{playSound("g6")}})),globalScene.tweens.add({targets:o,rotation:-.25,yoyo:!0,ease:"Sine.easeInOut",duration:400,repeat:1,onComplete:()=>{globalScene.tweens.add({targets:[o,a],scaleX:"-=0.1",x:"+=65",ease:"Cubic.easeIn",duration:350}),globalScene.tweens.add({targets:m,scaleX:-1,ease:"Quad.easeIn",duration:350,onComplete:()=>{playSound("doorslam"),sdkWrapperGameplayStop(),zoomTemp(1.04),showStaticLite(6,25,4,1),globalScene.add.image(gameVars.halfWidth,gameVars.halfHeight,"theEnd"),setTimeout(()=>{document.getElementById("background").style.opacity="0",document.getElementById("leftborder").style.opacity="0";document.getElementById("rightborder").style.opacity="0";var e=globalScene.add.image(gameVars.halfWidth,gameVars.halfHeight,"blackPixel");e.scaleX=999,e.scaleY=999,gameObjectsTemp.endText=globalScene.add.text(100,80,"Game by Maxim Tsai",{fontFamily:"Times New Roman",fontSize:30,color:"#ffffff",align:"left"}),gameObjectsTemp.endText.alpha=0,globalScene.tweens.add({targets:gameObjectsTemp.endText,alpha:1,duration:1e3,delay:300,onComplete:()=>{var e;useSDK&&(e=document.getElementById("banner-container-end"),gameVars.showingBannerBot=!0,e.style.bottom="0px"),sdkWrapperRequestResponsiveBanner("banner-container-end"),gameObjectsTemp.endText2=globalScene.add.text(100,140,"Art by Theresa Kao",{fontFamily:"Times New Roman",fontSize:30,color:"#ffffff",align:"left"}),gameObjectsTemp.endText2.alpha=0,globalScene.tweens.add({targets:gameObjectsTemp.endText2,alpha:1,duration:1e3,delay:600,onComplete:()=>{gameObjectsTemp.endText3=globalScene.add.text(100,200,"Special Helpers: @hby_stuff, Ester Tsai, Yuan Lin, Peikun Tsai",{fontFamily:"Times New Roman",fontSize:30,color:"#ffffff",align:"left"}),gameObjectsTemp.endText3.alpha=0,globalScene.tweens.add({targets:gameObjectsTemp.endText3,alpha:1,duration:1e3,delay:600,onComplete:()=>{var e="Random game trivia:\n\n";e+="- Engine used: Phaser 3\n";gameObjectsTemp.endText5=globalScene.add.text(100,380,"Random game trivia:\n\n- Engine used: Phaser 3\n- Development Time: 4 months\n- Number of Image Files: ~320\n- Number of Audio Files Files: ~105\n- Trickiest thing to draw: Jack in the Box's neck\n",{fontFamily:"Times New Roman",fontSize:26,color:"#ffffff",align:"left"}),gameObjectsTemp.endText5.setOrigin(0,.5),gameObjectsTemp.endText5.alpha=0,globalScene.tweens.add({targets:gameObjectsTemp.endText5,alpha:1,duration:1e3,delay:600,onComplete:()=>{gameObjectsTemp.lastText=globalScene.add.text(100,530,"Thank you for playing",{fontFamily:"Times New Roman",fontSize:48,color:"#ffffff",align:"center"}),gameObjectsTemp.lastText.setOrigin(0,.5),gameObjectsTemp.lastText.alpha=0,globalScene.tweens.add({targets:gameObjectsTemp.lastText,alpha:1,duration:2500,delay:3500}),setTimeout(()=>{gameObjectsTemp.dText=globalScene.add.text(100,585,"Latest news at:",{fontFamily:"Times New Roman",fontSize:28,color:"#ffffff",align:"right"}),gameObjectsTemp.dText.setOrigin(0,.5),gameObjectsTemp.dText.alpha=1,gameObjectsTemp.dText2=globalScene.add.text(100,630,"Bluesky",{fontFamily:"Times New Roman",fontSize:28,color:"#ffffff",align:"right"}),gameObjectsTemp.dText2.setOrigin(0,.5),gameObjectsTemp.dText2.alpha=.05,gameObjectsTemp.dText3=globalScene.add.text(100,670,"Twitter",{fontFamily:"Times New Roman",fontSize:28,color:"#ffffff",align:"right"}),gameObjectsTemp.dText3.setOrigin(0,.5),gameObjectsTemp.dText3.alpha=.05,globalScene.tweens.add({targets:[gameObjectsTemp.dText,gameObjectsTemp.dText2,gameObjectsTemp.dText3],alpha:.7,duration:2e3});var e=new Button(globalScene,void 0,()=>{window.open("https://bsky.app/profile/adayofjoy.itch.io")},{ref:"whitePixel",x:195,y:630,scaleX:350,scaleY:28,alpha:.001}),e=(e.setOnHoverFunc(()=>{gameObjectsTemp.dText2.alpha=1}),e.setOnHoverOutFunc(()=>{gameObjectsTemp.dText2.alpha=.7}),new Button(globalScene,void 0,()=>{window.open("https://x.com/TsaiMaxim")},{ref:"whitePixel",x:195,y:670,scaleX:350,scaleY:28,alpha:.001})),e=(e.setOnHoverFunc(()=>{gameObjectsTemp.dText3.alpha=1}),e.setOnHoverOutFunc(()=>{gameObjectsTemp.dText3.alpha=.7}),gameObjectsTemp.replayText=globalScene.add.text(100,720,"REPLAY",{fontFamily:"Times New Roman",fontSize:28,color:"#ffffff",align:"right"}),gameObjectsTemp.replayText.setOrigin(0,.5),gameObjectsTemp.replayText.alpha=.05,globalScene.tweens.add({targets:gameObjectsTemp.replayText,alpha:.6,duration:2e3}),new Button(globalScene,void 0,()=>{sdkCommercialBreak(()=>{},()=>{gameVars={baseSway:.025,gameStarted:!1,gameConstructed:!1,mousedown:!1,mouseposx:0,mouseposy:0,prevMouseposx:0,prevMouseposy:0,mouseaccx:0,mouseaccy:0,lastmousedown:{x:0,y:0},width:1220,halfWidth:610,height:920,halfHeight:460,horrorPoint:!1,darkPoint:!1,isFrozen:!1,lastLoadingWelcomeRef:null,walkSlow:!1,initialExtraDark:0,masterAudio:1,smallWindow:!1},oneTimeScares={},gameObjectsTemp={},gameVarsTemp={darkFlickerCountdown:1e3},gameObjects={buttonList:[],draggedObj:null,loadingWelcomes:[],noteList:[],starPressSequence:[]},updateFuncList=[],location.reload()})},{ref:"whitePixel",x:195,y:720,scaleX:350,scaleY:30,alpha:.001}));e.setOnHoverFunc(()=>{gameObjectsTemp.replayText.alpha=1}),e.setOnHoverOutFunc(()=>{gameObjectsTemp.replayText.alpha=.7})},2500)}})}})}})}}),gameObjectsTemp.boxBroken?tweenVolume("gladiatorx",.6):(playSound("gladiator0"),gameObjects.sounds.gladiator0.volume=1)},325)}})}})}}),globalScene.tweens.add({targets:[o],x:"-=130",ease:"Cubic.easeOut",duration:1250})}})}